<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BNK ì‡¼í•‘í™˜ì „í†µì¥ - ë³¸ì¸í™•ì¸ (íœ´ëŒ€í° & ê³„ì¢Œ)</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts - Inter for modern look -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f4f8;
            margin: 0;
            padding: 0;
            overflow-x: hidden;
        }
        .container {
            max-width: 500px;
            margin: 0 auto;
            background-color: #ffffff;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            border-radius: 1rem;
            overflow: hidden;
        }

        /* Header styles */
        header {
            flex: none; /* Do not grow/shrink */
        }
        
        /* Footer styles */
        .bottom-bar {
            flex: none; /* Do not grow/shrink */
            width: 100%;
            background-color: #ffffff;
            border-top: 1px solid #e2e8f0;
            padding: 0.75rem 1rem;
            box-shadow: 0 -4px 12px rgba(0, 0, 0, 0.03);
            display: flex;
            justify-content: space-around;
            gap: 0.5rem;
            z-index: 10;
        }
        .bottom-bar button {
            flex: 1;
            padding: 0.75rem 1rem;
            border-radius: 0.75rem;
            font-weight: 600;
            font-size: 0.95rem;
            transition: background-color 0.3s ease, transform 0.2s ease;
            box-shadow: 0 2px 6px rgba(0,0,0,0.1);
        }
        .bottom-bar button:active {
            transform: scale(0.98);
        }

        /* Main content area */
        .main-content {
            flex-grow: 1; /* Allow content to fill available space */
            padding: 0.75rem; 
            display: flex;
            flex-direction: column;
            gap: 1rem; 
            overflow-y: auto; 
        }

        .section-block {
            background-color: #ffffff;
            border-radius: 0.75rem;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
            display: flex;
            flex-direction: column;
            overflow: hidden; /* Ensure rounded corners */
        }

        .section-title {
            font-size: 1rem; /* Adjusted for consistency */
            font-weight: 600; /* Adjusted for consistency */
            color: #374151;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 1.5rem; /* Padding added to title itself */
            border-bottom: none;
            margin-bottom: 0; 
        }
        .section-title .checkmark {
            color: #10b981; 
            font-size: 1.2rem;
            margin-left: 0.5rem;
            display: none; 
        }
        .section-title .title-text {
            display: flex;
            align-items: center;
            flex-grow: 1;
        }

        /* Form elements */
        .form-group {
            margin-bottom: 1rem;
        }
        .form-group label {
            display: block;
            font-size: 0.9rem;
            font-weight: 500;
            color: #4b5563;
            margin-bottom: 0.5rem;
        }
        .form-group input,
        .form-group select {
            width: 100%;
            padding: 0.75rem 1rem;
            border: 1px solid #d1d5db;
            border-radius: 0.5rem;
            font-size: 1rem;
            color: #374151;
            box-sizing: border-box;
            background-color: #f9fafb; 
        }
        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: #2563eb;
            box-shadow: 0 0 0 2px rgba(37, 99, 235, 0.2);
        }
        .form-group input[readonly] {
            background-color: #e5e7eb; 
            cursor: not-allowed;
        }

        .input-with-button {
            display: flex;
            gap: 0.5rem;
        }
        .input-with-button input {
            flex-grow: 1;
        }
        .input-with-button button {
            flex-shrink: 0;
            padding: 0.75rem 1rem;
            border-radius: 0.5rem;
            font-weight: 600;
            font-size: 0.9rem;
            white-space: nowrap;
            transition: background-color 0.2s ease;
        }

        .cert-status { 
            font-size: 0.85rem;
            color: #10b981; 
            margin-top: 0.5rem;
            font-weight: 500;
        }

        /* Step Indicator Styles */
        .step-indicator {
            display: flex;
            width: 100%;
            height: 4px; 
            background-color: #e0e0e0; 
            border-radius: 2px;
            overflow: hidden; 
            margin-top: 0.5rem; 
        }

        .step-indicator-progress {
            width: 33.33%; 
            height: 100%;
            background-color: #2563eb; 
            border-radius: 2px;
        }

        /* Added for textContent \n support */
        #encouragementMessage {
            white-space: pre-wrap;
            font-size: 1rem; /* Adjusted for consistency */
        }
        .hidden {
            display: none !important;
        }

        /* Accordion styles */
        .section-content {
            max-height: 1000px; /* Sufficiently large initial height */
            overflow: hidden;
            transition: max-height 0.5s ease-out;
            border-top: none; /* No border by default */
            margin-top: 0; /* No margin by default */
            /* Removed direct padding from here */
        }
        .section-content.collapsed {
            max-height: 0;
            /* Padding from inner div will also collapse */
            border-top: none; 
            margin-top: 0; 
        }
        .section-content:not(.collapsed) {
            border-top: 1px solid #f0f4f8; 
        }

        .section-content-inner { /* New inner div for content padding */
            padding: 1.5rem; /* Apply padding here */
        }

        .section-block.collapsible .section-title {
            cursor: pointer;
        }
        .section-block.collapsible .section-title .toggle-icon {
            transition: transform 0.3s ease;
            display: inline-block;
        }
        .section-block.collapsible .section-title.rotated .toggle-icon {
            transform: rotate(180deg);
        }
        .section-block.collapsible.confirmed .section-title .toggle-icon {
            display: none; 
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen flex items-center justify-center">
    <div class="container">
        <!-- Header -->
        <header class="flex items-center justify-between p-4 bg-white border-b border-gray-200">
            <a href="/foreign0" class="flex items-center text-blue-700 font-medium text-base hover:text-blue-800 transition-colors duration-300">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M15 19l-7-7 7-7" />
                </svg>
                í™ˆìœ¼ë¡œ
            </a>
            <h1 class="text-xl font-bold text-gray-800">ë³¸ì¸í™•ì¸</h1>
            <button class="p-2 rounded-full text-gray-500 hover:bg-gray-100 transition-colors duration-300 opacity-0 cursor-default">
                <!-- Placeholder for symmetry, or add a relevant icon if needed -->
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M12 4.354v15.304m0 0l-6.5-6.5m6.5 6.5l6.5-6.5" />
                </svg>
            </button>
        </header>

        <!-- Step Indicator -->
        <div class="step-indicator mx-4 mt-4">
            <div class="step-indicator-progress"></div>
        </div>

        <!-- Main Content Area -->
        <main class="main-content">
            <!-- ì‘ì› ë¬¸êµ¬ -->
            <div id="encouragementMessage" class="text-center text-base font-semibold text-gray-700 p-3 rounded-lg bg-yellow-100 mx-0 mt-0 shadow-sm" style="white-space: pre-wrap;">
                <!-- ë©”ì‹œì§€ëŠ” JavaScriptì— ì˜í•´ ë™ì ìœ¼ë¡œ ì„¤ì •ë©ë‹ˆë‹¤. -->
            </div>

            <!-- íœ´ëŒ€í° ì¸ì¦ ì„¹ì…˜ -->
            <div id="phoneAuthSection" class="section-block collapsible">
                <h2 class="section-title">
                    <span class="title-text">
                        íœ´ëŒ€í° ì¸ì¦
                        <span id="phoneCheckmark" class="checkmark">âœ”</span>
                    </span>
                    <svg id="phoneToggleIcon" class="toggle-icon h-5 w-5 text-gray-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7" />
                    </svg>
                </h2>
                <div id="phoneAuthContent" class="section-content">
                    <div class="section-content-inner">
                        <div class="form-group">
                            <label for="telecomProvider">í†µì‹ ì‚¬</label>
                            <select id="telecomProvider">
                                <option value="">í†µì‹ ì‚¬ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”</option>
                                <option value="SKT">SKT</option>
                                <option value="KT">KT</option>
                                <option value="LG U+">LG U+</option>
                                <option value="MVNO">ì•Œëœ°í°</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="phoneNumber">íœ´ëŒ€í° ë²ˆí˜¸</label>
                            <div class="input-with-button">
                                <input type="text" id="phoneNumber" placeholder="010-XXXX-XXXX" maxlength="13">
                                <button id="requestAuthCodeBtn" class="bg-blue-600 text-white hover:bg-blue-700">ì¸ì¦ë²ˆí˜¸ ìš”ì²­</button>
                            </div>
                        </div>
                        <div class="form-group hidden" id="authCodeGroup">
                            <label for="authCode">ì¸ì¦ë²ˆí˜¸</label>
                            <div class="input-with-button">
                                <input type="text" id="authCode" placeholder="ì¸ì¦ë²ˆí˜¸ 6ìë¦¬" maxlength="6">
                                <button id="verifyAuthCodeBtn" class="bg-gray-200 text-gray-700 hover:bg-gray-300">í™•ì¸</button>
                            </div>
                            <p id="authCodeTimer" class="text-sm text-gray-500 mt-2 text-center"></p>
                        </div>
                        <p id="phoneCertStatus" class="cert-status hidden text-center"></p>
                    </div>
                </div>
            </div>

            <!-- ê³„ì¢Œ ì¸ì¦ ì„¹ì…˜ -->
            <div id="accountAuthSection" class="section-block collapsible">
                <h2 class="section-title">
                    <span class="title-text">
                        ê³„ì¢Œ ì¸ì¦
                        <span id="accountCheckmark" class="checkmark">âœ”</span>
                    </span>
                    <svg id="accountToggleIcon" class="toggle-icon h-5 w-5 text-gray-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7" />
                    </svg>
                </h2>
                <div id="accountAuthContent" class="section-content">
                    <div class="section-content-inner">
                        <div class="form-group">
                            <label for="bankName">ì€í–‰</label>
                            <select id="bankName">
                                <option value="">ì€í–‰ì„ ì„ íƒí•´ì£¼ì„¸ìš”</option>
                                <option value="êµ­ë¯¼ì€í–‰">êµ­ë¯¼ì€í–‰</option>
                                <option value="ì‹ í•œì€í–‰">ì‹ í•œì€í–‰</option>
                                <option value="ìš°ë¦¬ì€í–‰">ìš°ë¦¬ì€í–‰</option>
                                <option value="í•˜ë‚˜ì€í–‰">í•˜ë‚˜ì€í–‰</option>
                                <option value="ë†í˜‘ì€í–‰">ë†í˜‘ì€í–‰</option>
                                <option value="ë¶€ì‚°ì€í–‰">ë¶€ì‚°ì€í–‰</option>
                                <option value="BNKê²½ë‚¨ì€í–‰">BNKê²½ë‚¨ì€í–‰</option>
                                <!-- ê¸°íƒ€ ì€í–‰ ì¶”ê°€ ê°€ëŠ¥ -->
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="accountNumber">ê³„ì¢Œë²ˆí˜¸</label>
                            <div class="input-with-button">
                                <input type="text" id="accountNumber" placeholder="ê³„ì¢Œë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”">
                                <button id="requestTransferBtn" class="bg-blue-600 text-white hover:bg-blue-700">1ì› ì†¡ê¸ˆ ìš”ì²­</button>
                            </div>
                        </div>
                        
                        <div class="form-group hidden" id="depositCodeGroup">
                            <label for="depositCode">ì…ê¸ˆìëª…</label>
                            <div class="input-with-button">
                                <input type="text" id="depositCode" placeholder="ì…ê¸ˆìëª… 3ìë¦¬ ìˆ«ìë¥¼ ì…ë ¥í•˜ì„¸ìš”" maxlength="3">
                                <button id="verifyDepositCodeBtn" class="bg-gray-200 text-gray-700 hover:bg-gray-300">í™•ì¸</button>
                            </div>
                            <p id="depositCodeTimer" class="text-sm text-gray-500 mt-2 text-center"></p>
                        </div>
                        <p id="accountCertStatus" class="cert-status hidden text-center"></p>
                    </div>
                </div>
            </div>
        </main>

        <!-- Fixed Bottom Bar -->
        <footer class="bottom-bar">
            <button id="prevButton" class="bg-gray-200 text-gray-700 hover:bg-gray-300">ì´ì „</button>
            <button id="nextButton" class="bg-blue-600 text-white hover:bg-blue-700">ë‹¤ìŒìœ¼ë¡œ</button>
        </footer>
    </div>

    <script>
        // --- DOM ìš”ì†Œ ì •ì˜ ---
        const homeButton = document.querySelector('header a');
        const prevButton = document.getElementById('prevButton');
        const nextButton = document.getElementById('nextButton');
        const encouragementMessageDiv = document.getElementById('encouragementMessage');

        // íœ´ëŒ€í° ì¸ì¦ ì„¹ì…˜
        const phoneAuthSection = document.getElementById('phoneAuthSection');
        const phoneAuthTitle = phoneAuthSection.querySelector('.section-title');
        const phoneCheckmark = document.getElementById('phoneCheckmark');
        const phoneAuthContent = document.getElementById('phoneAuthContent');
        const phoneToggleIcon = document.getElementById('phoneToggleIcon'); // SVG ì•„ì´ì½˜
        const telecomProviderSelect = document.getElementById('telecomProvider');
        const phoneNumberInput = document.getElementById('phoneNumber');
        const requestAuthCodeBtn = document.getElementById('requestAuthCodeBtn');
        const authCodeGroup = document.getElementById('authCodeGroup');
        const authCodeInput = document.getElementById('authCode');
        const verifyAuthCodeBtn = document.getElementById('verifyAuthCodeBtn');
        const authCodeTimer = document.getElementById('authCodeTimer');
        const phoneCertStatus = document.getElementById('phoneCertStatus');

        // ê³„ì¢Œ ì¸ì¦ ì„¹ì…˜
        const accountAuthSection = document.getElementById('accountAuthSection');
        const accountAuthTitle = accountAuthSection.querySelector('.section-title');
        const accountCheckmark = document.getElementById('accountCheckmark');
        const accountAuthContent = document.getElementById('accountAuthContent');
        const accountToggleIcon = document.getElementById('accountToggleIcon'); // SVG ì•„ì´ì½˜
        const bankNameSelect = document.getElementById('bankName');
        const accountNumberInput = document.getElementById('accountNumber');
        const requestTransferBtn = document.getElementById('requestTransferBtn');
        const depositCodeGroup = document.getElementById('depositCodeGroup');
        const depositCodeInput = document.getElementById('depositCode');
        const verifyDepositCodeBtn = document.getElementById('verifyDepositCodeBtn');
        const depositCodeTimer = document.getElementById('depositCodeTimer');
        const accountCertStatus = document.getElementById('accountCertStatus');


        // --- ìƒíƒœ ë³€ìˆ˜ ---
        let phoneAuthenticated = false;
        let accountAuthenticated = false;

        let phoneCountdownInterval;
        let accountCountdownInterval;

        let simulatedAuthCode = '123456'; // ì‹œë®¬ë ˆì´ì…˜ìš© íœ´ëŒ€í° ì¸ì¦ë²ˆí˜¸
        let simulatedDepositCode = ''; // ì‹œë®¬ë ˆì´ì…˜ìš© ê³„ì¢Œ ì…ê¸ˆìëª… (3ìë¦¬ ìˆ«ì)

        // localStorageì—ì„œ ì¶”ì¶œëœ ì •ë³´ëŠ” ì´ í˜ì´ì§€ì—ì„œ ì§ì ‘ ì‚¬ìš©ë˜ì§€ ì•Šì§€ë§Œ, ë‹¤ìŒ í˜ì´ì§€ë¥¼ ìœ„í•´ ìœ ì§€ë  ìˆ˜ ìˆìŒ
        const extractedUserInfo = JSON.parse(localStorage.getItem('extractedUserInfo')) || {
            name: 'ì •ë³´ ì—†ìŒ',
            dob: 'ì •ë³´ ì—†ìŒ',
            gender: 'ì •ë³´ ì—†ìŒ'
        };


        // --- ì´ˆê¸° UI ì„¤ì • í•¨ìˆ˜ ---
        function initializeUI() {
            // ì´ˆê¸°ì—ëŠ” ë‘ ì„¹ì…˜ ëª¨ë‘ ì—´ë ¤ìˆê²Œ ì„¤ì •
            phoneAuthContent.classList.remove('collapsed');
            phoneAuthTitle.classList.add('rotated'); // ìºëŸ¿ í‘œì‹œ
            accountAuthContent.classList.remove('collapsed');
            accountAuthTitle.classList.add('rotated'); // ìºëŸ¿ í‘œì‹œ
            
            // ëª¨ë“  ì¸ì¦ì´ ì™„ë£Œë˜ì§€ ì•Šì•˜ë‹¤ë©´ ì´ˆê¸° ë©”ì‹œì§€ ì„¤ì •
            updateNextButtonState(); 
        }

        // --- 'ë‹¤ìŒ' ë²„íŠ¼ í™œì„±í™”/ë¹„í™œì„±í™” ë° ì‘ì› ë©”ì‹œì§€ ì—…ë°ì´íŠ¸ í•¨ìˆ˜ ---
        function updateNextButtonState() {
            if (phoneAuthenticated && accountAuthenticated) {
                nextButton.disabled = false;
                nextButton.classList.remove('bg-gray-400', 'cursor-not-allowed');
                nextButton.classList.add('bg-blue-600', 'hover:bg-blue-700');
                // ë³€ê²½ëœ ë©”ì‹œì§€
                encouragementMessageDiv.textContent = 'ëª¨ë“  ë³¸ì¸ í™•ì¸ ì ˆì°¨ê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤! ğŸ‰\në‹¤ìŒ ë‹¨ê³„ë¡œ ì´ë™í•´ ì£¼ì„¸ìš” ğŸ˜„';
                // ë°°ê²½ìƒ‰ì€ ë…¸ë€ìƒ‰ìœ¼ë¡œ ìœ ì§€
            } else {
                nextButton.disabled = true;
                nextButton.classList.add('bg-gray-400', 'cursor-not-allowed');
                nextButton.classList.remove('bg-blue-600', 'hover:bg-blue-700');
                // ëª¨ë“  ì¸ì¦ì´ ì™„ë£Œë˜ì§€ ì•Šì•˜ë‹¤ë©´, í•­ìƒ ì´ ì´ˆê¸° ë©”ì‹œì§€ë¥¼ í‘œì‹œ
                encouragementMessageDiv.textContent = 'ë³¸ì¸ í™•ì¸ì˜ ë§ˆì§€ë§‰ ë‹¨ê³„ì…ë‹ˆë‹¤.\nì¡°ê¸ˆë§Œ ë” í˜ë‚´ì£¼ì„¸ìš”! ğŸ’ª';
                // ë°°ê²½ìƒ‰ì€ ë…¸ë€ìƒ‰ìœ¼ë¡œ ìœ ì§€
            }
        }

        // --- ì¸ì¦ë²ˆí˜¸/ì…ê¸ˆìëª… íƒ€ì´ë¨¸ ê³µí†µ í•¨ìˆ˜ ---
        function startTimer(timerElement, buttonToDisable, buttonToEnable, duration, onExpireCallback) {
            let timer = duration;
            // ëª¨ë“  íƒ€ì´ë¨¸ clearInterval í˜¸ì¶œí•˜ì—¬ í˜¼ë™ ë°©ì§€ (ë™ì‹œì— ì—¬ëŸ¬ íƒ€ì´ë¨¸ê°€ ëŒì§€ ì•Šë„ë¡)
            clearInterval(phoneCountdownInterval); 
            clearInterval(accountCountdownInterval);

            let currentInterval;
            if (timerElement === authCodeTimer) {
                currentInterval = setInterval(updateTimer, 1000);
                phoneCountdownInterval = currentInterval; // ì˜¬ë°”ë¥¸ ë³€ìˆ˜ì— í• ë‹¹
            } else if (timerElement === depositCodeTimer) {
                currentInterval = setInterval(updateTimer, 1000);
                accountCountdownInterval = currentInterval; // ì˜¬ë°”ë¥¸ ë³€ìˆ˜ì— í• ë‹¹
            }
            
            timerElement.classList.remove('hidden');
            buttonToDisable.disabled = true;
            buttonToDisable.classList.add('bg-gray-400', 'cursor-not-allowed');
            buttonToDisable.classList.remove('bg-blue-600', 'hover:bg-blue-700');

            function updateTimer() {
                const minutes = parseInt(timer / 60, 10);
                const seconds = parseInt(timer % 60, 10);

                timerElement.textContent = `ë‚¨ì€ ì‹œê°„: ${minutes < 10 ? "0" + minutes : minutes}:${seconds < 10 ? "0" + seconds : seconds}`;

                if (--timer < 0) {
                    clearInterval(currentInterval); // í•´ë‹¹ íƒ€ì´ë¨¸ë§Œ ì¤‘ì§€
                    timerElement.textContent = 'ì¸ì¦ ì‹œê°„ì´ ë§Œë£Œë˜ì—ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ìš”ì²­í•´ì£¼ì„¸ìš”.';
                    timerElement.style.color = '#ef4444'; // Red color
                    buttonToEnable.disabled = false;
                    buttonToEnable.classList.remove('bg-gray-400', 'cursor-not-allowed');
                    buttonToEnable.classList.add('bg-blue-600', 'hover:bg-blue-700');
                    if (onExpireCallback) {
                        onExpireCallback();
                    }
                }
            }
        }

        // --- íœ´ëŒ€í° ë²ˆí˜¸ ìë™ í¬ë§·íŒ… í•¨ìˆ˜ ---
        phoneNumberInput.addEventListener('input', (event) => {
            let value = event.target.value.replace(/[^0-9]/g, ''); // ìˆ«ì ì´ì™¸ì˜ ë¬¸ì ì œê±°
            let formattedValue = '';

            if (value.startsWith('010')) {
                if (value.length > 10) {
                    formattedValue = value.substring(0, 3) + '-' + value.substring(3, 7) + '-' + value.substring(7, 11);
                } else if (value.length > 6) {
                    formattedValue = value.substring(0, 3) + '-' + value.substring(3, 7) + '-' + value.substring(7);
                } else if (value.length > 3) {
                    formattedValue = value.substring(0, 3) + '-' + value.substring(3);
                } else {
                    formattedValue = value;
                }
            } else {
                formattedValue = value;
            }

            event.target.value = formattedValue.substring(0, 13);
        });

        // --- ì•„ì½”ë””ì–¸ í† ê¸€ í•¨ìˆ˜ ---
        function toggleAccordion(contentElement, titleElement, toggleIconElement, sectionBlockElement) {
            // ì´ë¯¸ ì¸ì¦ ì™„ë£Œëœ ì„¹ì…˜ì€ í´ë¦­í•´ë„ í† ê¸€ë˜ì§€ ì•ŠìŒ
            if (sectionBlockElement.classList.contains('confirmed')) {
                return;
            }
            contentElement.classList.toggle('collapsed');
            titleElement.classList.toggle('rotated');
            if (contentElement.classList.contains('collapsed')) {
                toggleIconElement.classList.remove('rotated'); // ì•„ì´ì½˜ì´ ì•„ë˜ë¥¼ ë³´ë„ë¡
            } else {
                toggleIconElement.classList.add('rotated'); // ì•„ì´ì½˜ì´ ìœ„ë¥¼ ë³´ë„ë¡
            }
        }

        // --- ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ ---

        // íœ´ëŒ€í° ì¸ì¦ë²ˆí˜¸ ìš”ì²­ ë²„íŠ¼
        requestAuthCodeBtn.addEventListener('click', () => {
            const telecom = telecomProviderSelect.value;
            const phoneNum = phoneNumberInput.value;

            if (!telecom || !phoneNum) {
                alert('í†µì‹ ì‚¬ì™€ íœ´ëŒ€í° ë²ˆí˜¸ë¥¼ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }

            const phoneRegex = /^010-\d{4}-\d{4}$/;
            if (!phoneRegex.test(phoneNum)) {
                alert('ìœ íš¨í•œ íœ´ëŒ€í° ë²ˆí˜¸ í˜•ì‹ì„ ì…ë ¥í•´ì£¼ì„¸ìš” (ì˜ˆ: 010-XXXX-XXXX)');
                return;
            }

            // ìƒˆë¡œìš´ ì¸ì¦ë²ˆí˜¸ ìƒì„±
            simulatedAuthCode = Math.floor(100000 + Math.random() * 900000).toString(); 

            authCodeGroup.classList.remove('hidden');
            verifyAuthCodeBtn.disabled = false;
            verifyAuthCodeBtn.classList.remove('bg-gray-200', 'cursor-not-allowed');
            verifyAuthCodeBtn.classList.add('bg-blue-600', 'hover:bg-blue-700');
            
            // 3ì´ˆ í›„ ì¸ì¦ë²ˆí˜¸ ìë™ ì…ë ¥ (ë©”ì‹œì§€ ì—†ìŒ)
            setTimeout(() => {
                authCodeInput.value = simulatedAuthCode;
                authCodeTimer.textContent = ''; // ë©”ì‹œì§€ ì œê±°
                authCodeTimer.style.color = ''; // ìŠ¤íƒ€ì¼ ì´ˆê¸°í™”
                clearInterval(phoneCountdownInterval); // íƒ€ì´ë¨¸ ì¤‘ì§€
                requestAuthCodeBtn.disabled = true; // ìš”ì²­ ë²„íŠ¼ ë¹„í™œì„±í™”
                requestAuthCodeBtn.classList.add('bg-gray-400', 'cursor-not-allowed');
                requestAuthCodeBtn.classList.remove('bg-blue-600', 'hover:bg-blue-700');
            }, 3000); // 3ì´ˆ (3000 ë°€ë¦¬ì´ˆ) ì§€ì—°

            startTimer(authCodeTimer, requestAuthCodeBtn, requestAuthCodeBtn, 180, () => {
                // ì´ ì½œë°±ì€ íƒ€ì´ë¨¸ê°€ 0ì´ ë  ë•Œ ì‹¤í–‰ë˜ì§€ë§Œ, ìë™ ì…ë ¥ë˜ë©´ ì´ë¯¸ ì¤‘ì§€ë¨
                // ë§Œì•½ ìë™ ì…ë ¥ ì „ì— íƒ€ì´ë¨¸ê°€ ë§Œë£Œë˜ë©´ ì´ ë©”ì‹œì§€ê°€ í‘œì‹œë¨
                if (!phoneAuthenticated) { // ì´ë¯¸ ì¸ì¦ë˜ì§€ ì•Šì€ ê²½ìš°ì—ë§Œ íƒ€ì´ë¨¸ ë§Œë£Œ ì²˜ë¦¬
                    verifyAuthCodeBtn.disabled = true; 
                    verifyAuthCodeBtn.classList.add('bg-gray-400', 'cursor-not-allowed');
                    verifyAuthCodeBtn.classList.remove('bg-blue-600', 'hover:bg-blue-700');
                }
            }); 
        });

        // íœ´ëŒ€í° ì¸ì¦ë²ˆí˜¸ í™•ì¸ ë²„íŠ¼
        verifyAuthCodeBtn.addEventListener('click', () => {
            const enteredCode = authCodeInput.value;

            if (enteredCode === simulatedAuthCode) {
                clearInterval(phoneCountdownInterval); 
                authCodeTimer.classList.add('hidden');
                phoneCertStatus.textContent = 'íœ´ëŒ€í° ì¸ì¦ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤. âœ…';
                phoneCertStatus.style.color = '#10b981';
                phoneCertStatus.classList.remove('hidden');
                
                // UI ì ê¸ˆ
                verifyAuthCodeBtn.disabled = true;
                verifyAuthCodeBtn.classList.add('bg-gray-400', 'cursor-not-allowed');
                verifyAuthCodeBtn.classList.remove('bg-blue-600', 'hover:bg-blue-700');

                requestAuthCodeBtn.disabled = true; 
                requestAuthCodeBtn.classList.add('bg-gray-400', 'cursor-not-allowed');
                requestAuthCodeBtn.classList.remove('bg-blue-600', 'hover:bg-blue-700');
                
                telecomProviderSelect.disabled = true; 
                phoneNumberInput.disabled = true; 
                authCodeInput.disabled = true; 

                phoneAuthenticated = true;
                updateNextButtonState();
                
                // ì¸ì¦ ì™„ë£Œ ë©”ì‹œì§€ í‘œì‹œ í›„ 1ì´ˆ ë’¤ ì•„ì½”ë””ì–¸ ë‹«ê¸°
                setTimeout(() => {
                    phoneAuthContent.classList.add('collapsed'); 
                    phoneAuthTitle.classList.remove('rotated'); // ìºëŸ¿ ìˆ¨ê¸°ê¸°
                    phoneCheckmark.style.display = 'inline-block'; // ì²´í¬ í‘œì‹œ ë³´ì´ê¸°
                    phoneAuthSection.classList.add('confirmed'); // ì¸ì¦ ì™„ë£Œ ìƒíƒœ í´ë˜ìŠ¤ ì¶”ê°€
                }, 1000); // 1ì´ˆ (1000 ë°€ë¦¬ì´ˆ) ì§€ì—°
            } else {
                alert('ì¸ì¦ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ë‹¤ì‹œ í™•ì¸í•´ì£¼ì„¸ìš”.');
                authCodeInput.value = '';
            }
        });

        // 1ì› ì†¡ê¸ˆ ìš”ì²­ ë²„íŠ¼
        requestTransferBtn.addEventListener('click', () => {
            const bank = bankNameSelect.value;
            const account = accountNumberInput.value;

            if (!bank || !account) {
                alert('ì€í–‰ê³¼ ê³„ì¢Œë²ˆí˜¸ë¥¼ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }

            if (!/^\d+$/.test(account)) {
                alert('ìœ íš¨í•œ ê³„ì¢Œë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš” (ìˆ«ìë§Œ ì…ë ¥).');
                return;
            }

            // ìƒˆë¡œìš´ ì…ê¸ˆìëª… ìƒì„±
            simulatedDepositCode = Math.floor(100 + Math.random() * 900).toString(); 

            depositCodeGroup.classList.remove('hidden');
            verifyDepositCodeBtn.disabled = false;
            verifyDepositCodeBtn.classList.remove('bg-gray-200', 'cursor-not-allowed');
            verifyDepositCodeBtn.classList.add('bg-blue-600', 'hover:bg-blue-700');

            // 3ì´ˆ í›„ ì…ê¸ˆìëª… ìë™ ì…ë ¥ (ë©”ì‹œì§€ ì—†ìŒ)
            setTimeout(() => {
                depositCodeInput.value = simulatedDepositCode;
                depositCodeTimer.textContent = ''; // ë©”ì‹œì§€ ì œê±°
                depositCodeTimer.style.color = ''; // ìŠ¤íƒ€ì¼ ì´ˆê¸°í™”
                clearInterval(accountCountdownInterval); // íƒ€ì´ë¨¸ ì¤‘ì§€
                requestTransferBtn.disabled = true; // ìš”ì²­ ë²„íŠ¼ ë¹„í™œì„±í™”
                requestTransferBtn.classList.add('bg-gray-400', 'cursor-not-allowed');
                requestTransferBtn.classList.remove('bg-blue-600', 'hover:bg-blue-700');
            }, 3000); // 3ì´ˆ (3000 ë°€ë¦¬ì´ˆ) ì§€ì—°

            startTimer(depositCodeTimer, requestTransferBtn, requestTransferBtn, 180, () => {
                // ì´ ì½œë°±ì€ íƒ€ì´ë¨¸ê°€ 0ì´ ë  ë•Œ ì‹¤í–‰ë˜ì§€ë§Œ, ìë™ ì…ë ¥ë˜ë©´ ì´ë¯¸ ì¤‘ì§€ë¨
                if (!accountAuthenticated) { // ì´ë¯¸ ì¸ì¦ë˜ì§€ ì•Šì€ ê²½ìš°ì—ë§Œ íƒ€ì´ë¨¸ ë§Œë£Œ ì²˜ë¦¬
                    verifyDepositCodeBtn.disabled = true;
                    verifyDepositCodeBtn.classList.add('bg-gray-400', 'cursor-not-allowed');
                    verifyDepositCodeBtn.classList.remove('bg-blue-600', 'hover:bg-blue-700');
                }
            });
        });

        // ì…ê¸ˆìëª… í™•ì¸ ë²„íŠ¼
        verifyDepositCodeBtn.addEventListener('click', () => {
            const enteredCode = depositCodeInput.value;

            if (enteredCode === simulatedDepositCode) {
                clearInterval(accountCountdownInterval); 
                depositCodeTimer.classList.add('hidden');
                accountCertStatus.textContent = 'ê³„ì¢Œ ì¸ì¦ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤. âœ…';
                accountCertStatus.style.color = '#10b981';
                accountCertStatus.classList.remove('hidden');
                
                // UI ì ê¸ˆ
                bankNameSelect.disabled = true;
                accountNumberInput.disabled = true;
                requestTransferBtn.disabled = true;
                requestTransferBtn.classList.add('bg-gray-400', 'cursor-not-allowed');
                requestTransferBtn.classList.remove('bg-blue-600', 'hover:bg-blue-700');
                depositCodeInput.disabled = true;
                verifyDepositCodeBtn.disabled = true;
                verifyDepositCodeBtn.classList.add('bg-gray-400', 'cursor-not-allowed');
                verifyDepositCodeBtn.classList.remove('bg-blue-600', 'hover:bg-blue-700');

                accountAuthenticated = true;
                updateNextButtonState();
                
                // ì¸ì¦ ì™„ë£Œ ë©”ì‹œì§€ í‘œì‹œ í›„ 1ì´ˆ ë’¤ ì•„ì½”ë””ì–¸ ë‹«ê¸°
                setTimeout(() => {
                    accountAuthContent.classList.add('collapsed'); 
                    accountAuthTitle.classList.remove('rotated'); // ìºëŸ¿ ìˆ¨ê¸°ê¸°
                    accountCheckmark.style.display = 'inline-block'; // ì²´í¬ í‘œì‹œ ë³´ì´ê¸°
                    accountAuthSection.classList.add('confirmed'); // ì¸ì¦ ì™„ë£Œ ìƒíƒœ í´ë˜ìŠ¤ ì¶”ê°€
                }, 1000); // 1ì´ˆ (1000 ë°€ë¦¬ì´ˆ) ì§€ì—°
            } else {
                alert('ì…ê¸ˆìëª…ì´ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ë‹¤ì‹œ í™•ì¸í•´ì£¼ì„¸ìš”.');
                depositCodeInput.value = '';
            }
        });

        // --- ë‚´ë¹„ê²Œì´ì…˜ ë²„íŠ¼ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ---
        homeButton.addEventListener('click', function(event) {
            event.preventDefault();
            window.location.href = '/foreign0';
        });

        prevButton.addEventListener('click', function() {
            window.location.href = '/foreign3'; // ì´ì „ í˜ì´ì§€ë¡œ ì´ë™ (ì‹ ë¶„ì¦ ì´¬ì˜ í˜ì´ì§€)
        });

        nextButton.addEventListener('click', function() {
            if (phoneAuthenticated && accountAuthenticated) {
                window.location.href = '/foreign5'; // ë‹¤ìŒ ë‹¨ê³„ í˜ì´ì§€ë¡œ ì´ë™ (ìƒˆë¡œìš´ foreign5 í˜ì´ì§€)
            } else {
                alert('ëª¨ë“  ë³¸ì¸ í™•ì¸ ì ˆì°¨(íœ´ëŒ€í°, ê³„ì¢Œ)ë¥¼ ì™„ë£Œí•´ì•¼ ë‹¤ìŒ ë‹¨ê³„ë¡œ ì§„í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
            }
        });

        // ì„¹ì…˜ ì œëª© í´ë¦­ ì‹œ ì•„ì½”ë””ì–¸ í† ê¸€ (ì¸ì¦ ì™„ë£Œ ìƒíƒœê°€ ì•„ë‹ ë•Œë§Œ)
        phoneAuthTitle.addEventListener('click', () => {
            toggleAccordion(phoneAuthContent, phoneAuthTitle, phoneToggleIcon, phoneAuthSection);
        });
        accountAuthTitle.addEventListener('click', () => {
            toggleAccordion(accountAuthContent, accountAuthTitle, accountToggleIcon, accountAuthSection);
        });


        // DOMContentLoaded ì´ë²¤íŠ¸ ë°œìƒ ì‹œ UI ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', initializeUI);
    </script>
</body>
</html>
