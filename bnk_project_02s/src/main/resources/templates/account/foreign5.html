<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>BNK 쇼핑환전통장 - 상품 가입</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
  <style>
    body { font-family:'Inter',sans-serif; background:#f0f4f8; margin:0; overflow-x:hidden; }
    .container {
      max-width:500px; margin:0 auto; background:#fff; min-height:100vh; display:flex; flex-direction:column;
      border-radius:1rem; box-shadow:0 4px 12px rgba(0,0,0,.05); overflow:hidden;
    }
    header { flex:none; }
    .bottom-bar {
      flex:none; width:100%; background:#fff; border-top:1px solid #e2e8f0; padding:.75rem 1rem; gap:.5rem;
      box-shadow:0 -4px 12px rgba(0,0,0,.03); display:flex; justify-content:space-around; z-index:10;
    }
    .bottom-bar button { flex:1; padding:.75rem 1rem; border-radius:.75rem; font-weight:600; font-size:.95rem; transition:.2s; box-shadow:0 2px 6px rgba(0,0,0,.1); }
    .bottom-bar button:active { transform:scale(.98); }

    .main-content { flex:1; padding:.75rem; display:flex; flex-direction:column; gap:1rem; overflow-y:auto; }
    .section-block { background:#fff; border-radius:.75rem; box-shadow:0 4px 12px rgba(0,0,0,.05); display:flex; flex-direction:column; overflow:hidden; }
    .section-title { font-size:1rem; font-weight:600; color:#374151; display:flex; align-items:center; justify-content:space-between; padding:1.5rem; }
    .section-title .checkmark { color:#10b981; font-size:1.2rem; margin-left:.5rem; display:none; }
    .section-title .title-text { display:flex; align-items:center; flex:1; }
    .form-group { margin-bottom:1rem; }
    .form-group label { display:block; font-size:.9rem; font-weight:500; color:#4b5563; margin-bottom:.5rem; }
    .form-group input, .form-group select {
      width:100%; padding:.75rem 1rem; border:1px solid #d1d5db; border-radius:.5rem; font-size:1rem; color:#374151; background:#f9fafb;
    }
    .form-group input:focus, .form-group select:focus { outline:none; border-color:#2563eb; box-shadow:0 0 0 2px rgba(37,99,235,.2); }
    .form-group input[readonly]{ background:#e5e7eb; cursor:not-allowed; }
    #encouragementMessage { white-space:pre-wrap; font-size:1rem; }

    .section-content { max-height:1000px; overflow:hidden; transition:max-height .5s ease-out; }
    .section-content.collapsed { max-height:0; }
    .section-content-inner { padding:1.5rem; }
    .section-block.collapsible .section-title { cursor:pointer; }
    .section-block.collapsible .section-title .toggle-icon { transition:transform .3s ease; display:inline-block; }
    .section-block.collapsible .section-title.rotated .toggle-icon { transform:rotate(180deg); }
    .section-block.collapsible.confirmed .section-title .toggle-icon { display:none; }

    /* Step bar */
    .step-indicator { display:flex; width:100%; height:4px; background:#e0e0e0; border-radius:2px; overflow:hidden; margin-top:.5rem; }
    .step-indicator-progress { width:66.66%; height:100%; background:#2563eb; }

    /* MODAL (Full-screen style) */
    .modal-overlay {
      position:fixed; inset:0; background:rgba(0,0,0,.6);
      display:flex; align-items:center; justify-content:center; z-index:1000;
      opacity:0; visibility:hidden; transition:opacity .3s ease, visibility .3s ease;
    }
    .modal-overlay.active { opacity:1; visibility:visible; }
    .modal-content {
      background:#fff; border-radius:.75rem; box-shadow:0 8px 20px rgba(0,0,0,.2);
      width:96vw; height:92vh; display:flex; flex-direction:column; overflow:hidden;
      transform:translateY(20px); transition:transform .3s ease;
    }
    .modal-overlay.active .modal-content { transform:translateY(0); }
    .modal-header { padding:1rem 1.25rem; border-bottom:1px solid #e2e8f0; display:flex; justify-content:space-between; align-items:center; font-weight:600; color:#374151; }
    .modal-body { flex:1; padding:0; overflow:hidden; }
    .modal-footer { padding:.75rem 1.25rem; border-top:1px solid #e2e8f0; display:flex; justify-content:center; gap:1rem; }
    .modal-close-button { background:none; border:none; font-size:1.5rem; color:#9ca3af; cursor:pointer; line-height:1; }
    .modal-close-button:hover { color:#4b5563; }
    .modal-button { padding:.75rem 1.5rem; border-radius:.5rem; font-weight:600; font-size:.95rem; transition:background-color .2s ease, transform .2s ease; }
    .modal-button.primary { background:#2563eb; color:#fff; border:none; }
    .modal-button.primary:hover { background:#1d4ed8; }

    /* Terms pages fill modal height */
    .terms-page { display:none; height:100%; flex-direction:column; }
    .terms-page.active { display:flex; height:100%; }

    /* Summary page scrollable */
    .summary-scroll { padding:1rem 1.25rem; overflow:auto; -webkit-overflow-scrolling:touch; flex-grow: 1; }
    .summary-list { list-style:none; padding:0; margin:0; }
    .summary-list li {
      background:#fff;
      border:2px solid #3b82f6;
      border-radius:.75rem;
      padding:1rem; margin-bottom:.75rem; color:#4b5563; line-height:1.5;
      box-shadow:0 2px 8px rgba(0,0,0,.08);
    }
    .summary-num { font-weight:800; color:#111827; margin-right:.5rem; }
    .summary-title { font-weight:700; color:#111827; }
    .summary-content { display:block; margin-top:.35rem; }

    /* PDF viewer fills remaining space */
    .pdf-viewer-iframe {
      flex:1 1 auto;
      width:100%;
      height:100%; /* Ensures it takes full available height within its flex container */
      border: 1px solid #e0e0e0; /* Subtle border for better visual separation */
      border-radius: .5rem; /* Rounded corners */
      box-shadow: 0 2px 8px rgba(0,0,0,.05); /* Soft shadow */
      background-color: #fff; /* Explicitly white background */
    }

    /* Custom scrollable content within list item */
    .scrollable-content-wrapper {
      max-height: 70vh; /* Increased height for customer check item 4 scroll */
      overflow-y: auto;
      padding-right: 0.5rem;
      margin-top: 0.5rem;
    }
    .scrollable-content-wrapper p,
    .scrollable-content-wrapper ul {
      margin-bottom: 0.75rem;
    }
    .scrollable-content-wrapper p:last-child,
    .scrollable-content-wrapper ul:last-child {
      margin-bottom: 0;
    }
    .scrollable-content-wrapper h4 {
      font-weight: 600;
      color: #1f2937;
      margin-bottom: 0.5rem;
      margin-top: 1rem;
      text-align: center; /* Contract title center alignment */
    }
    .scrollable-content-wrapper h4:first-child {
      margin-top: 0;
    }

    /* Grouped content box style */
    .grouped-content-box {
        background:#fff;
        border:2px solid #3b82f6;
        border-radius:.75rem;
        padding:1rem;
        margin-bottom:0.75rem;
        box-shadow:0 2px 8px rgba(0,0,0,.08);
    }
    .grouped-content-box h4 {
      margin-top: 0 !important;
    }
    .grouped-content-box ul {
      margin-left: 1.25rem;
      list-style: disc;
    }
    .grouped-content-box ul li {
        border: none;
        box-shadow: none;
        background: none;
        padding: 0;
        margin-bottom: 0.25rem;
    }
    .grouped-content-box ul li:last-child {
        margin-bottom: 0;
    }
  </style>
</head>
<body class="bg-gray-100 min-h-screen flex items-center justify-center">
  <div class="container">
    <!-- Header -->
    <header class="flex items-center justify-between p-4 bg-white border-b border-gray-200">
      <a href="/foreign0" class="flex items-center text-blue-700 font-medium text-base hover:text-blue-800 transition-colors duration-300">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
          <path stroke-linecap="round" stroke-linejoin="round" d="M15 19l-7-7 7-7"/>
        </svg>
        홈으로
      </a>
      <h1 class="text-xl font-bold text-gray-800">상품 가입</h1>
      <span class="w-5 h-5 opacity-0"></span>
    </header>

    <!-- Step -->
    <div class="step-indicator mx-4 mt-4"><div class="step-indicator-progress"></div></div>

    <!-- Main -->
    <main class="main-content">
      <div id="encouragementMessage" class="text-center text-base font-semibold text-gray-700 p-3 rounded-lg bg-yellow-100 mx-0 mt-0 shadow-sm"></div>

      <!-- 동의 섹션 -->
      <div id="agreementConsentSection" class="section-block collapsible">
        <h2 class="section-title">
          <span class="title-text">가입 관련 동의 <span id="agreementConsentCheckmark" class="checkmark">✔</span></span>
          <svg id="agreementConsentToggleIcon" class="toggle-icon h-5 w-5 text-gray-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7"/></svg>
        </h2>
        <div id="agreementConsentContent" class="section-content">
          <div class="section-content-inner">
            <button id="openTermsModalBtn" class="w-full bg-blue-500 text-white py-3 rounded-lg font-semibold mb-3 hover:bg-blue-600 transition-colors">약관 및 설명서 동의</button>
            <button id="openCustomerCheckModalBtn" class="w-full bg-blue-500 text-white py-3 rounded-lg font-semibold hover:bg-blue-600 transition-colors">고객 확인 사항 확인</button>
          </div>
        </div>
      </div>

      <!-- 가입 내용 -->
      <div id="enrollmentContentSection" class="section-block collapsible collapsed">
        <h2 class="section-title">
          <span class="title-text">가입 내용 <span id="enrollmentContentCheckmark" class="checkmark hidden">✔</span></span>
          <svg id="enrollmentContentToggleIcon" class="toggle-icon h-5 w-5 text-gray-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7"/></svg>
        </h2>
        <div id="enrollmentContentInner" class="section-content">
          <div class="section-content-inner">
            <div class="form-group">
              <label for="enrollmentAmount">가입 금액</label>
              <input type="number" id="enrollmentAmount" placeholder="가입 금액을 입력해주세요">
            </div>
            <div class="form-group">
              <label for="currencySelect">통화 선택</label>
              <select id="currencySelect">
                <option value="">통화를 선택해주세요</option>
                <option value="USD">USD - 미국 달러</option>
                <option value="JPY">JPY - 일본 엔</option>
                <option value="EUR">EUR - 유로</option>
                <option value="GBP">GBP - 영국 파운드</option>
                <option value="CNY">CNY - 중국 위안</option>
                <option value="KRW">KRW - 대한민국 원</option>
              </select>
            </div>
            <div class="form-group">
              <label for="withdrawalEstimate">원화출금 예상액 조회</label>
              <input type="text" id="withdrawalEstimate" placeholder="조회하기 버튼을 눌러주세요" readonly>
              <button id="lookupEstimateBtn" class="w-full bg-gray-200 text-gray-700 py-2 mt-2 rounded-lg font-semibold hover:bg-gray-300 transition-colors">조회하기</button>
            </div>
            <div class="form-group">
              <label for="withdrawalAccount">출금 계좌</label>
              <!-- 출금 계좌를 입력 필드로 변경 및 readonly 설정 -->
              <input type="text" id="withdrawalAccount" value="BNK부산은행 112-4567-7890-01" readonly class="bg-gray-200 cursor-not-allowed">
            </div>
          </div>
        </div>
      </div>
    </main>

    <!-- Bottom -->
    <footer class="bottom-bar">
      <button id="prevButton" class="bg-gray-200 text-gray-700 hover:bg-gray-300">이전</button>
      <button id="nextButton" class="bg-gray-400 text-white cursor-not-allowed" disabled>다음으로</button>
    </footer>
  </div>

  <!-- 약관/설명서 모달 -->
  <div id="termsModal" class="modal-overlay hidden">
    <div class="modal-content">
      <div class="modal-header">
        <h3 id="termsModalTitle">약관 및 설명서 동의</h3>
        <button class="modal-close-button" onclick="closeModal('termsModal')">&times;</button>
      </div>
      <div class="modal-body">
        <!-- Page 1: 요약본 -->
        <div id="termsPage1" class="terms-page active">
          <div class="summary-scroll">
            <h4 class="font-bold text-gray-800 text-lg mb-4 text-center">요약본</h4>
            <ol class="summary-list">
              <li>
                <span class="summary-num">1.</span>
                <span class="summary-title">상품별적용약관</span><br>
                <span class="summary-content">계좌 개설·거래의 기본 규칙, 이자/수수료 부과 기준, 전자금융 이용, 휴면·해지 절차, 분쟁처리와 약관 변경 통지 방법을 규정합니다.</span>
              </li>
              <li>
                <span class="summary-num">2.</span>
                <span class="summary-title">외화보통예금 상품설명서</span><br>
                <span class="summary-content">상품 개요와 가입대상, 예치·인출 방법, 금리 산정과 세금, 환율·수수료 및 위험, 예금자보호 범위, 중도해지 시 불이익 등을 안내합니다.</span>
              </li>
              <li>
                <span class="summary-num">3.</span>
                <span class="summary-title">설명의무관련확인서(차명거래금지)</span><br>
                <span class="summary-content">실명확인 의무 및 차명거래 금지와 그 제재에 대해 고지받았음을 확인하고, 관련 법규 준수에 동의한다는 내용을 담습니다.</span>
              </li>
              <li>
                <span class="summary-num">4.</span>
                <span class="summary-title">개인(신용)정보 수집·이용·제공·조회 동의서(비대면 안심차단)</span><br>
                <span class="summary-content">수집 항목과 이용 목적(본인확인·거래관리·법령 준수), 보유기간, 제3자 제공, 안심차단 서비스 안내, 동의/철회 방법을 명시합니다.</span>
              </li>
            </ol>
          </div>
        </div>

        <!-- Page 2 -->
        <div id="termsPage2" class="terms-page">
          <!-- H4 tag will be dynamically added here by JS for centering -->
          <iframe src="https://drive.google.com/file/d/1GClaAcMVQeXwKBSUZDZD-CrrCMWC2PJd/preview" class="pdf-viewer-iframe" allow="autoplay"></iframe>
        </div>

        <!-- Page 3 -->
        <div id="termsPage3" class="terms-page">
          <!-- H4 tag will be dynamically added here by JS for centering -->
          <iframe src="https://drive.google.com/file/d/15wwn9df-I70sL1TSLHv5m9KHFWOS1yuZ/preview" class="pdf-viewer-iframe" allow="autoplay"></iframe>
        </div>

        <!-- Page 4 -->
        <div id="termsPage4" class="terms-page">
          <!-- H4 tag will be dynamically added here by JS for centering -->
          <iframe src="https://drive.google.com/file/d/1iI2juipDYmW_Ok9c_VGhaHtXi8OEpGIC/preview" class="pdf-viewer-iframe" allow="autoplay"></iframe>
        </div>

        <!-- Page 5 -->
        <div id="termsPage5" class="terms-page">
          <!-- H4 tag will be dynamically added here by JS for centering -->
          <iframe src="https://drive.google.com/file/d/10RBKoscPB6Zz93y476Hg12GNZ44Le6tT/preview" class="pdf-viewer-iframe" allow="autoplay"></iframe>
        </div>
      </div>
      <div class="modal-footer">
        <button id="termsAgreeBtn" class="modal-button primary">동의하기</button>
      </div>
    </div>
  </div>

  <!-- 고객 확인 모달 - Part 1 -->
  <div id="customerCheckModal" class="modal-overlay hidden">
    <div class="modal-content">
      <div class="modal-header">
        <h3>고객 확인 사항 (1/2)</h3>
        <button class="modal-close-button" onclick="closeModal('customerCheckModal')">&times;</button>
      </div>
      <div class="modal-body">
        <div class="summary-scroll">
          <ul class="summary-list">
            <li>
              <span class="summary-num">1.</span>
              <span class="summary-title">예금자보호법</span><br>
              <span class="summary-content">본인이 가입하는 금융상품의 예금자보호 여부 및 보호한도(원금과 소정의 이자를 합하여 1인당 5천만원)에 대하여 설명을 보고, 충분히 이해하였음을 확인합니다.</span>
            </li>
            <li>
              <span class="summary-num">2.</span>
              <span class="summary-title">금융실명거래 및 비밀보장에 관한 법률</span><br>
              <span class="summary-content">제3조 제3항에 따라 불법재산의 은닉, 자금세탁행위, 공중협박, 자금조달행위 및 강제 집행의 면탈, 그 밖의 탈법 행위를 목적으로 타인의 실명으로 금융거래를 하여서는 아니되며, 이를 위반 시 5년 이하의 징역 또는 5천만원 이하의 벌금에 처할 수 있음을 고지받고 이해하였습니다.</span>
            </li>
            <li>
              <span class="summary-num">3.</span>
              <span class="summary-title">약관 및 상품설명서 이해</span><br>
              <span class="summary-content">금융회사는 「금융소비자보호에 관한 법률 (시행일 2021.03.25)」 제19조(설명의무)에 따라 예금상품의 중요한 사항을 소비자가 이해할 수 있도록 설명해야 하며, 동법 제23조(계약서류의 제공의무)에 따라 금융소비자에게 지체없이 제공해야 합니다. 본인은 약관 및 상품설명서의 주요내용에 대하여 충분히 이해하였습니다.</span>
            </li>
          </ul>
        </div>
      </div>
      <div class="modal-footer">
        <button id="customerCheckAgreeBtn" class="modal-button primary">모두 동의 (1 / 2)</button>
      </div>
    </div>
  </div>

  <!-- 고객 확인 모달 - Part 2 -->
  <div id="customerCheckModalPart2" class="modal-overlay hidden">
    <div class="modal-content">
      <div class="modal-header">
        <h3>고객 확인 사항 (2/2)</h3>
        <button class="modal-close-button" onclick="closeModal('customerCheckModalPart2')">&times;</button>
      </div>
      <div class="modal-body">
        <div class="summary-scroll">
          <ul class="summary-list">
            <li>
              <span class="summary-num">4.</span>
              <span class="summary-title">약관 및 상품설명서 수령 확인</span><br>
              <div class="scrollable-content-wrapper">
                <div class="grouped-content-box">
                  <h4 class="font-semibold text-gray-800">공통</h4>
                  <ul class="list-disc text-gray-700">
                    <li>민원처리 절차 및 분쟁조정</li>
                    <li>예금자보호여부 및 그 내용</li>
                    <li>계약의 해제, 해지 및 위법 계약 해지권</li>
                  </ul>
                </div>

                <div class="grouped-content-box mt-2">
                  <h4 class="font-semibold text-gray-800">예금성</h4>
                  <ul class="list-disc text-gray-700">
                    <li>계약기간, 이자의 지급시기 및 지급제한 사유</li>
                    <li>이자율(기본+우대), 중도해지이자율, 만기해지이자율, 만기후이자율, 수익률 및 산출근거 등</li>
                    <li>수수료 등 부대비용, 일반 금융소비자 계약해지 시 불이익</li>
                    <li>이용 제한사항(계좌이체 제한 등)</li> <!-- 추가된 내용 -->
                    <li>인용한 자료의 출처</li> <!-- 추가된 내용 -->
                  </ul>
                </div>

                <div class="grouped-content-box mt-2">
                  <h4 class="font-semibold text-gray-800">연계제휴</h4>
                  <ul class="list-disc text-gray-700">
                    <li>연계, 제휴서비스 등의 내용</li>
                    <li>연계, 제휴서비스 등의 이행책임에 관한 사항</li>
                    <li>연계, 제휴서비스 등의 제공기간</li>
                    <li>연계, 제휴서비스 등의 내용변경 및 그 사유 등을 일반금융소비자에게 알린다는 사실 및 그 고지방법 등 내용</li>
                  </ul>
                </div>
                <p class="summary-content mt-4 text-center">
                  본인은 약관 및 상품설명서를 제공받고<br>
                  그 내용을 충분히 이해하며<br>
                  본 상품에 가입함을 확인합니다.
                </p>
              </div>
            </li>
          </ul>
        </div>
      </div>
      <div class="modal-footer">
        <button id="customerCheckAgreeBtnPart2" class="modal-button primary">모두 동의 (2 / 2)</button>
      </div>
    </div>
  </div>

  <script>
    // DOM 요소 참조
    const homeButton = document.querySelector('header a');
    const prevButton = document.getElementById('prevButton');
    const nextButton = document.getElementById('nextButton');
    const encouragementMessageDiv = document.getElementById('encouragementMessage');

    const agreementConsentSection = document.getElementById('agreementConsentSection');
    const agreementConsentTitle = agreementConsentSection.querySelector('.section-title');
    const agreementConsentCheckmark = document.getElementById('agreementConsentCheckmark');
    const agreementConsentContent = document.getElementById('agreementConsentContent');
    const openTermsModalBtn = document.getElementById('openTermsModalBtn');
    const openCustomerCheckModalBtn = document.getElementById('openCustomerCheckModalBtn');

    const enrollmentContentSection = document.getElementById('enrollmentContentSection');
    const enrollmentContentTitle = enrollmentContentSection.querySelector('.section-title');
    const enrollmentContentCheckmark = document.getElementById('enrollmentContentCheckmark');
    const enrollmentContentInner = document.getElementById('enrollmentContentInner');

    const enrollmentAmountInput = document.getElementById('enrollmentAmount');
    const currencySelect = document.getElementById('currencySelect');
    const withdrawalEstimateInput = document.getElementById('withdrawalEstimate');
    const lookupEstimateBtn = document.getElementById('lookupEstimateBtn');
    const withdrawalAccountInput = document.getElementById('withdrawalAccount');

    const termsModal = document.getElementById('termsModal');
    const termsModalTitle = document.getElementById('termsModalTitle');
    const termsPages = document.querySelectorAll('.terms-page');
    const termsAgreeBtn = document.getElementById('termsAgreeBtn');

    const customerCheckModal = document.getElementById('customerCheckModal');
    const customerCheckAgreeBtn = document.getElementById('customerCheckAgreeBtn');
    const customerCheckModalPart2 = document.getElementById('customerCheckModalPart2');
    const customerCheckAgreeBtnPart2 = document.getElementById('customerCheckAgreeBtnPart2');


    // 상태 변수
    let isTermsAndExplanationsAgreed = false;
    let isCustomerCheckConfirmed = false;
    let isEnrollmentAmountFilled = false;
    let isCurrencySelected = false;
    let isWithdrawalEstimateLookedUp = false;
    let isWithdrawalAccountFilled = true; // 출금 계좌는 자동 입력되므로 기본값 true

    let termsCurrentPage = 0;

    // 약관 모달 페이지별 제목
    const termsBaseTitles = [
      '약관 및 설명서 요약',
      '상품별적용약관',
      '외화보통예금 상품설명서',
      '설명의무관련확인서(차명거래금지에 관한 설명)',
      '개인(신용)정보 수집이용제공조회동의서(비대면 계좌개설 안심차단)'
    ];

    /**
     * 초기 UI 상태 설정
     */
    function initializeUI() {
      encouragementMessageDiv.textContent = '중요한 내용이니 꼼꼼히 확인해 주세요! 😎';

      agreementConsentContent.classList.remove('collapsed');
      agreementConsentTitle.classList.add('rotated');

      enrollmentContentInner.classList.add('collapsed');
      enrollmentContentTitle.classList.remove('rotated'); 
      
      updateNextButtonState();
      updateAgreementConsentSectionStatus();
      updateAgreementButtonsState();
      updateEnrollmentContentStatus();
    }

    /**
     * '다음' 버튼 활성화/비활성화 상태 및 응원 메시지 업데이트
     */
    function updateNextButtonState() {
      if (isTermsAndExplanationsAgreed && isCustomerCheckConfirmed &&
          isEnrollmentAmountFilled && isCurrencySelected && isWithdrawalEstimateLookedUp) {
        nextButton.disabled = false;
        nextButton.classList.remove('bg-gray-400','cursor-not-allowed');
        nextButton.classList.add('bg-blue-600','hover:bg-blue-700');
        nextButton.textContent = '다음으로';
        // 두 번째 응원 문구 변경 및 줄바꿈 적용
        encouragementMessageDiv.textContent = '모든 정보가 입력되었습니다! 🎉\n마지막 단계로 이동해 주세요.';
      } else {
        nextButton.disabled = true;
        nextButton.classList.add('bg-gray-400','cursor-not-allowed');
        nextButton.classList.remove('bg-blue-600','hover:bg-blue-700');
        nextButton.textContent = '다음으로';
        encouragementMessageDiv.textContent = '중요한 내용이니 꼼꼼히 확인해 주세요! 😎';
      }
    }

    /**
     * 약관 및 고객 확인 버튼의 활성화/비활성화 상태를 개별적으로 관리
     */
    function updateAgreementButtonsState() {
      if (isTermsAndExplanationsAgreed) {
        openTermsModalBtn.disabled = true;
        openTermsModalBtn.classList.remove('bg-blue-500','hover:bg-blue-600');
        openTermsModalBtn.classList.add('bg-gray-400','cursor-not-allowed');
      } else {
        openTermsModalBtn.disabled = false;
        openTermsModalBtn.classList.add('bg-blue-500','hover:bg-blue-600');
        openTermsModalBtn.classList.remove('bg-gray-400','cursor-not-allowed');
      }

      if (isCustomerCheckConfirmed) {
        openCustomerCheckModalBtn.disabled = true;
        openCustomerCheckModalBtn.classList.remove('bg-blue-500','hover:bg-blue-600');
        openCustomerCheckModalBtn.classList.add('bg-gray-400','cursor-not-allowed');
      } else {
        openCustomerCheckModalBtn.disabled = false;
        openCustomerCheckModalBtn.classList.add('bg-blue-500','hover:bg-blue-600');
        openCustomerCheckModalBtn.classList.remove('bg-gray-400','cursor-not-allowed');
      }
    }

    /**
     * 모달창 열기
     * @param {string} id - 열고자 하는 모달의 ID
     */
    function openModal(id){ const el=document.getElementById(id); el.classList.add('active'); el.classList.remove('hidden'); }

    /**
     * 모달창 닫기
     * @param {string} id - 닫고자 하는 모달의 ID
     */
    function closeModal(id){ const el=document.getElementById(id); el.classList.remove('active'); setTimeout(()=>el.classList.add('hidden'),300); }

    /**
     * 약관 모달 페이지 전환
     * @param {number} idx - 보여줄 페이지의 인덱스
     */
    function showTermsPage(idx){
      termsPages.forEach((p,i)=>p.classList.toggle('active', i===idx));
      termsModalTitle.textContent = `약관 및 설명서 동의 (${idx + 1} / ${termsPages.length})`;

      const currentPageElement = termsPages[idx];
      const currentTitle = termsBaseTitles[idx];
      // 첫 페이지는 요약본이므로 기존 h4를 사용하고, 나머지 페이지에 h4를 동적으로 추가
      if (idx > 0 && !currentPageElement.querySelector('h4')) {
        const h4Element = document.createElement('h4');
        h4Element.classList.add('font-bold', 'text-gray-800', 'text-lg', 'mb-4', 'text-center'); // 가운데 정렬 추가
        h4Element.textContent = currentTitle;
        currentPageElement.prepend(h4Element);
      } else if (idx === 0) {
        // 첫 페이지의 기존 h4에도 가운데 정렬 적용
        currentPageElement.querySelector('h4').classList.add('text-center');
      }
      
      if (idx === 0) {
        termsAgreeBtn.textContent = '동의 및 확인 시작';
      } else {
        termsAgreeBtn.textContent = (idx === termsPages.length - 1) ? '동의 완료' : '동의하기';
      }
    }

    /**
     * 약관 동의 버튼 클릭 핸들러
     */
    function handleTermsAgreeButton(){
      termsCurrentPage++;
      if(termsCurrentPage < termsPages.length){
        showTermsPage(termsCurrentPage);
      } else {
        isTermsAndExplanationsAgreed = true;
        closeModal('termsModal');
        console.log('약관 및 설명서 동의가 완료되었습니다. ✅');
        termsCurrentPage = 0;
        showTermsPage(termsCurrentPage); // 페이지 상태 초기화
        updateAgreementConsentSectionStatus();
        updateAgreementButtonsState();
        updateNextButtonState();
      }
    }

    /**
     * 고객 확인 사항 동의 (Part 1) 버튼 클릭 핸들러
     */
    function handleCustomerCheckAgreeBtn(){
      closeModal('customerCheckModal');
      openModal('customerCheckModalPart2');
      console.log('고객 확인 사항 (1/2) 동의 완료. 다음 단계로 이동합니다.');
    }

    /**
     * 고객 확인 사항 동의 (Part 2) 버튼 클릭 핸들러
     */
    function handleCustomerCheckAgreeBtnPart2(){
      isCustomerCheckConfirmed = true;
      closeModal('customerCheckModalPart2');
      console.log('고객 확인 사항 (2/2) 모두 동의 완료되었습니다. ✅');
      updateAgreementConsentSectionStatus();
      updateAgreementButtonsState();
      updateNextButtonState();
    }

    /**
     * 동의 섹션의 전체적인 상태 (체크마크 표시, 섹션 확장/축소) 업데이트
     */
    function updateAgreementConsentSectionStatus(){
      if(isTermsAndExplanationsAgreed && isCustomerCheckConfirmed){
        agreementConsentCheckmark.style.display = 'inline-block';
        agreementConsentSection.classList.add('confirmed');

        setTimeout(()=>{
          agreementConsentContent.classList.add('collapsed');
          agreementConsentTitle.classList.remove('rotated');
          enrollmentContentInner.classList.remove('collapsed');
          enrollmentContentTitle.classList.add('rotated');
        },500);
      }
      updateNextButtonState();
    }

    /**
     * 가입 내용 섹션의 전체적인 상태 (체크마크 표시) 업데이트
     */
    function updateEnrollmentContentStatus() {
      isEnrollmentAmountFilled = enrollmentAmountInput.value.trim() !== '' && parseInt(enrollmentAmountInput.value) > 0;
      isCurrencySelected = currencySelect.value.trim() !== '';
      isWithdrawalEstimateLookedUp = withdrawalEstimateInput.value.trim() !== '' && withdrawalEstimateInput.value.includes('원');
      // isWithdrawalAccountFilled는 항상 true이므로 별도 검사 불필요

      if (isEnrollmentAmountFilled && isCurrencySelected && isWithdrawalEstimateLookedUp && isWithdrawalAccountFilled) {
        enrollmentContentCheckmark.style.display = 'inline-block';
        enrollmentContentSection.classList.add('confirmed');
      } else {
        enrollmentContentCheckmark.style.display = 'none';
        enrollmentContentSection.classList.remove('confirmed');
      }
      updateNextButtonState();
    }

    // --- 이벤트 리스너 ---

    document.addEventListener('DOMContentLoaded', () => {
      initializeUI();
    });

    document.getElementById('enrollmentContentSection')
      .querySelector('.section-title')
      .addEventListener('click', ()=>{
        enrollmentContentInner.classList.toggle('collapsed');
        enrollmentContentTitle.classList.toggle('rotated');
      });

    agreementConsentTitle.addEventListener('click', ()=>{
      if(!agreementConsentSection.classList.contains('confirmed')){
        agreementConsentContent.classList.toggle('collapsed');
        agreementConsentTitle.classList.toggle('rotated');
      }
    });

    homeButton.addEventListener('click', (e)=>{ e.preventDefault(); window.location.href='/foreign0'; });
    prevButton.addEventListener('click', ()=>{ window.location.href='/foreign4'; });

    nextButton.addEventListener('click', ()=>{
      if(isTermsAndExplanationsAgreed && isCustomerCheckConfirmed &&
         isEnrollmentAmountFilled && isCurrencySelected && isWithdrawalEstimateLookedUp && isWithdrawalAccountFilled){
        console.log('BNK 쇼핑환전통장 가입이 완료되었습니다! 🥳');
        window.location.href='/foreign6';
      }else{
        let m='상품 가입을 완료하려면 다음 사항을 확인해야 합니다:\\n';
        if(!isTermsAndExplanationsAgreed) m+='- 약관 및 설명서 동의\\n';
        if(!isCustomerCheckConfirmed) m+='- 고객 확인 사항 확인\\n';
        if(!(isEnrollmentAmountFilled && isCurrencySelected && isWithdrawalEstimateLookedUp)) m+='- 가입 내용을 모두 입력 및 확인\\n';
        console.log(m);
      }
    });

    document.getElementById('openTermsModalBtn').addEventListener('click', ()=>{ showTermsPage(0); openModal('termsModal'); });
    document.getElementById('termsAgreeBtn').addEventListener('click', handleTermsAgreeButton);
    document.getElementById('openCustomerCheckModalBtn').addEventListener('click', ()=>openModal('customerCheckModal'));
    customerCheckAgreeBtn.addEventListener('click', handleCustomerCheckAgreeBtn);
    customerCheckAgreeBtnPart2.addEventListener('click', handleCustomerCheckAgreeBtnPart2);

    enrollmentAmountInput.addEventListener('input', updateEnrollmentContentStatus);
    currencySelect.addEventListener('change', updateEnrollmentContentStatus);

    lookupEstimateBtn.addEventListener('click', () => {
      if (enrollmentAmountInput.value.trim() !== '' && currencySelect.value.trim() !== '') {
        const amount = parseInt(enrollmentAmountInput.value);
        const currency = currencySelect.value;
        if (amount > 0) {
          let estimatedAmount = 0;
          switch(currency) {
            case 'USD': estimatedAmount = amount * 1350; break;
            case 'JPY': estimatedAmount = amount * 9; break;
            case 'EUR': estimatedAmount = amount * 1450; break;
            case 'GBP': estimatedAmount = amount * 1600; break;
            case 'CNY': estimatedAmount = amount * 180; break;
            case 'KRW': estimatedAmount = amount; break;
            default: estimatedAmount = amount;
          }
          withdrawalEstimateInput.value = `${estimatedAmount.toLocaleString()} 원`;
          isWithdrawalEstimateLookedUp = true;
        } else {
          withdrawalEstimateInput.value = '';
          isWithdrawalEstimateLookedUp = false;
        }
      } else {
        withdrawalEstimateInput.value = '';
        isWithdrawalEstimateLookedUp = false;
      }
      updateEnrollmentContentStatus();
    });
  </script>
</body>
</html>
