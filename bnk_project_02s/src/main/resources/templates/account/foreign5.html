<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>BNK 쇼핑환전통장 - 상품 가입</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
  <style>
    /* 공통 리셋 */
    * { box-sizing: border-box; }

    /* ===== Pixel 8(412x915) 및 웹뷰 대응 공통 ===== */
    html, body { height:100%; }
    body { font-family:'Inter',sans-serif; background:#f0f4f8; margin:0; overflow-x:hidden; }

    .container {
      width:100%;
      max-width:none;
      min-height:100svh;
      margin:0 auto;
      background:#fff;
      display:flex; flex-direction:column;
      border-radius:0;
      box-shadow:none;
      overflow:hidden;
    }

    header { flex:none; }
    .bottom-bar {
      flex:none; width:100%; background:#fff; border-top:1px solid #e2e8f0; padding:.75rem 1rem; gap:.5rem;
      box-shadow:0 -4px 12px rgba(0,0,0,.03); display:flex; justify-content:space-around; z-index:10;
    }
    .bottom-bar button {
      flex:1; padding:.75rem 1rem; border-radius:.75rem; font-weight:600; font-size:.95rem; transition:.2s; box-shadow:0 2px 6px rgba(0,0,0,.1);
      min-height:48px;
    }
    .bottom-bar button:active { transform:scale(.98); }

    .main-content { flex:1; padding:.75rem; display:flex; flex-direction:column; gap:.9rem; overflow-y:auto; }
    .section-block { background:#fff; border-radius:.75rem; box-shadow:0 4px 12px rgba(0,0,0,.05); display:flex; flex-direction:column; overflow:hidden; }
    .section-title { font-size:.95rem; font-weight:700; color:#374151; display:flex; align-items:center; justify-content:space-between; padding:1rem 1.25rem; }
    .section-title .checkmark { color:#10b981; font-size:1.1rem; margin-left:.5rem; display:none; }
    .section-title .title-text { display:flex; align-items:center; flex:1; min-width:0; }

    .form-group { margin-bottom:.7rem; }                    /* 여백 살짝 줄임 */
    .form-group label { display:block; font-size:.85rem; font-weight:600; color:#4b5563; margin-bottom:.45rem; }
    .form-group input, .form-group select {
      width:100%; padding:.65rem .9rem; border:1px solid #d1d5db; border-radius:.5rem; font-size:.95rem; color:#374151; background:#f9fafb;
      min-width:0;
    }
    .form-group input:focus, .form-group select:focus { outline:none; border-color:#2563eb; box-shadow:0 0 0 2px rgba(37,99,235,.18); }
    .form-group input[readonly]{ background:#e5e7eb; cursor:not-allowed; }

    #encouragementMessage { white-space:pre-wrap; font-size:.95rem; }

    .section-content { max-height:1000px; overflow:hidden; transition:max-height .35s ease-out; }
    .section-content.collapsed { max-height:0; }
    .section-content-inner { padding:1rem 1.25rem; }
    .section-block.collapsible .section-title { cursor:pointer; }
    .section-block.collapsible .section-title .toggle-icon { transition:transform .25s ease; display:inline-block; }
    .section-block.collapsible .section-title.rotated .toggle-icon { transform:rotate(180deg); }
    .section-block.collapsible.confirmed .section-title .toggle-icon { display:none; }

    /* Step bar */
    .step-indicator { display:flex; width:100%; height:4px; background:#e0e0e0; border-radius:2px; overflow:hidden; margin-top:.5rem; }
    .step-indicator-progress { width:66.66%; height:100%; background:#2563eb; }

    /* ===== 모달 ===== */
    .modal-overlay {
      position:fixed; inset:0; background:rgba(0,0,0,.6);
      display:flex; align-items:center; justify-content:center; z-index:1000;
      opacity:0; visibility:hidden; transition:opacity .25s ease, visibility .25s ease;
    }
    .modal-overlay.active { opacity:1; visibility:visible; }
    .modal-content {
      background:#fff; border-radius:.75rem; box-shadow:0 8px 20px rgba(0,0,0,.2);
      width:96vw; max-width:430px;
      height:92svh;
      display:flex; flex-direction:column; overflow:hidden; margin:auto;
      transform:translateY(18px); transition:transform .25s ease;
    }
    .modal-overlay.active .modal-content { transform:translateY(0); }
    .modal-header { padding:0.85rem 1rem; border-bottom:1px solid #e2e8f0; display:flex; justify-content:space-between; align-items:center; font-weight:700; color:#374151; font-size:.95rem; }
    .modal-body { flex:1; padding:0; overflow:hidden; }
    .modal-footer { padding:.65rem 1rem; border-top:1px solid #e2e8f0; display:flex; justify-content:center; gap:.75rem; }
    .modal-close-button { background:none; border:none; font-size:1.35rem; color:#9ca3af; cursor:pointer; line-height:1; }
    .modal-close-button:hover { color:#4b5563; }
    .modal-button { padding:.7rem 1.2rem; border-radius:.5rem; font-weight:700; font-size:.9rem; transition:background-color .2s ease, transform .2s ease; min-height:44px; }
    .modal-button.primary { background:#2563eb; color:#fff; border:none; }
    .modal-button.primary:hover { background:#1d4ed8; }
    .modal-button:disabled { cursor: not-allowed; opacity: .6; }

    /* 약관 페이지 */
    .terms-page { display:none; height:100%; flex-direction:column; }
    .terms-page.active { display:flex; height:100%; }
    .terms-page h4 { margin-top:1rem; margin-bottom:.7rem; }

    /* 요약 스크롤 (1페이지는 스크롤 제거) */
    .summary-scroll {
      padding:1rem;
      padding-bottom:9rem;
      overflow:auto;
      -webkit-overflow-scrolling:touch;
      flex-grow:1;
    }
    #termsPage1 .summary-scroll { overflow:hidden; padding-bottom:1rem; }

    .summary-list { list-style:none; padding:0; margin:0; }
    .summary-list li {
      background:#fff;
      border:2px solid #3b82f6;
      border-radius:.75rem;
      padding:.9rem; margin-bottom:.7rem; color:#4b5563; line-height:1.5;
      box-shadow:0 2px 8px rgba(0,0,0,.08);
    }
    .summary-num { font-weight:800; color:#111827; margin-right:.45rem; }
    .summary-title { font-weight:800; color:#111827; }
    .summary-content { display:block; margin-top:.3rem; }

    /* PDF iframe */
    .pdf-viewer-iframe {
      flex:1 1 auto; width:100%;
      height: calc(92svh - 120px);
      border:1px solid #e0e0e0; border-radius:.5rem; box-shadow:0 2px 8px rgba(0,0,0,.05); background:#fff;
    }

    .scrollable-content-wrapper { max-height: 65svh; overflow-y:auto; padding-right:.5rem; margin-top:.5rem; }

    .grouped-content-box { background:#fff; border:2px solid #3b82f6; border-radius:.75rem; padding:1rem; margin-bottom:.7rem; box-shadow:0 2px 8px rgba(0,0,0,.08); }
    .grouped-content-box h4 { margin-top:0!important; }
    .grouped-content-box ul { margin-left:1.1rem; list-style:disc; }
    .grouped-content-box ul li { border:none; box-shadow:none; background:none; padding:0; margin-bottom:.25rem; }

    .section-title-spacing { margin-top:1rem; }

    /* 전자서명 */
    .signature-consent { display:flex; align-items:center; margin-top:1rem; margin-bottom:.7rem; padding:.9rem; background:#f9fafb; border:1px solid #e5e7eb; border-radius:.5rem; }
    .signature-consent input[type="checkbox"] { margin-right:.65rem; width:1.2rem; height:1.2rem; min-width:1.2rem; min-height:1.2rem; border-radius:.25rem; accent-color:#2563eb; cursor:pointer; }
    .signature-consent label { font-size:.92rem; color:#374151; font-weight:600; cursor:pointer; flex:1; }

    #signatureCanvas { border:1px solid #d1d5db; background:#fff; border-radius:.5rem; touch-action:none; }

    /* 입력 그룹 */
    .input-group-container {
      display:flex; flex-direction:column; gap:.4rem;        /* 내부 간격 축소 → ‘빈 공간’ 제거 */
      margin-bottom:1rem; padding:1rem;
      border:1px solid #e5e7eb; border-radius:.75rem; background:#f9fafb;
    }

    /* 환산 영역 */
    .currency-conversion-display {
      display:flex; align-items:center; justify-content:space-between; gap:.5rem; flex-wrap:wrap;
      margin-top:.1rem;                                                  /* 위 여백 최소화 */
    }
    .currency-conversion-display > * { min-width:0; }

    .input-amount { flex:2 1 0; padding:.7rem 1rem; border:1px solid #d1d5db; border-radius:.5rem; font-size:.95rem; color:#374151; background:#f9fafb; text-align:right; }
    .currency-select { flex:1.5 1 0; padding:.7rem 1rem; border:1px solid #d1d5db; border-radius:.5rem; font-size:.95rem; color:#374151; background:#f9fafb; }
    .equals-sign { flex:0 0 auto; text-align:center; font-size:1.3rem; font-weight:800; color:#4b5563; }
    .krw-display { flex:2 1 280px; display:flex; align-items:center; gap:.5rem; padding:.7rem 1rem; border:1px solid #d1d5db; border-radius:.5rem; background:#e5e7eb; color:#374151; font-size:.95rem; font-weight:700; cursor:not-allowed; }
    .krw-display img { width:22px; height:22px; }

    .benefit-badge { font-size:.85rem; font-weight:800; color:#dc2626; margin-top:.25rem; }  /* 빨간 안내 */

    @media (max-width: 480px) {
      .currency-conversion-display { gap:.5rem; }
      .currency-select, .input-amount { flex:1 1 0; }
      .equals-sign { flex-basis:100%; order:3; }
      .krw-display { flex-basis:100%; order:4; }
    }

    @media (max-width: 420px) {
      .section-title { font-size:.92rem; padding:.9rem 1rem; }
      .main-content { padding:.65rem; gap:.8rem; }
      .form-group input, .form-group select { font-size:.9rem; padding:.6rem .85rem; }
      .modal-content { width:98vw; max-width:420px; height:92svh; border-radius:.5rem; }
      .pdf-viewer-iframe { height: calc(92svh - 112px); }
      .bottom-bar { padding:.6rem .75rem; gap:.5rem; }
      .bottom-bar button { font-size:.88rem; padding:.65rem .8rem; min-height:48px; }
    }
  </style>
</head>
<body class="bg-gray-100 min-h-screen flex items-center justify-center">
  <div class="container">
    <!-- Header -->
    <header class="flex items-center justify-between p-4 bg-white border-b border-gray-200">
      <a href="/foreign" class="flex items-center text-blue-700 font-medium text-base hover:text-blue-800 transition-colors duration-300">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
          <path stroke-linecap="round" stroke-linejoin="round" d="M15 19l-7-7 7-7"/>
        </svg>
        홈으로
      </a>
      <h1 class="text-xl font-bold text-gray-800">상품 가입</h1>
      <span class="w-5 h-5 opacity-0"></span>
    </header>

    <!-- Step -->
    <div class="step-indicator mx-4 mt-4"><div class="step-indicator-progress"></div></div>

    <!-- Main -->
    <main class="main-content">
      <div id="encouragementMessage" class="text-center text-base font-semibold text-gray-700 p-3 rounded-lg bg-yellow-100 mx-0 mt-0 shadow-sm"></div>

      <!-- 동의 섹션 -->
      <div id="agreementConsentSection" class="section-block collapsible">
        <h2 class="section-title section-title-spacing"> 
          <span class="title-text">가입 관련 동의 <span id="agreementConsentCheckmark" class="checkmark">✔</span></span>
          <svg id="agreementConsentToggleIcon" class="toggle-icon h-5 w-5 text-gray-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7"/></svg>
        </h2>
        <div id="agreementConsentContent" class="section-content">
          <div class="section-content-inner">
            <button id="openTermsModalBtn" class="w-full bg-blue-500 text-white py-3 rounded-lg font-semibold mb-3 hover:bg-blue-600 transition-colors">약관 및 설명서 동의</button>
            <button id="openCustomerCheckModalBtn" class="w-full bg-blue-500 text-white py-3 rounded-lg font-semibold hover:bg-blue-600 transition-colors">고객 확인 사항 확인</button>
          </div>
        </div>
      </div>

      <!-- 가입 내용 -->
      <div id="enrollmentContentSection" class="section-block collapsible collapsed">
        <h2 class="section-title">
          <span class="title-text">가입 내용 <span id="enrollmentContentCheckmark" class="checkmark hidden">✔</span></span>
          <svg id="enrollmentContentToggleIcon" class="toggle-icon h-5 w-5 text-gray-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7"/></svg>
        </h2>
        <div id="enrollmentContentInner" class="section-content">
          <div class="section-content-inner">
            <div class="input-group-container">
              <!-- 통화 먼저 → 금액 -->
              <div class="form-group">
                <label for="currencySelect">가입할 통화</label>
                <select id="currencySelect" class="currency-select w-full">
                  <option value="">통화를 선택하세요</option>
                  <!-- 환전 가능 통화(목록) -->
                  <option value="USD">USD(미국)</option>
                  <option value="JPY100">JPY100(일본)</option>
                  <option value="TWD">TWD(대만)</option>
                  <option value="SGD">SGD(싱가포르)</option>
                  <option value="IDR100">IDR100(인도네시아)</option>
                  <option value="CNY">CNY(중국)</option>
                  <option value="THB">THB(태국)</option>
                  <option value="PHP">PHP(필리핀)</option>
                  <option value="HKD">HKD(홍콩)</option>
                  <option value="MYR">MYR(말레이시아)</option>
                  <option value="NZD">NZD(뉴질랜드)</option>
                  <option value="AUD">AUD(호주)</option>
                  <option value="CAD">CAD(캐나다)</option>
                  <option value="CHF">CHF(스위스)</option>
                  <option value="GBP">GBP(영국)</option>
                  <option value="EUR">EUR(유럽연합)</option>
                </select>
              </div>

              <div class="form-group mb-0">
                <label for="enrollmentAmount">가입금액</label>
                <input type="number" id="enrollmentAmount" class="input-amount w-full" placeholder="금액">
              </div>

              <div class="currency-conversion-display">
                <span class="equals-sign">=</span>
                <div id="krwDisplay" class="krw-display">
                  <img src="https://placehold.co/24x24/cccccc/white?text=KRW" alt="KRW Flag">
                  <span>대한민국 KRW</span>
                  <span id="withdrawalEstimateAmount" class="ml-auto">0 원</span>
                </div>
              </div>
              <div id="benefitNotice" class="benefit-badge">환율 우대 50% 적용 중</div>
              <button id="lookupEstimateBtn" class="w-full bg-blue-500 text-white py-2.5 rounded-lg font-semibold hover:bg-blue-600 transition-colors">조회하기</button>
            </div>

            <div class="form-group">
              <label for="withdrawalAccount">출금 계좌</label>
              <input type="text" id="withdrawalAccount" value="BNK부산은행 112-4567-7890-01" readonly class="bg-gray-200 cursor-not-allowed">
            </div>
          </div>
        </div>
      </div>
    </main>

    <!-- Bottom -->
    <footer class="bottom-bar">
      <button id="prevButton" class="bg-gray-200 text-gray-700 hover:bg-gray-300">이전</button>
      <button id="nextButton" class="bg-gray-400 text-white cursor-not-allowed" disabled>다음으로</button>
    </footer>
  </div>

  <!-- 약관/설명서 모달 -->
  <div id="termsModal" class="modal-overlay hidden">
    <div class="modal-content">
      <div class="modal-header">
        <h3 id="termsModalTitle">약관 및 설명서 동의</h3>
        <button class="modal-close-button" onclick="closeModal('termsModal')">&times;</button>
      </div>
      <div class="modal-body">
        <!-- Page 1: 요약본 (스크롤 없음) -->
        <div id="termsPage1" class="terms-page active">
          <div class="summary-scroll">
            <h4 class="font-bold text-gray-800 text-lg mb-4 text-center">요약본</h4>
            <ol class="summary-list">
              <li>
                <span class="summary-num">1.</span>
                <span class="summary-title">상품별적용약관</span><br>
                <span class="summary-content">계좌 개설·거래의 기본 규칙, 이자/수수료 부과 기준, 전자금융 이용, 휴면·해지 절차, 분쟁처리와 약관 변경 통지 방법을 규정합니다.</span>
              </li>
              <li>
                <span class="summary-num">2.</span>
                <span class="summary-title">외화보통예금 상품설명서</span><br>
                <span class="summary-content">상품 개요와 가입대상, 예치·인출 방법, 금리 산정과 세금, 환율·수수료 및 위험, 예금자보호 범위, 중도해지 시 불이익 등을 안내합니다.</span>
              </li>
              <li>
                <span class="summary-num">3.</span>
                <span class="summary-title">설명의무관련확인서(차명거래금지)</span><br>
                <span class="summary-content">실명확인 의무 및 차명거래 금지와 그 제재에 대해 고지받았음을 확인하고, 관련 법규 준수에 동의한다는 내용을 담습니다.</span>
              </li>
              <li>
                <span class="summary-num">4.</span>
                <span class="summary-title">개인(신용)정보 수집·이용·제공·조회 동의서(비대면 안심차단)</span><br>
                <span class="summary-content">수집 항목과 이용 목적(본인확인·거래관리·법령 준수), 보유기간, 제3자 제공, 안심차단 서비스 안내, 동의/철회 방법을 명시합니다.</span>
              </li>
            </ol>
          </div>
        </div>

        <!-- Page 2~5 -->
        <div id="termsPage2" class="terms-page">
          <h4 class="font-bold text-gray-800 text-lg mb-4 text-center"></h4>
          <iframe src="https://drive.google.com/file/d/1GClaAcMVQeXwKBSUZDZD-CrrCMWC2PJd/preview" class="pdf-viewer-iframe" allow="autoplay"></iframe>
        </div>
        <div id="termsPage3" class="terms-page">
          <h4 class="font-bold text-gray-800 text-lg mb-4 text-center"></h4>
          <iframe src="https://drive.google.com/file/d/15wwn9df-I70sL1TSLHv5m9KHFWOS1yuZ/preview" class="pdf-viewer-iframe" allow="autoplay"></iframe>
        </div>
        <div id="termsPage4" class="terms-page">
          <h4 class="font-bold text-gray-800 text-lg mb-4 text-center"></h4>
          <iframe src="https://drive.google.com/file/d/1iI2juipDYmW_Ok9c_VGhaHtXi8OEpGIC/preview" class="pdf-viewer-iframe" allow="autoplay"></iframe>
        </div>
        <div id="termsPage5" class="terms-page">
          <h4 class="font-bold text-gray-800 text-lg mb-4 text-center"></h4>
          <iframe src="https://drive.google.com/file/d/10RBKoscPB6Zz93y476Hg12GNZ44Le6tT/preview" class="pdf-viewer-iframe" allow="autoplay"></iframe>
        </div>
      </div>
      <div class="modal-footer">
        <button id="termsAgreeBtn" class="modal-button primary">동의하기</button>
      </div>
    </div>
  </div>

  <!-- 고객 확인 모달 - Part 1 -->
  <div id="customerCheckModal" class="modal-overlay hidden">
    <div class="modal-content">
      <div class="modal-header">
        <h3>고객 확인 사항 (1/2)</h3>
        <button class="modal-close-button" onclick="closeModal('customerCheckModal')">&times;</button>
      </div>
      <div class="modal-body">
        <div class="summary-scroll">
          <ul class="summary-list">
            <li>
              <span class="summary-num">1.</span>
              <span class="summary-title">예금자보호법</span><br>
              <span class="summary-content">본인이 가입하는 금융상품의 예금자보호 여부 및 보호한도(원금과 소정의 이자를 합하여 1인당 5천만원)에 대하여 설명을 보고, 충분히 이해하였음을 확인합니다.</span>
            </li>
            <li>
              <span class="summary-num">2.</span>
              <span class="summary-title">금융실명거래 및 비밀보장에 관한 법률</span><br>
              <span class="summary-content">제3조 제3항에 따라 불법재산의 은닉, 자금세탁행위, 공중협박, 자금조달행위 및 강제 집행의 면탈, 그 밖의 탈법 행위를 목적으로 타인의 실명으로 금융거래를 하여서는 아니되며, 이를 위반 시 5년 이하의 징역 또는 5천만원 이하의 벌금에 처할 수 있음을 고지받고 이해하였습니다.</span>
            </li>
            <li>
              <span class="summary-num">3.</span>
              <span class="summary-title">약관 및 상품설명서 이해</span><br>
              <span class="summary-content">금융회사는 「금융소비자보호에 관한 법률」 제19조(설명의무)에 따라 예금상품의 중요한 사항을 소비자가 이해할 수 있도록 설명해야 하며, 동법 제23조(계약서류의 제공의의무)에 따라 금융소비자에게 지체없이 제공해야 합니다. 본인은 약관 및 상품설명서의 주요내용에 대하여 충분히 이해하였습니다.</span>
            </li>
          </ul>
        </div>
      </div>
      <div class="modal-footer">
        <button id="customerCheckAgreeBtn" class="modal-button primary">모두 동의 (1 / 2)</button>
      </div>
    </div>
  </div>

  <!-- 고객 확인 모달 - Part 2 -->
  <div id="customerCheckModalPart2" class="modal-overlay hidden">
    <div class="modal-content">
      <div class="modal-header">
        <h3>고객 확인 사항 (2/2)</h3>
        <button class="modal-close-button" onclick="closeModal('customerCheckModalPart2')">&times;</button>
      </div>
      <div class="modal-body">
        <div class="summary-scroll">
          <ul class="summary-list">
            <li>
              <span class="summary-num">4.</span>
              <span class="summary-title">약관 및 상품설명서 수령 확인</span><br>
              <div class="scrollable-content-wrapper">
                <div class="grouped-content-box">
                  <h4 class="font-semibold text-gray-800">공통</h4>
                  <ul class="list-disc text-gray-700">
                    <li>민원처리 절차 및 분쟁조정</li>
                    <li>예금자보호여부 및 그 내용</li>
                    <li>계약의 해제, 해지 및 위법 계약 해지권</li>
                  </ul>
                </div>

                <div class="grouped-content-box mt-2">
                  <h4 class="font-semibold text-gray-800">예금성</h4>
                  <ul class="list-disc text-gray-700">
                    <li>계약기간, 이자의 지급시기 및 지급제한 사유</li>
                    <li>이자율(기본+우대), 중도해지이자율, 만기해지이자율, 만기후이자율, 수익률 및 산출근거 등</li>
                    <li>수수료 등 부대비용, 일반 금융소비자 계약해지 시 불이익</li>
                    <li>이용 제한사항(계좌이체 제한 등)</li>
                    <li>인용한 자료의 출처</li>
                  </ul>
                </div>
                <div class="grouped-content-box mt-2">
                  <h4 class="font-semibold text-gray-800">연계제휴</h4>
                  <ul class="list-disc text-gray-700">
                    <li>연계/제휴서비스의 내용 및 제공기간</li>
                    <li>이행책임 및 내용변경 시 고지방법</li>
                  </ul>
                </div>
                <p class="summary-content mt-4 text-center">
                  본인은 약관 및 상품설명서를 제공받고<br>
                  그 내용을 충분히 이해하며<br>
                  본 상품에 가입함을 확인합니다.
                </p>
              </div>
            </li>
          </ul>
        </div>
      </div>
      <div class="modal-footer">
        <button id="customerCheckAgreeBtnPart2" class="modal-button primary">모두 동의 (2 / 2)</button>
      </div>
    </div>
  </div>

  <!-- 필수 서류 받기 모달 -->
  <div id="sendDocumentsModal" class="modal-overlay hidden">
    <div class="modal-content w-4/5 h-auto max-h-[80svh] m-auto">
      <div class="modal-header">
        <h3>필수 서류 받기</h3>
        <button id="sendDocumentsModalCloseX" class="modal-close-button" disabled>&times;</button>
      </div>
      <div class="modal-body p-4 text-center">
        <p class="text-gray-700 text-lg mb-6">필수 서류를 어떤 방식으로<br>받으시겠어요?</p>
        <div class="form-group mb-4">
          <label for="smsNumberInput" class="text-left">휴대폰 번호</label>
          <input type="tel" id="smsNumberInput" class="w-full" placeholder="예: 01012345678" inputmode="numeric" pattern="[0-9]*">
          <button id="sendBySmsBtn" class="modal-button bg-blue-500 text-white mt-3 hover:bg-blue-600 w-full">문자로 받기</button>
        </div>
        <div class="form-group mb-4">
          <label for="emailAddressInput" class="text-left">이메일 주소</label>
          <input type="email" id="emailAddressInput" class="w-full" placeholder="예: yourname@example.com">
          <button id="sendByEmailBtn" class="modal-button bg-blue-500 text-white mt-3 hover:bg-blue-600 w-full">이메일로 받기</button>
        </div>
      </div>
      <div class="modal-footer">
        <button id="sendDocumentsModalCloseBtn" class="modal-button bg-gray-200 text-gray-700 hover:bg-gray-300" disabled>닫기</button>
      </div>
    </div>
  </div>

  <!-- 전자서명 모달 -->
  <div id="electronicSignatureModal" class="modal-overlay hidden">
    <div class="modal-content w-4/5 h-auto max-h-[80svh]">
      <div class="modal-header">
        <h3>전자서명</h3>
        <button class="modal-close-button" onclick="closeModal('electronicSignatureModal')">&times;</button>
      </div>
      <div class="modal-body p-4 flex flex-col items-center justify-center">
        <p class="text-gray-700 text-base mb-4 text-center">
          위 약관 및 고객 확인 사항에 동의하며,<br>본 상품 가입 전자서명을 진행합니다.
        </p>
        <canvas id="signatureCanvas" width="300" height="150" class="border border-gray-300 rounded-lg shadow-sm mb-3"></canvas>
        <button id="clearSignatureBtn" class="modal-button bg-red-400 text-white hover:bg-red-500 mb-3">서명 지우기</button>

        <div class="signature-consent">
          <input type="checkbox" id="signatureConsentCheckbox">
          <label for="signatureConsentCheckbox">본인은 위 서류를 확인하고<br>전자서명에 동의합니다.</label>
        </div>
        <p class="text-sm text-gray-500 mt-2 text-center">
          전자서명 완료 버튼 클릭 시,<br>고객님의 동의가 최종 확인됩니다.
        </p>
      </div>
      <div class="modal-footer">
        <button id="completeElectronicSignatureBtn" class="modal-button primary" disabled>전자서명 완료</button>
      </div>
    </div>
  </div>

  <script>
    /* ===== 스크립트 ===== */

    const homeButton = document.querySelector('header a');
    const prevButton = document.getElementById('prevButton');
    const nextButton = document.getElementById('nextButton');
    const encouragementMessageDiv = document.getElementById('encouragementMessage');

    const agreementConsentSection = document.getElementById('agreementConsentSection');
    const agreementConsentTitle = agreementConsentSection.querySelector('.section-title');
    const agreementConsentCheckmark = document.getElementById('agreementConsentCheckmark');
    const agreementConsentContent = document.getElementById('agreementConsentContent');
    const openTermsModalBtn = document.getElementById('openTermsModalBtn');
    const openCustomerCheckModalBtn = document.getElementById('openCustomerCheckModalBtn');

    const enrollmentContentSection = document.getElementById('enrollmentContentSection');
    const enrollmentContentTitle = enrollmentContentSection.querySelector('.section-title');
    const enrollmentContentCheckmark = document.getElementById('enrollmentContentCheckmark');
    const enrollmentContentInner = document.getElementById('enrollmentContentInner');

    const enrollmentAmountInput = document.getElementById('enrollmentAmount');
    const currencySelect = document.getElementById('currencySelect');
    const krwDisplayAmount = document.getElementById('withdrawalEstimateAmount');
    const lookupEstimateBtn = document.getElementById('lookupEstimateBtn');
    const withdrawalAccountInput = document.getElementById('withdrawalAccount');

    const termsModal = document.getElementById('termsModal');
    const termsModalTitle = document.getElementById('termsModalTitle');
    const termsPages = document.querySelectorAll('.terms-page');
    const termsAgreeBtn = document.getElementById('termsAgreeBtn');

    const customerCheckModal = document.getElementById('customerCheckModal');
    const customerCheckAgreeBtn = document.getElementById('customerCheckAgreeBtn');
    const customerCheckModalPart2 = document.getElementById('customerCheckModalPart2');
    const customerCheckAgreeBtnPart2 = document.getElementById('customerCheckAgreeBtnPart2');

    const sendDocumentsModal = document.getElementById('sendDocumentsModal');
    const smsNumberInput = document.getElementById('smsNumberInput');
    const emailAddressInput = document.getElementById('emailAddressInput');
    const sendBySmsBtn = document.getElementById('sendBySmsBtn');
    const sendByEmailBtn = document.getElementById('sendByEmailBtn');
    const sendDocumentsModalCloseBtn = document.getElementById('sendDocumentsModalCloseBtn');
    const sendDocumentsModalCloseX = document.getElementById('sendDocumentsModalCloseX');

    const electronicSignatureModal = document.getElementById('electronicSignatureModal');
    const signatureCanvas = document.getElementById('signatureCanvas');
    const signatureCtx = signatureCanvas.getContext('2d');
    const clearSignatureBtn = document.getElementById('clearSignatureBtn');
    const signatureConsentCheckbox = document.getElementById('signatureConsentCheckbox');
    const completeElectronicSignatureBtn = document.getElementById('completeElectronicSignatureBtn');

    let isTermsAndExplanationsAgreed = false;
    let isCustomerCheckConfirmed = false;
    let isElectronicSignatureCompleted = false;
    let isSignatureDrawn = false;
    let isEnrollmentAmountFilled = false;
    let isCurrencySelected = false;
    let isWithdrawalEstimateLookedUp = false;
    let isWithdrawalAccountFilled = true;
    let hasDeliveredDocuments = false;

    let termsCurrentPage = 0;
    const totalTermsPagesCount = 5;

    let isDrawing = false;
    let lastX = 0;
    let lastY = 0;

    const termsBaseTitles = [
      '약관 및 설명서 요약',
      '상품별적용약관',
      '외화보통예금 상품설명서',
      '설명의무관련확인서(차명거래금지에 관한 설명)',
      '개인(신용)정보 수집·이용·제공·조회 동의서<br>(비대면 계좌개설 안심차단)'
    ];

    const googleDriveFileUrls = [
      "https://drive.google.com/file/d/1GClaAcMVQeXwKBSUZDZD-CrrCMWC2PJd/view?usp=sharing",
      "https://drive.google.com/file/d/15wwn9df-I70sL1TSLHv5m9KHFWOS1yuZ/view?usp=sharing",
      "https://drive.google.com/file/d/1iI2juipDYmW_Ok9c_VGhaHtXi8OEpGIC/view?usp=sharing",
      "https://drive.google.com/file/d/10RBKoscPB6Zz93y476Hg12GNZ44Le6tT/ view?usp=sharing"
    ];

    function initializeUI() {
      encouragementMessageDiv.textContent = '중요한 내용이니 꼼꼼히 확인해 주세요! 😎';
      agreementConsentContent.classList.remove('collapsed');
      agreementConsentTitle.classList.add('rotated');
      enrollmentContentInner.classList.add('collapsed');
      enrollmentContentTitle.classList.remove('rotated');
      updateNextButtonState();
      updateAgreementConsentSectionStatus();
      updateAgreementButtonsState();
      updateEnrollmentContentStatus();
    }

    function updateNextButtonState() {
      if (isTermsAndExplanationsAgreed && isElectronicSignatureCompleted &&
          isEnrollmentAmountFilled && isCurrencySelected && isWithdrawalEstimateLookedUp) {
        nextButton.disabled = false;
        nextButton.classList.remove('bg-gray-400','cursor-not-allowed');
        nextButton.classList.add('bg-blue-600','hover:bg-blue-700');
        nextButton.textContent = '다음으로';
        encouragementMessageDiv.textContent = '모든 정보가 입력되었습니다! 🎉\n마지막 단계로 이동해 주세요.';
      } else {
        nextButton.disabled = true;
        nextButton.classList.add('bg-gray-400','cursor-not-allowed');
        nextButton.classList.remove('bg-blue-600','hover:bg-blue-700');
        nextButton.textContent = '다음으로';
        encouragementMessageDiv.textContent = '중요한 내용이니 꼼꼼히 확인해 주세요! 😎';
      }
    }

    function updateAgreementButtonsState() {
      openTermsModalBtn.disabled = !!isTermsAndExplanationsAgreed;
      openCustomerCheckModalBtn.disabled = !!isElectronicSignatureCompleted;

      openTermsModalBtn.classList.toggle('bg-gray-400', !!isTermsAndExplanationsAgreed);
      openTermsModalBtn.classList.toggle('cursor-not-allowed', !!isTermsAndExplanationsAgreed);

      openCustomerCheckModalBtn.classList.toggle('bg-gray-400', !!isElectronicSignatureCompleted);
      openCustomerCheckModalBtn.classList.toggle('cursor-not-allowed', !!isElectronicSignatureCompleted);
    }

    function openModal(id){
      const el=document.getElementById(id);
      el.classList.add('active');
      el.classList.remove('hidden');
      if (id === 'electronicSignatureModal') initializeSignaturePad();
      if (id === 'sendDocumentsModal') {
        sendDocumentsModalCloseBtn.disabled = !hasDeliveredDocuments;
        sendDocumentsModalCloseX.disabled = !hasDeliveredDocuments;
      }
    }
    function closeModal(id){
      const el=document.getElementById(id);
      el.classList.remove('active');
      setTimeout(()=>el.classList.add('hidden'),250);
    }

    function showTermsPage(idx){
      termsPages.forEach((p,i)=>p.classList.toggle('active', i===idx));
      const currentPageElement = termsPages[idx];

      if (idx === 0) {
        termsModalTitle.textContent = `약관 및 설명서 동의 (1 / ${totalTermsPagesCount})`;
        termsAgreeBtn.textContent = '동의 및 확인 시작';
      } else {
        termsModalTitle.textContent = `약관 및 설명서 동의 (${idx + 1} / ${totalTermsPagesCount})`;
        termsAgreeBtn.textContent = (idx === termsPages.length - 1) ? `동의 (4 / 4)` : `동의 (${idx} / 4)`;
      }

      let h4Element = currentPageElement.querySelector('h4');
      const currentTitle = [
        '약관 및 설명서 요약','상품별적용약관','외화보통예금 상품설명서','설명의무관련확인서(차명거래금지에 관한 설명)','개인(신용)정보 수집·이용·제공·조회 동의서<br>(비대면 계좌개설 안심차단)'
      ][idx];
      if (idx > 0) {
        if (!h4Element) {
          h4Element = document.createElement('h4');
          h4Element.classList.add('font-bold','text-gray-800','text-lg','mb-4','text-center');
          currentPageElement.prepend(h4Element);
        }
        h4Element.innerHTML = currentTitle;
      } else if (idx === 0 && h4Element) {
        h4Element.classList.add('text-center');
      }
    }

    function handleTermsAgreeButton(){
      termsCurrentPage++;
      if(termsCurrentPage < termsPages.length){
        showTermsPage(termsCurrentPage);
      } else {
        isTermsAndExplanationsAgreed = true;
        closeModal('termsModal');
        termsCurrentPage = 0;
        showTermsPage(termsCurrentPage);
        updateAgreementConsentSectionStatus();
        updateAgreementButtonsState();
        updateNextButtonState();
        openModal('sendDocumentsModal');
      }
    }

    function handleCustomerCheckAgreeBtn(){
      closeModal('customerCheckModal');
      openModal('customerCheckModalPart2');
    }

    function handleCustomerCheckAgreeBtnPart2(){
      closeModal('customerCheckModalPart2');
      openModal('electronicSignatureModal');
    }

    function handleCompleteElectronicSignature(){
      if (signatureConsentCheckbox.checked && isSignatureDrawn) {
        isElectronicSignatureCompleted = true;
        isCustomerCheckConfirmed = true;
        closeModal('electronicSignatureModal');
        updateAgreementConsentSectionStatus();
        updateAgreementButtonsState();
        updateNextButtonState();
      } else {
        if (!signatureConsentCheckbox.checked && !isSignatureDrawn) showInfoModal('전자서명을 완료하려면 서명을 그리고 동의 체크박스에 체크해주세요.');
        else if (!signatureConsentCheckbox.checked) showInfoModal('전자서명을 완료하려면 동의 체크박스에 체크해주세요.');
        else if (!isSignatureDrawn) showInfoModal('전자서명을 완료하려면 서명을 그려주세요.');
      }
    }

    function updateAgreementConsentSectionStatus(){
      if(isTermsAndExplanationsAgreed && isElectronicSignatureCompleted){
        agreementConsentCheckmark.style.display = 'inline-block';
        agreementConsentSection.classList.add('confirmed');
        setTimeout(()=>{
          agreementConsentContent.classList.add('collapsed');
          agreementConsentTitle.classList.remove('rotated');
          enrollmentContentInner.classList.remove('collapsed');
          enrollmentContentTitle.classList.add('rotated');
        },350);
      }
      updateNextButtonState();
    }

    function updateEnrollmentContentStatus() {
      isEnrollmentAmountFilled = enrollmentAmountInput.value.trim() !== '' && parseInt(enrollmentAmountInput.value) > 0;
      isCurrencySelected = currencySelect.value.trim() !== '';
      if (isEnrollmentAmountFilled && isCurrencySelected && isWithdrawalEstimateLookedUp && isWithdrawalAccountFilled) {
        enrollmentContentCheckmark.style.display = 'inline-block';
        enrollmentContentSection.classList.add('confirmed');
      } else {
        enrollmentContentCheckmark.style.display = 'none';
        enrollmentContentSection.classList.remove('confirmed');
      }
      updateNextButtonState();
    }

    /* === 서류 전송 (하나만 성공해도 닫기/X 버튼 활성화) === */
    function enableSendModalCloseButtons() {
      hasDeliveredDocuments = true;
      sendDocumentsModalCloseBtn.disabled = false;
      sendDocumentsModalCloseX.disabled = false;
    }

    async function sendDocumentsBySms() {
      const phoneNumber = smsNumberInput.value.trim();
      if (!phoneNumber) { showInfoModal('휴대폰 번호를 입력해주세요.'); return; }
      const message = `BNK 쇼핑환전통장 필수 서류입니다:\n${googleDriveFileUrls.join('\n')}`;
      showInfoModal('서류 전송 중...');
      try {
        await new Promise(r => setTimeout(r, 800));
        console.log(`[SMS 전송(시뮬레이션)] ${phoneNumber}\n${message}`);
        showInfoModal(`필수 서류가\n${phoneNumber}(으)로\n전송되었습니다.`);
        enableSendModalCloseButtons();
      } catch (e) {
        showInfoModal('SMS 전송에 실패했습니다. 다시 시도해주세요.');
      }
    }

    async function sendDocumentsByEmail() {
      const emailAddress = emailAddressInput.value.trim();
      if (!emailAddress || !emailAddress.includes('@')) { showInfoModal('유효한 이메일 주소를 입력해주세요.'); return; }
      const subject = 'BNK 쇼핑환전통장 필수 서류입니다.';
      const body = `BNK 쇼핑환전통장 가입에 필요한 필수 서류를 보내드립니다.\n\n${googleDriveFileUrls.join('\n')}\n\n감사합니다.`;
      showInfoModal('서류 전송 중...');
      try {
        await new Promise(r => setTimeout(r, 800));
        console.log(`[이메일 전송(시뮬레이션)] ${emailAddress}\n${subject}\n${body}`);
        showInfoModal(`필수 서류가\n${emailAddress}(으)로\n전송되었습니다.`);
        enableSendModalCloseButtons();
      } catch (e) {
        showInfoModal('이메일 전송에 실패했습니다. 다시 시도해주세요.');
      }
    }

    // 닫기 버튼/ X 버튼: 활성화되면 실제로 닫히도록
    sendDocumentsModalCloseBtn.addEventListener('click', () => {
      if (!sendDocumentsModalCloseBtn.disabled) closeModal('sendDocumentsModal');
    });
    sendDocumentsModalCloseX.addEventListener('click', () => {
      if (!sendDocumentsModalCloseX.disabled) closeModal('sendDocumentsModal');
    });

    function showInfoModal(message) {
      const modalId = 'infoModal';
      let infoModal = document.getElementById(modalId);
      if (!infoModal) {
        infoModal = document.createElement('div');
        infoModal.id = modalId;
        infoModal.classList.add('modal-overlay','hidden');
        infoModal.innerHTML = `
          <div class="modal-content w-4/5 h-auto max-h-[80svh] m-auto">
            <div class="modal-header">
              <h3>안내</h3>
              <button class="modal-close-button" onclick="closeModal('${modalId}')">&times;</button>
            </div>
            <div class="modal-body p-4 text-gray-700 whitespace-pre-wrap text-center">
              <p id="infoModalMessage" class="info-modal-text-center"></p>
            </div>
            <div class="modal-footer">
              <button class="modal-button primary" onclick="closeModal('${modalId}')">확인</button>
            </div>
          </div>`;
        document.body.appendChild(infoModal);
      }
      document.getElementById('infoModalMessage').textContent = message;
      openModal(modalId);
    }

    /* === 서명 패드 === */
    function initializeSignaturePad() {
      const bodyEl = electronicSignatureModal.querySelector('.modal-body');
      const w = Math.min(bodyEl.clientWidth - 32, 320);
      signatureCanvas.width = w;
      signatureCanvas.height = 150;
      signatureCtx.clearRect(0,0,signatureCanvas.width,signatureCanvas.height);
      signatureCtx.lineWidth = 2;
      signatureCtx.lineCap = 'round';
      signatureCtx.strokeStyle = '#000';
      isSignatureDrawn = false;
      updateSignatureButtonState();
    }

    function startDrawing(e) {
      e.preventDefault();
      isDrawing = true;
      const { clientX, clientY } = e.touches ? e.touches[0] : e;
      const rect = signatureCanvas.getBoundingClientRect();
      lastX = clientX - rect.left; lastY = clientY - rect.top;
    }
    function draw(e) {
      if (!isDrawing) return;
      e.preventDefault();
      const { clientX, clientY } = e.touches ? e.touches[0] : e;
      const rect = signatureCanvas.getBoundingClientRect();
      const x = clientX - rect.left; const y = clientY - rect.top;
      signatureCtx.beginPath(); signatureCtx.moveTo(lastX,lastY); signatureCtx.lineTo(x,y); signatureCtx.stroke();
      lastX = x; lastY = y;
      if (!isSignatureDrawn) { isSignatureDrawn = true; updateSignatureButtonState(); }
    }
    function stopDrawing() { isDrawing = false; }
    function clearSignature() { signatureCtx.clearRect(0,0,signatureCanvas.width,signatureCanvas.height); isSignatureDrawn = false; updateSignatureButtonState(); }
    function updateSignatureButtonState() {
      completeElectronicSignatureBtn.disabled = !(signatureConsentCheckbox.checked && isSignatureDrawn);
      completeElectronicSignatureBtn.classList.toggle('bg-gray-400', completeElectronicSignatureBtn.disabled);
      completeElectronicSignatureBtn.classList.toggle('cursor-not-allowed', completeElectronicSignatureBtn.disabled);
      completeElectronicSignatureBtn.classList.toggle('bg-blue-500', !completeElectronicSignatureBtn.disabled);
      completeElectronicSignatureBtn.classList.toggle('hover:bg-blue-600', !completeElectronicSignatureBtn.disabled);
    }

    document.addEventListener('DOMContentLoaded', initializeUI);

    document.getElementById('enrollmentContentSection').querySelector('.section-title').addEventListener('click', ()=>{
      enrollmentContentInner.classList.toggle('collapsed');
      enrollmentContentTitle.classList.toggle('rotated');
    });

    agreementConsentTitle.addEventListener('click', ()=>{
      if(!agreementConsentSection.classList.contains('confirmed')){
        agreementConsentContent.classList.toggle('collapsed');
        agreementConsentTitle.classList.toggle('rotated');
      }
    });

    homeButton.addEventListener('click', (e)=>{ e.preventDefault(); window.location.href='/foreign'; });
    prevButton.addEventListener('click', ()=>{ window.location.href='/foreign4'; });

    // ===== 환율 계산 =====
    // USD만 실시간, 우대율 50% 적용(기본 스프레드 2.4% 가정 → 1.2% 적용)
    const BASE_SPREAD = 0.024;     // 고시 스프레드(가정)
    const DISCOUNT_RATE = 0.5;     // 우대율 50%
    const EFFECTIVE_SPREAD = BASE_SPREAD * (1 - DISCOUNT_RATE); // 0.012

    const unitFactorByOption = { 'JPY100': 100, 'IDR100': 100 }; // 100단위 표기
    const codeFromOption = (opt) => opt.replace('100','');

    const fallbackRatesToKRW = { // 비-USD는 임시 고정치(대략값)
      'USD': 1350, 'JPY': 13.5, 'TWD': 45, 'SGD': 1000, 'IDR': 0.09, 'CNY': 180,
      'THB': 38, 'PHP': 25, 'HKD': 170, 'MYR': 290, 'NZD': 850, 'AUD': 900,
      'CAD': 980, 'CHF': 1500, 'GBP': 1600, 'EUR': 1450
    };

    async function getUsdKrwMid() {
      try {
        const res = await fetch('https://api.exchangerate.host/latest?base=USD&symbols=KRW', { cache:'no-store' });
        if(!res.ok) throw new Error('rate fetch failed');
        const data = await res.json();
        const mid = data?.rates?.KRW;
        if (typeof mid !== 'number') throw new Error('invalid rate');
        return mid;
      } catch(e) {
        return fallbackRatesToKRW['USD'];
      }
    }

    async function lookupEstimate() {
      const amount = parseInt(enrollmentAmountInput.value);
      const optionValue = currencySelect.value;

      if (!(amount > 0) || !optionValue) {
        krwDisplayAmount.textContent = '0 원';
        isWithdrawalEstimateLookedUp = false;
        showInfoModal('가입 금액과 통화를 모두 입력(선택)하고 0보다 큰 값을 입력해주세요.');
        updateEnrollmentContentStatus();
        return;
      }

      const code = codeFromOption(optionValue);

      // USD만 정확 계산
      if (code === 'USD') {
        const mid = await getUsdKrwMid();                 // 1 USD의 중간환율(KRW)
        const applied = mid * (1 + EFFECTIVE_SPREAD);     // 우대 50% 반영된 매입환율
        const estimatedKRW = Math.round(amount * applied);
        krwDisplayAmount.textContent = `${estimatedKRW.toLocaleString()} 원`;
        isWithdrawalEstimateLookedUp = true;
        updateEnrollmentContentStatus();
        return;
      }

      // 그 외 통화는 목록만 – 간단 안내 및 대략치(고정) 표시(선택에 따른 숫자 감만 제공)
      const unit = unitFactorByOption[optionValue] || 1;
      const perUnit = (fallbackRatesToKRW[code] || 0) * unit;
      const approx = Math.round(amount * perUnit);
      krwDisplayAmount.textContent = `${approx.toLocaleString()} 원`;
      isWithdrawalEstimateLookedUp = false; // 정확 계산 아님 → 다음으로 진행 막음
      updateEnrollmentContentStatus();
      showInfoModal('현재 USD만 실시간/정확 계산을 지원합니다.\n다른 통화는 목록 선택만 가능합니다.');
    }

    // 이벤트 바인딩
    document.getElementById('openTermsModalBtn').addEventListener('click', ()=>{ showTermsPage(0); openModal('termsModal'); });
    document.getElementById('termsAgreeBtn').addEventListener('click', handleTermsAgreeButton);
    document.getElementById('openCustomerCheckModalBtn').addEventListener('click', ()=>openModal('customerCheckModal'));
    customerCheckAgreeBtn.addEventListener('click', handleCustomerCheckAgreeBtn);
    customerCheckAgreeBtnPart2.addEventListener('click', handleCustomerCheckAgreeBtnPart2);

    signatureConsentCheckbox.addEventListener('change', updateSignatureButtonState);
    completeElectronicSignatureBtn.addEventListener('click', handleCompleteElectronicSignature);

    signatureCanvas.addEventListener('mousedown', startDrawing);
    signatureCanvas.addEventListener('mousemove', draw);
    signatureCanvas.addEventListener('mouseup', stopDrawing);
    signatureCanvas.addEventListener('mouseout', stopDrawing);
    signatureCanvas.addEventListener('touchstart', startDrawing, {passive:false});
    signatureCanvas.addEventListener('touchmove', draw, {passive:false});
    signatureCanvas.addEventListener('touchend', stopDrawing);

    clearSignatureBtn.addEventListener('click', clearSignature);

    enrollmentAmountInput.addEventListener('input', ()=>{ isWithdrawalEstimateLookedUp = false; updateEnrollmentContentStatus(); });
    currencySelect.addEventListener('change', ()=>{ isWithdrawalEstimateLookedUp = false; updateEnrollmentContentStatus(); });

    lookupEstimateBtn.addEventListener('click', lookupEstimate);

    // 서류 전송
    sendBySmsBtn.addEventListener('click', sendDocumentsBySms);
    sendByEmailBtn.addEventListener('click', sendDocumentsByEmail);

    // 모달 오픈 시 닫기 버튼 상태 동기화
    const originalOpenModal = openModal;
    openModal = function(id) {
      originalOpenModal(id);
      if (id === 'sendDocumentsModal') {
        sendDocumentsModalCloseBtn.disabled = !hasDeliveredDocuments;
        sendDocumentsModalCloseX.disabled = !hasDeliveredDocuments;
      }
    };

    // ===== 다음 페이지로 값 전달 (sessionStorage) =====
    nextButton.addEventListener('click', ()=>{
      if(isTermsAndExplanationsAgreed && isElectronicSignatureCompleted &&
         isEnrollmentAmountFilled && isCurrencySelected && isWithdrawalEstimateLookedUp && isWithdrawalAccountFilled){

        let signatureDataUrl = '';
        try { signatureDataUrl = signatureCanvas.toDataURL('image/png'); } catch(e) {}

        const payload = {
          currencyDisplay: currencySelect.value,                     // 예: USD, JPY100
          amount: parseInt(enrollmentAmountInput.value),
          krwEstimate: parseInt((krwDisplayAmount.textContent || '0').replace(/[^\d]/g,'')),
          benefitApplied: 50,
          timestamp: new Date().toISOString(),
          signatureDataUrl
        };
        sessionStorage.setItem('bnkEnrollmentData', JSON.stringify(payload));
        window.location.href='/foreign6';
      } else {
        let msg = '상품 가입을 완료하려면 다음 사항을 확인해야 합니다:\n';
        if(!isTermsAndExplanationsAgreed) msg += '- 약관 및 설명서 동의\n';
        if(!isElectronicSignatureCompleted) msg += '- 고객 확인 사항 및 전자서명 완료\n';
        if(!isEnrollmentAmountFilled) msg += '- 가입 금액을 입력해주세요.\n';
        if(!isCurrencySelected) msg += '- 통화를 선택해주세요.\n';
        if(!isWithdrawalEstimateLookedUp) msg += '- 원화출금 예상액(USD 기준)을 조회해주세요.\n';
        showInfoModal(msg);
      }
    });
  </script>
</body>
</html>
