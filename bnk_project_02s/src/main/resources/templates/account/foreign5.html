<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>BNK ì‡¼í•‘í™˜ì „í†µì¥ - ìƒí’ˆ ê°€ì…</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
  <style>
    /* ê³µí†µ ë¦¬ì…‹ */
    * { box-sizing: border-box; }

    /* ===== Pixel 8(412x915) ë° ì›¹ë·° ëŒ€ì‘ ê³µí†µ ===== */
    html, body { height:100%; }
    body { font-family:'Inter',sans-serif; background:#f0f4f8; margin:0; overflow-x:hidden; }

    .container {
      width:100%;
      max-width:none;
      min-height:100svh;
      margin:0 auto;
      background:#fff;
      display:flex; flex-direction:column;
      border-radius:0;
      box-shadow:none;
      overflow:hidden;
    }

    header { flex:none; }
    .bottom-bar {
      flex:none; width:100%; background:#fff; border-top:1px solid #e2e8f0; padding:.75rem 1rem; gap:.5rem;
      box-shadow:0 -4px 12px rgba(0,0,0,.03); display:flex; justify-content:space-around; z-index:10;
    }
    .bottom-bar button {
      flex:1; padding:.75rem 1rem; border-radius:.75rem; font-weight:600; font-size:.95rem; transition:.2s; box-shadow:0 2px 6px rgba(0,0,0,.1);
      min-height:48px;
    }
    .bottom-bar button:active { transform:scale(.98); }

    .main-content { flex:1; padding:.75rem; display:flex; flex-direction:column; gap:.9rem; overflow-y:auto; }
    .section-block { background:#fff; border-radius:.75rem; box-shadow:0 4px 12px rgba(0,0,0,.05); display:flex; flex-direction:column; overflow:hidden; }
    .section-title { font-size:.95rem; font-weight:700; color:#374151; display:flex; align-items:center; justify-content:space-between; padding:1rem 1.25rem; }
    .section-title .checkmark { color:#10b981; font-size:1.1rem; margin-left:.5rem; display:none; }
    .section-title .title-text { display:flex; align-items:center; flex:1; min-width:0; }

    .form-group { margin-bottom:.7rem; }                    /* ì—¬ë°± ì‚´ì§ ì¤„ì„ */
    .form-group label { display:block; font-size:.85rem; font-weight:600; color:#4b5563; margin-bottom:.45rem; }
    .form-group input, .form-group select {
      width:100%; padding:.65rem .9rem; border:1px solid #d1d5db; border-radius:.5rem; font-size:.95rem; color:#374151; background:#f9fafb;
      min-width:0;
    }
    .form-group input:focus, .form-group select:focus { outline:none; border-color:#2563eb; box-shadow:0 0 0 2px rgba(37,99,235,.18); }
    .form-group input[readonly]{ background:#e5e7eb; cursor:not-allowed; }

    #encouragementMessage { white-space:pre-wrap; font-size:.95rem; }

    .section-content { max-height:1000px; overflow:hidden; transition:max-height .35s ease-out; }
    .section-content.collapsed { max-height:0; }
    .section-content-inner { padding:1rem 1.25rem; }
    .section-block.collapsible .section-title { cursor:pointer; }
    .section-block.collapsible .section-title .toggle-icon { transition:transform .25s ease; display:inline-block; }
    .section-block.collapsible .section-title.rotated .toggle-icon { transform:rotate(180deg); }
    .section-block.collapsible.confirmed .section-title .toggle-icon { display:none; }

    /* Step bar */
    .step-indicator { display:flex; width:100%; height:4px; background:#e0e0e0; border-radius:2px; overflow:hidden; margin-top:.5rem; }
    .step-indicator-progress { width:66.66%; height:100%; background:#2563eb; }

    /* ===== ëª¨ë‹¬ ===== */
    .modal-overlay {
      position:fixed; inset:0; background:rgba(0,0,0,.6);
      display:flex; align-items:center; justify-content:center; z-index:1000;
      opacity:0; visibility:hidden; transition:opacity .25s ease, visibility .25s ease;
    }
    .modal-overlay.active { opacity:1; visibility:visible; }
    .modal-content {
      background:#fff; border-radius:.75rem; box-shadow:0 8px 20px rgba(0,0,0,.2);
      width:96vw; max-width:430px;
      height:92svh;
      display:flex; flex-direction:column; overflow:hidden; margin:auto;
      transform:translateY(18px); transition:transform .25s ease;
    }
    .modal-overlay.active .modal-content { transform:translateY(0); }
    .modal-header { padding:0.85rem 1rem; border-bottom:1px solid #e2e8f0; display:flex; justify-content:space-between; align-items:center; font-weight:700; color:#374151; font-size:.95rem; }
    .modal-body { flex:1; padding:0; overflow:hidden; }
    .modal-footer { padding:.65rem 1rem; border-top:1px solid #e2e8f0; display:flex; justify-content:center; gap:.75rem; }
    .modal-close-button { background:none; border:none; font-size:1.35rem; color:#9ca3af; cursor:pointer; line-height:1; }
    .modal-close-button:hover { color:#4b5563; }
    .modal-button { padding:.7rem 1.2rem; border-radius:.5rem; font-weight:700; font-size:.9rem; transition:background-color .2s ease, transform .2s ease; min-height:44px; }
    .modal-button.primary { background:#2563eb; color:#fff; border:none; }
    .modal-button.primary:hover { background:#1d4ed8; }
    .modal-button:disabled { cursor: not-allowed; opacity: .6; }

    /* ì•½ê´€ í˜ì´ì§€ */
    .terms-page { display:none; height:100%; flex-direction:column; }
    .terms-page.active { display:flex; height:100%; }
    .terms-page h4 { margin-top:1rem; margin-bottom:.7rem; }

    /* ìš”ì•½ ìŠ¤í¬ë¡¤ (1í˜ì´ì§€ëŠ” ìŠ¤í¬ë¡¤ ì œê±°) */
    .summary-scroll {
      padding:1rem;
      padding-bottom:9rem;
      overflow:auto;
      -webkit-overflow-scrolling:touch;
      flex-grow:1;
    }
    #termsPage1 .summary-scroll { overflow:hidden; padding-bottom:1rem; }

    .summary-list { list-style:none; padding:0; margin:0; }
    .summary-list li {
      background:#fff;
      border:2px solid #3b82f6;
      border-radius:.75rem;
      padding:.9rem; margin-bottom:.7rem; color:#4b5563; line-height:1.5;
      box-shadow:0 2px 8px rgba(0,0,0,.08);
    }
    .summary-num { font-weight:800; color:#111827; margin-right:.45rem; }
    .summary-title { font-weight:800; color:#111827; }
    .summary-content { display:block; margin-top:.3rem; }

    /* PDF iframe */
    .pdf-viewer-iframe {
      flex:1 1 auto; width:100%;
      height: calc(92svh - 120px);
      border:1px solid #e0e0e0; border-radius:.5rem; box-shadow:0 2px 8px rgba(0,0,0,.05); background:#fff;
    }

    .scrollable-content-wrapper { max-height: 65svh; overflow-y:auto; padding-right:.5rem; margin-top:.5rem; }

    .grouped-content-box { background:#fff; border:2px solid #3b82f6; border-radius:.75rem; padding:1rem; margin-bottom:.7rem; box-shadow:0 2px 8px rgba(0,0,0,.08); }
    .grouped-content-box h4 { margin-top:0!important; }
    .grouped-content-box ul { margin-left:1.1rem; list-style:disc; }
    .grouped-content-box ul li { border:none; box-shadow:none; background:none; padding:0; margin-bottom:.25rem; }

    .section-title-spacing { margin-top:1rem; }

    /* ì „ìì„œëª… */
    .signature-consent { display:flex; align-items:center; margin-top:1rem; margin-bottom:.7rem; padding:.9rem; background:#f9fafb; border:1px solid #e5e7eb; border-radius:.5rem; }
    .signature-consent input[type="checkbox"] { margin-right:.65rem; width:1.2rem; height:1.2rem; min-width:1.2rem; min-height:1.2rem; border-radius:.25rem; accent-color:#2563eb; cursor:pointer; }
    .signature-consent label { font-size:.92rem; color:#374151; font-weight:600; cursor:pointer; flex:1; }

    #signatureCanvas { border:1px solid #d1d5db; background:#fff; border-radius:.5rem; touch-action:none; }

    /* ì…ë ¥ ê·¸ë£¹ */
    .input-group-container {
      display:flex; flex-direction:column; gap:.4rem;        /* ë‚´ë¶€ ê°„ê²© ì¶•ì†Œ â†’ â€˜ë¹ˆ ê³µê°„â€™ ì œê±° */
      margin-bottom:1rem; padding:1rem;
      border:1px solid #e5e7eb; border-radius:.75rem; background:#f9fafb;
    }

    /* í™˜ì‚° ì˜ì—­ */
    .currency-conversion-display {
      display:flex; align-items:center; justify-content:space-between; gap:.5rem; flex-wrap:wrap;
      margin-top:.1rem;                                                  /* ìœ„ ì—¬ë°± ìµœì†Œí™” */
    }
    .currency-conversion-display > * { min-width:0; }

    .input-amount { flex:2 1 0; padding:.7rem 1rem; border:1px solid #d1d5db; border-radius:.5rem; font-size:.95rem; color:#374151; background:#f9fafb; text-align:right; }
    .currency-select { flex:1.5 1 0; padding:.7rem 1rem; border:1px solid #d1d5db; border-radius:.5rem; font-size:.95rem; color:#374151; background:#f9fafb; }
    .equals-sign { flex:0 0 auto; text-align:center; font-size:1.3rem; font-weight:800; color:#4b5563; }
    .krw-display { flex:2 1 280px; display:flex; align-items:center; gap:.5rem; padding:.7rem 1rem; border:1px solid #d1d5db; border-radius:.5rem; background:#e5e7eb; color:#374151; font-size:.95rem; font-weight:700; cursor:not-allowed; }
    .krw-display img { width:22px; height:22px; }

    .benefit-badge { font-size:.85rem; font-weight:800; color:#dc2626; margin-top:.25rem; }  /* ë¹¨ê°„ ì•ˆë‚´ */

    @media (max-width: 480px) {
      .currency-conversion-display { gap:.5rem; }
      .currency-select, .input-amount { flex:1 1 0; }
      .equals-sign { flex-basis:100%; order:3; }
      .krw-display { flex-basis:100%; order:4; }
    }

    @media (max-width: 420px) {
      .section-title { font-size:.92rem; padding:.9rem 1rem; }
      .main-content { padding:.65rem; gap:.8rem; }
      .form-group input, .form-group select { font-size:.9rem; padding:.6rem .85rem; }
      .modal-content { width:98vw; max-width:420px; height:92svh; border-radius:.5rem; }
      .pdf-viewer-iframe { height: calc(92svh - 112px); }
      .bottom-bar { padding:.6rem .75rem; gap:.5rem; }
      .bottom-bar button { font-size:.88rem; padding:.65rem .8rem; min-height:48px; }
    }
  </style>
</head>
<body class="bg-gray-100 min-h-screen flex items-center justify-center">
  <div class="container">
    <!-- Header -->
    <header class="flex items-center justify-between p-4 bg-white border-b border-gray-200">
      <a href="/foreign" class="flex items-center text-blue-700 font-medium text-base hover:text-blue-800 transition-colors duration-300">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
          <path stroke-linecap="round" stroke-linejoin="round" d="M15 19l-7-7 7-7"/>
        </svg>
        í™ˆìœ¼ë¡œ
      </a>
      <h1 class="text-xl font-bold text-gray-800">ìƒí’ˆ ê°€ì…</h1>
      <span class="w-5 h-5 opacity-0"></span>
    </header>

    <!-- Step -->
    <div class="step-indicator mx-4 mt-4"><div class="step-indicator-progress"></div></div>

    <!-- Main -->
    <main class="main-content">
      <div id="encouragementMessage" class="text-center text-base font-semibold text-gray-700 p-3 rounded-lg bg-yellow-100 mx-0 mt-0 shadow-sm"></div>

      <!-- ë™ì˜ ì„¹ì…˜ -->
      <div id="agreementConsentSection" class="section-block collapsible">
        <h2 class="section-title section-title-spacing"> 
          <span class="title-text">ê°€ì… ê´€ë ¨ ë™ì˜ <span id="agreementConsentCheckmark" class="checkmark">âœ”</span></span>
          <svg id="agreementConsentToggleIcon" class="toggle-icon h-5 w-5 text-gray-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7"/></svg>
        </h2>
        <div id="agreementConsentContent" class="section-content">
          <div class="section-content-inner">
            <button id="openTermsModalBtn" class="w-full bg-blue-500 text-white py-3 rounded-lg font-semibold mb-3 hover:bg-blue-600 transition-colors">ì•½ê´€ ë° ì„¤ëª…ì„œ ë™ì˜</button>
            <button id="openCustomerCheckModalBtn" class="w-full bg-blue-500 text-white py-3 rounded-lg font-semibold hover:bg-blue-600 transition-colors">ê³ ê° í™•ì¸ ì‚¬í•­ í™•ì¸</button>
          </div>
        </div>
      </div>

      <!-- ê°€ì… ë‚´ìš© -->
      <div id="enrollmentContentSection" class="section-block collapsible collapsed">
        <h2 class="section-title">
          <span class="title-text">ê°€ì… ë‚´ìš© <span id="enrollmentContentCheckmark" class="checkmark hidden">âœ”</span></span>
          <svg id="enrollmentContentToggleIcon" class="toggle-icon h-5 w-5 text-gray-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7"/></svg>
        </h2>
        <div id="enrollmentContentInner" class="section-content">
          <div class="section-content-inner">
            <div class="input-group-container">
              <!-- í†µí™” ë¨¼ì € â†’ ê¸ˆì•¡ -->
              <div class="form-group">
                <label for="currencySelect">ê°€ì…í•  í†µí™”</label>
                <select id="currencySelect" class="currency-select w-full">
                  <option value="">í†µí™”ë¥¼ ì„ íƒí•˜ì„¸ìš”</option>
                  <!-- í™˜ì „ ê°€ëŠ¥ í†µí™”(ëª©ë¡) -->
                  <option value="USD">USD(ë¯¸êµ­)</option>
                  <option value="JPY100">JPY100(ì¼ë³¸)</option>
                  <option value="TWD">TWD(ëŒ€ë§Œ)</option>
                  <option value="SGD">SGD(ì‹±ê°€í¬ë¥´)</option>
                  <option value="IDR100">IDR100(ì¸ë„ë„¤ì‹œì•„)</option>
                  <option value="CNY">CNY(ì¤‘êµ­)</option>
                  <option value="THB">THB(íƒœêµ­)</option>
                  <option value="PHP">PHP(í•„ë¦¬í•€)</option>
                  <option value="HKD">HKD(í™ì½©)</option>
                  <option value="MYR">MYR(ë§ë ˆì´ì‹œì•„)</option>
                  <option value="NZD">NZD(ë‰´ì§ˆëœë“œ)</option>
                  <option value="AUD">AUD(í˜¸ì£¼)</option>
                  <option value="CAD">CAD(ìºë‚˜ë‹¤)</option>
                  <option value="CHF">CHF(ìŠ¤ìœ„ìŠ¤)</option>
                  <option value="GBP">GBP(ì˜êµ­)</option>
                  <option value="EUR">EUR(ìœ ëŸ½ì—°í•©)</option>
                </select>
              </div>

              <div class="form-group mb-0">
                <label for="enrollmentAmount">ê°€ì…ê¸ˆì•¡</label>
                <input type="number" id="enrollmentAmount" class="input-amount w-full" placeholder="ê¸ˆì•¡">
              </div>

              <div class="currency-conversion-display">
                <span class="equals-sign">=</span>
                <div id="krwDisplay" class="krw-display">
                  <img src="https://placehold.co/24x24/cccccc/white?text=KRW" alt="KRW Flag">
                  <span>ëŒ€í•œë¯¼êµ­ KRW</span>
                  <span id="withdrawalEstimateAmount" class="ml-auto">0 ì›</span>
                </div>
              </div>
              <div id="benefitNotice" class="benefit-badge">í™˜ìœ¨ ìš°ëŒ€ 50% ì ìš© ì¤‘</div>
              <button id="lookupEstimateBtn" class="w-full bg-blue-500 text-white py-2.5 rounded-lg font-semibold hover:bg-blue-600 transition-colors">ì¡°íšŒí•˜ê¸°</button>
            </div>

            <div class="form-group">
              <label for="withdrawalAccount">ì¶œê¸ˆ ê³„ì¢Œ</label>
              <input type="text" id="withdrawalAccount" value="BNKë¶€ì‚°ì€í–‰ 112-4567-7890-01" readonly class="bg-gray-200 cursor-not-allowed">
            </div>
          </div>
        </div>
      </div>
    </main>

    <!-- Bottom -->
    <footer class="bottom-bar">
      <button id="prevButton" class="bg-gray-200 text-gray-700 hover:bg-gray-300">ì´ì „</button>
      <button id="nextButton" class="bg-gray-400 text-white cursor-not-allowed" disabled>ë‹¤ìŒìœ¼ë¡œ</button>
    </footer>
  </div>

  <!-- ì•½ê´€/ì„¤ëª…ì„œ ëª¨ë‹¬ -->
  <div id="termsModal" class="modal-overlay hidden">
    <div class="modal-content">
      <div class="modal-header">
        <h3 id="termsModalTitle">ì•½ê´€ ë° ì„¤ëª…ì„œ ë™ì˜</h3>
        <button class="modal-close-button" onclick="closeModal('termsModal')">&times;</button>
      </div>
      <div class="modal-body">
        <!-- Page 1: ìš”ì•½ë³¸ (ìŠ¤í¬ë¡¤ ì—†ìŒ) -->
        <div id="termsPage1" class="terms-page active">
          <div class="summary-scroll">
            <h4 class="font-bold text-gray-800 text-lg mb-4 text-center">ìš”ì•½ë³¸</h4>
            <ol class="summary-list">
              <li>
                <span class="summary-num">1.</span>
                <span class="summary-title">ìƒí’ˆë³„ì ìš©ì•½ê´€</span><br>
                <span class="summary-content">ê³„ì¢Œ ê°œì„¤Â·ê±°ë˜ì˜ ê¸°ë³¸ ê·œì¹™, ì´ì/ìˆ˜ìˆ˜ë£Œ ë¶€ê³¼ ê¸°ì¤€, ì „ìê¸ˆìœµ ì´ìš©, íœ´ë©´Â·í•´ì§€ ì ˆì°¨, ë¶„ìŸì²˜ë¦¬ì™€ ì•½ê´€ ë³€ê²½ í†µì§€ ë°©ë²•ì„ ê·œì •í•©ë‹ˆë‹¤.</span>
              </li>
              <li>
                <span class="summary-num">2.</span>
                <span class="summary-title">ì™¸í™”ë³´í†µì˜ˆê¸ˆ ìƒí’ˆì„¤ëª…ì„œ</span><br>
                <span class="summary-content">ìƒí’ˆ ê°œìš”ì™€ ê°€ì…ëŒ€ìƒ, ì˜ˆì¹˜Â·ì¸ì¶œ ë°©ë²•, ê¸ˆë¦¬ ì‚°ì •ê³¼ ì„¸ê¸ˆ, í™˜ìœ¨Â·ìˆ˜ìˆ˜ë£Œ ë° ìœ„í—˜, ì˜ˆê¸ˆìë³´í˜¸ ë²”ìœ„, ì¤‘ë„í•´ì§€ ì‹œ ë¶ˆì´ìµ ë“±ì„ ì•ˆë‚´í•©ë‹ˆë‹¤.</span>
              </li>
              <li>
                <span class="summary-num">3.</span>
                <span class="summary-title">ì„¤ëª…ì˜ë¬´ê´€ë ¨í™•ì¸ì„œ(ì°¨ëª…ê±°ë˜ê¸ˆì§€)</span><br>
                <span class="summary-content">ì‹¤ëª…í™•ì¸ ì˜ë¬´ ë° ì°¨ëª…ê±°ë˜ ê¸ˆì§€ì™€ ê·¸ ì œì¬ì— ëŒ€í•´ ê³ ì§€ë°›ì•˜ìŒì„ í™•ì¸í•˜ê³ , ê´€ë ¨ ë²•ê·œ ì¤€ìˆ˜ì— ë™ì˜í•œë‹¤ëŠ” ë‚´ìš©ì„ ë‹´ìŠµë‹ˆë‹¤.</span>
              </li>
              <li>
                <span class="summary-num">4.</span>
                <span class="summary-title">ê°œì¸(ì‹ ìš©)ì •ë³´ ìˆ˜ì§‘Â·ì´ìš©Â·ì œê³µÂ·ì¡°íšŒ ë™ì˜ì„œ(ë¹„ëŒ€ë©´ ì•ˆì‹¬ì°¨ë‹¨)</span><br>
                <span class="summary-content">ìˆ˜ì§‘ í•­ëª©ê³¼ ì´ìš© ëª©ì (ë³¸ì¸í™•ì¸Â·ê±°ë˜ê´€ë¦¬Â·ë²•ë ¹ ì¤€ìˆ˜), ë³´ìœ ê¸°ê°„, ì œ3ì ì œê³µ, ì•ˆì‹¬ì°¨ë‹¨ ì„œë¹„ìŠ¤ ì•ˆë‚´, ë™ì˜/ì² íšŒ ë°©ë²•ì„ ëª…ì‹œí•©ë‹ˆë‹¤.</span>
              </li>
            </ol>
          </div>
        </div>

        <!-- Page 2~5 -->
        <div id="termsPage2" class="terms-page">
          <h4 class="font-bold text-gray-800 text-lg mb-4 text-center"></h4>
          <iframe src="https://drive.google.com/file/d/1GClaAcMVQeXwKBSUZDZD-CrrCMWC2PJd/preview" class="pdf-viewer-iframe" allow="autoplay"></iframe>
        </div>
        <div id="termsPage3" class="terms-page">
          <h4 class="font-bold text-gray-800 text-lg mb-4 text-center"></h4>
          <iframe src="https://drive.google.com/file/d/15wwn9df-I70sL1TSLHv5m9KHFWOS1yuZ/preview" class="pdf-viewer-iframe" allow="autoplay"></iframe>
        </div>
        <div id="termsPage4" class="terms-page">
          <h4 class="font-bold text-gray-800 text-lg mb-4 text-center"></h4>
          <iframe src="https://drive.google.com/file/d/1iI2juipDYmW_Ok9c_VGhaHtXi8OEpGIC/preview" class="pdf-viewer-iframe" allow="autoplay"></iframe>
        </div>
        <div id="termsPage5" class="terms-page">
          <h4 class="font-bold text-gray-800 text-lg mb-4 text-center"></h4>
          <iframe src="https://drive.google.com/file/d/10RBKoscPB6Zz93y476Hg12GNZ44Le6tT/preview" class="pdf-viewer-iframe" allow="autoplay"></iframe>
        </div>
      </div>
      <div class="modal-footer">
        <button id="termsAgreeBtn" class="modal-button primary">ë™ì˜í•˜ê¸°</button>
      </div>
    </div>
  </div>

  <!-- ê³ ê° í™•ì¸ ëª¨ë‹¬ - Part 1 -->
  <div id="customerCheckModal" class="modal-overlay hidden">
    <div class="modal-content">
      <div class="modal-header">
        <h3>ê³ ê° í™•ì¸ ì‚¬í•­ (1/2)</h3>
        <button class="modal-close-button" onclick="closeModal('customerCheckModal')">&times;</button>
      </div>
      <div class="modal-body">
        <div class="summary-scroll">
          <ul class="summary-list">
            <li>
              <span class="summary-num">1.</span>
              <span class="summary-title">ì˜ˆê¸ˆìë³´í˜¸ë²•</span><br>
              <span class="summary-content">ë³¸ì¸ì´ ê°€ì…í•˜ëŠ” ê¸ˆìœµìƒí’ˆì˜ ì˜ˆê¸ˆìë³´í˜¸ ì—¬ë¶€ ë° ë³´í˜¸í•œë„(ì›ê¸ˆê³¼ ì†Œì •ì˜ ì´ìë¥¼ í•©í•˜ì—¬ 1ì¸ë‹¹ 5ì²œë§Œì›)ì— ëŒ€í•˜ì—¬ ì„¤ëª…ì„ ë³´ê³ , ì¶©ë¶„íˆ ì´í•´í•˜ì˜€ìŒì„ í™•ì¸í•©ë‹ˆë‹¤.</span>
            </li>
            <li>
              <span class="summary-num">2.</span>
              <span class="summary-title">ê¸ˆìœµì‹¤ëª…ê±°ë˜ ë° ë¹„ë°€ë³´ì¥ì— ê´€í•œ ë²•ë¥ </span><br>
              <span class="summary-content">ì œ3ì¡° ì œ3í•­ì— ë”°ë¼ ë¶ˆë²•ì¬ì‚°ì˜ ì€ë‹‰, ìê¸ˆì„¸íƒí–‰ìœ„, ê³µì¤‘í˜‘ë°•, ìê¸ˆì¡°ë‹¬í–‰ìœ„ ë° ê°•ì œ ì§‘í–‰ì˜ ë©´íƒˆ, ê·¸ ë°–ì˜ íƒˆë²• í–‰ìœ„ë¥¼ ëª©ì ìœ¼ë¡œ íƒ€ì¸ì˜ ì‹¤ëª…ìœ¼ë¡œ ê¸ˆìœµê±°ë˜ë¥¼ í•˜ì—¬ì„œëŠ” ì•„ë‹ˆë˜ë©°, ì´ë¥¼ ìœ„ë°˜ ì‹œ 5ë…„ ì´í•˜ì˜ ì§•ì—­ ë˜ëŠ” 5ì²œë§Œì› ì´í•˜ì˜ ë²Œê¸ˆì— ì²˜í•  ìˆ˜ ìˆìŒì„ ê³ ì§€ë°›ê³  ì´í•´í•˜ì˜€ìŠµë‹ˆë‹¤.</span>
            </li>
            <li>
              <span class="summary-num">3.</span>
              <span class="summary-title">ì•½ê´€ ë° ìƒí’ˆì„¤ëª…ì„œ ì´í•´</span><br>
              <span class="summary-content">ê¸ˆìœµíšŒì‚¬ëŠ” ã€Œê¸ˆìœµì†Œë¹„ìë³´í˜¸ì— ê´€í•œ ë²•ë¥ ã€ ì œ19ì¡°(ì„¤ëª…ì˜ë¬´)ì— ë”°ë¼ ì˜ˆê¸ˆìƒí’ˆì˜ ì¤‘ìš”í•œ ì‚¬í•­ì„ ì†Œë¹„ìê°€ ì´í•´í•  ìˆ˜ ìˆë„ë¡ ì„¤ëª…í•´ì•¼ í•˜ë©°, ë™ë²• ì œ23ì¡°(ê³„ì•½ì„œë¥˜ì˜ ì œê³µì˜ì˜ë¬´)ì— ë”°ë¼ ê¸ˆìœµì†Œë¹„ìì—ê²Œ ì§€ì²´ì—†ì´ ì œê³µí•´ì•¼ í•©ë‹ˆë‹¤. ë³¸ì¸ì€ ì•½ê´€ ë° ìƒí’ˆì„¤ëª…ì„œì˜ ì£¼ìš”ë‚´ìš©ì— ëŒ€í•˜ì—¬ ì¶©ë¶„íˆ ì´í•´í•˜ì˜€ìŠµë‹ˆë‹¤.</span>
            </li>
          </ul>
        </div>
      </div>
      <div class="modal-footer">
        <button id="customerCheckAgreeBtn" class="modal-button primary">ëª¨ë‘ ë™ì˜ (1 / 2)</button>
      </div>
    </div>
  </div>

  <!-- ê³ ê° í™•ì¸ ëª¨ë‹¬ - Part 2 -->
  <div id="customerCheckModalPart2" class="modal-overlay hidden">
    <div class="modal-content">
      <div class="modal-header">
        <h3>ê³ ê° í™•ì¸ ì‚¬í•­ (2/2)</h3>
        <button class="modal-close-button" onclick="closeModal('customerCheckModalPart2')">&times;</button>
      </div>
      <div class="modal-body">
        <div class="summary-scroll">
          <ul class="summary-list">
            <li>
              <span class="summary-num">4.</span>
              <span class="summary-title">ì•½ê´€ ë° ìƒí’ˆì„¤ëª…ì„œ ìˆ˜ë ¹ í™•ì¸</span><br>
              <div class="scrollable-content-wrapper">
                <div class="grouped-content-box">
                  <h4 class="font-semibold text-gray-800">ê³µí†µ</h4>
                  <ul class="list-disc text-gray-700">
                    <li>ë¯¼ì›ì²˜ë¦¬ ì ˆì°¨ ë° ë¶„ìŸì¡°ì •</li>
                    <li>ì˜ˆê¸ˆìë³´í˜¸ì—¬ë¶€ ë° ê·¸ ë‚´ìš©</li>
                    <li>ê³„ì•½ì˜ í•´ì œ, í•´ì§€ ë° ìœ„ë²• ê³„ì•½ í•´ì§€ê¶Œ</li>
                  </ul>
                </div>

                <div class="grouped-content-box mt-2">
                  <h4 class="font-semibold text-gray-800">ì˜ˆê¸ˆì„±</h4>
                  <ul class="list-disc text-gray-700">
                    <li>ê³„ì•½ê¸°ê°„, ì´ìì˜ ì§€ê¸‰ì‹œê¸° ë° ì§€ê¸‰ì œí•œ ì‚¬ìœ </li>
                    <li>ì´ììœ¨(ê¸°ë³¸+ìš°ëŒ€), ì¤‘ë„í•´ì§€ì´ììœ¨, ë§Œê¸°í•´ì§€ì´ììœ¨, ë§Œê¸°í›„ì´ììœ¨, ìˆ˜ìµë¥  ë° ì‚°ì¶œê·¼ê±° ë“±</li>
                    <li>ìˆ˜ìˆ˜ë£Œ ë“± ë¶€ëŒ€ë¹„ìš©, ì¼ë°˜ ê¸ˆìœµì†Œë¹„ì ê³„ì•½í•´ì§€ ì‹œ ë¶ˆì´ìµ</li>
                    <li>ì´ìš© ì œí•œì‚¬í•­(ê³„ì¢Œì´ì²´ ì œí•œ ë“±)</li>
                    <li>ì¸ìš©í•œ ìë£Œì˜ ì¶œì²˜</li>
                  </ul>
                </div>
                <div class="grouped-content-box mt-2">
                  <h4 class="font-semibold text-gray-800">ì—°ê³„ì œíœ´</h4>
                  <ul class="list-disc text-gray-700">
                    <li>ì—°ê³„/ì œíœ´ì„œë¹„ìŠ¤ì˜ ë‚´ìš© ë° ì œê³µê¸°ê°„</li>
                    <li>ì´í–‰ì±…ì„ ë° ë‚´ìš©ë³€ê²½ ì‹œ ê³ ì§€ë°©ë²•</li>
                  </ul>
                </div>
                <p class="summary-content mt-4 text-center">
                  ë³¸ì¸ì€ ì•½ê´€ ë° ìƒí’ˆì„¤ëª…ì„œë¥¼ ì œê³µë°›ê³ <br>
                  ê·¸ ë‚´ìš©ì„ ì¶©ë¶„íˆ ì´í•´í•˜ë©°<br>
                  ë³¸ ìƒí’ˆì— ê°€ì…í•¨ì„ í™•ì¸í•©ë‹ˆë‹¤.
                </p>
              </div>
            </li>
          </ul>
        </div>
      </div>
      <div class="modal-footer">
        <button id="customerCheckAgreeBtnPart2" class="modal-button primary">ëª¨ë‘ ë™ì˜ (2 / 2)</button>
      </div>
    </div>
  </div>

  <!-- í•„ìˆ˜ ì„œë¥˜ ë°›ê¸° ëª¨ë‹¬ -->
  <div id="sendDocumentsModal" class="modal-overlay hidden">
    <div class="modal-content w-4/5 h-auto max-h-[80svh] m-auto">
      <div class="modal-header">
        <h3>í•„ìˆ˜ ì„œë¥˜ ë°›ê¸°</h3>
        <button id="sendDocumentsModalCloseX" class="modal-close-button" disabled>&times;</button>
      </div>
      <div class="modal-body p-4 text-center">
        <p class="text-gray-700 text-lg mb-6">í•„ìˆ˜ ì„œë¥˜ë¥¼ ì–´ë–¤ ë°©ì‹ìœ¼ë¡œ<br>ë°›ìœ¼ì‹œê² ì–´ìš”?</p>
        <div class="form-group mb-4">
          <label for="smsNumberInput" class="text-left">íœ´ëŒ€í° ë²ˆí˜¸</label>
          <input type="tel" id="smsNumberInput" class="w-full" placeholder="ì˜ˆ: 01012345678" inputmode="numeric" pattern="[0-9]*">
          <button id="sendBySmsBtn" class="modal-button bg-blue-500 text-white mt-3 hover:bg-blue-600 w-full">ë¬¸ìë¡œ ë°›ê¸°</button>
        </div>
        <div class="form-group mb-4">
          <label for="emailAddressInput" class="text-left">ì´ë©”ì¼ ì£¼ì†Œ</label>
          <input type="email" id="emailAddressInput" class="w-full" placeholder="ì˜ˆ: yourname@example.com">
          <button id="sendByEmailBtn" class="modal-button bg-blue-500 text-white mt-3 hover:bg-blue-600 w-full">ì´ë©”ì¼ë¡œ ë°›ê¸°</button>
        </div>
      </div>
      <div class="modal-footer">
        <button id="sendDocumentsModalCloseBtn" class="modal-button bg-gray-200 text-gray-700 hover:bg-gray-300" disabled>ë‹«ê¸°</button>
      </div>
    </div>
  </div>

  <!-- ì „ìì„œëª… ëª¨ë‹¬ -->
  <div id="electronicSignatureModal" class="modal-overlay hidden">
    <div class="modal-content w-4/5 h-auto max-h-[80svh]">
      <div class="modal-header">
        <h3>ì „ìì„œëª…</h3>
        <button class="modal-close-button" onclick="closeModal('electronicSignatureModal')">&times;</button>
      </div>
      <div class="modal-body p-4 flex flex-col items-center justify-center">
        <p class="text-gray-700 text-base mb-4 text-center">
          ìœ„ ì•½ê´€ ë° ê³ ê° í™•ì¸ ì‚¬í•­ì— ë™ì˜í•˜ë©°,<br>ë³¸ ìƒí’ˆ ê°€ì… ì „ìì„œëª…ì„ ì§„í–‰í•©ë‹ˆë‹¤.
        </p>
        <canvas id="signatureCanvas" width="300" height="150" class="border border-gray-300 rounded-lg shadow-sm mb-3"></canvas>
        <button id="clearSignatureBtn" class="modal-button bg-red-400 text-white hover:bg-red-500 mb-3">ì„œëª… ì§€ìš°ê¸°</button>

        <div class="signature-consent">
          <input type="checkbox" id="signatureConsentCheckbox">
          <label for="signatureConsentCheckbox">ë³¸ì¸ì€ ìœ„ ì„œë¥˜ë¥¼ í™•ì¸í•˜ê³ <br>ì „ìì„œëª…ì— ë™ì˜í•©ë‹ˆë‹¤.</label>
        </div>
        <p class="text-sm text-gray-500 mt-2 text-center">
          ì „ìì„œëª… ì™„ë£Œ ë²„íŠ¼ í´ë¦­ ì‹œ,<br>ê³ ê°ë‹˜ì˜ ë™ì˜ê°€ ìµœì¢… í™•ì¸ë©ë‹ˆë‹¤.
        </p>
      </div>
      <div class="modal-footer">
        <button id="completeElectronicSignatureBtn" class="modal-button primary" disabled>ì „ìì„œëª… ì™„ë£Œ</button>
      </div>
    </div>
  </div>

  <script>
    /* ===== ìŠ¤í¬ë¦½íŠ¸ ===== */

    const homeButton = document.querySelector('header a');
    const prevButton = document.getElementById('prevButton');
    const nextButton = document.getElementById('nextButton');
    const encouragementMessageDiv = document.getElementById('encouragementMessage');

    const agreementConsentSection = document.getElementById('agreementConsentSection');
    const agreementConsentTitle = agreementConsentSection.querySelector('.section-title');
    const agreementConsentCheckmark = document.getElementById('agreementConsentCheckmark');
    const agreementConsentContent = document.getElementById('agreementConsentContent');
    const openTermsModalBtn = document.getElementById('openTermsModalBtn');
    const openCustomerCheckModalBtn = document.getElementById('openCustomerCheckModalBtn');

    const enrollmentContentSection = document.getElementById('enrollmentContentSection');
    const enrollmentContentTitle = enrollmentContentSection.querySelector('.section-title');
    const enrollmentContentCheckmark = document.getElementById('enrollmentContentCheckmark');
    const enrollmentContentInner = document.getElementById('enrollmentContentInner');

    const enrollmentAmountInput = document.getElementById('enrollmentAmount');
    const currencySelect = document.getElementById('currencySelect');
    const krwDisplayAmount = document.getElementById('withdrawalEstimateAmount');
    const lookupEstimateBtn = document.getElementById('lookupEstimateBtn');
    const withdrawalAccountInput = document.getElementById('withdrawalAccount');

    const termsModal = document.getElementById('termsModal');
    const termsModalTitle = document.getElementById('termsModalTitle');
    const termsPages = document.querySelectorAll('.terms-page');
    const termsAgreeBtn = document.getElementById('termsAgreeBtn');

    const customerCheckModal = document.getElementById('customerCheckModal');
    const customerCheckAgreeBtn = document.getElementById('customerCheckAgreeBtn');
    const customerCheckModalPart2 = document.getElementById('customerCheckModalPart2');
    const customerCheckAgreeBtnPart2 = document.getElementById('customerCheckAgreeBtnPart2');

    const sendDocumentsModal = document.getElementById('sendDocumentsModal');
    const smsNumberInput = document.getElementById('smsNumberInput');
    const emailAddressInput = document.getElementById('emailAddressInput');
    const sendBySmsBtn = document.getElementById('sendBySmsBtn');
    const sendByEmailBtn = document.getElementById('sendByEmailBtn');
    const sendDocumentsModalCloseBtn = document.getElementById('sendDocumentsModalCloseBtn');
    const sendDocumentsModalCloseX = document.getElementById('sendDocumentsModalCloseX');

    const electronicSignatureModal = document.getElementById('electronicSignatureModal');
    const signatureCanvas = document.getElementById('signatureCanvas');
    const signatureCtx = signatureCanvas.getContext('2d');
    const clearSignatureBtn = document.getElementById('clearSignatureBtn');
    const signatureConsentCheckbox = document.getElementById('signatureConsentCheckbox');
    const completeElectronicSignatureBtn = document.getElementById('completeElectronicSignatureBtn');

    let isTermsAndExplanationsAgreed = false;
    let isCustomerCheckConfirmed = false;
    let isElectronicSignatureCompleted = false;
    let isSignatureDrawn = false;
    let isEnrollmentAmountFilled = false;
    let isCurrencySelected = false;
    let isWithdrawalEstimateLookedUp = false;
    let isWithdrawalAccountFilled = true;
    let hasDeliveredDocuments = false;

    let termsCurrentPage = 0;
    const totalTermsPagesCount = 5;

    let isDrawing = false;
    let lastX = 0;
    let lastY = 0;

    const termsBaseTitles = [
      'ì•½ê´€ ë° ì„¤ëª…ì„œ ìš”ì•½',
      'ìƒí’ˆë³„ì ìš©ì•½ê´€',
      'ì™¸í™”ë³´í†µì˜ˆê¸ˆ ìƒí’ˆì„¤ëª…ì„œ',
      'ì„¤ëª…ì˜ë¬´ê´€ë ¨í™•ì¸ì„œ(ì°¨ëª…ê±°ë˜ê¸ˆì§€ì— ê´€í•œ ì„¤ëª…)',
      'ê°œì¸(ì‹ ìš©)ì •ë³´ ìˆ˜ì§‘Â·ì´ìš©Â·ì œê³µÂ·ì¡°íšŒ ë™ì˜ì„œ<br>(ë¹„ëŒ€ë©´ ê³„ì¢Œê°œì„¤ ì•ˆì‹¬ì°¨ë‹¨)'
    ];

    const googleDriveFileUrls = [
      "https://drive.google.com/file/d/1GClaAcMVQeXwKBSUZDZD-CrrCMWC2PJd/view?usp=sharing",
      "https://drive.google.com/file/d/15wwn9df-I70sL1TSLHv5m9KHFWOS1yuZ/view?usp=sharing",
      "https://drive.google.com/file/d/1iI2juipDYmW_Ok9c_VGhaHtXi8OEpGIC/view?usp=sharing",
      "https://drive.google.com/file/d/10RBKoscPB6Zz93y476Hg12GNZ44Le6tT/ view?usp=sharing"
    ];

    function initializeUI() {
      encouragementMessageDiv.textContent = 'ì¤‘ìš”í•œ ë‚´ìš©ì´ë‹ˆ ê¼¼ê¼¼íˆ í™•ì¸í•´ ì£¼ì„¸ìš”! ğŸ˜';
      agreementConsentContent.classList.remove('collapsed');
      agreementConsentTitle.classList.add('rotated');
      enrollmentContentInner.classList.add('collapsed');
      enrollmentContentTitle.classList.remove('rotated');
      updateNextButtonState();
      updateAgreementConsentSectionStatus();
      updateAgreementButtonsState();
      updateEnrollmentContentStatus();
    }

    function updateNextButtonState() {
      if (isTermsAndExplanationsAgreed && isElectronicSignatureCompleted &&
          isEnrollmentAmountFilled && isCurrencySelected && isWithdrawalEstimateLookedUp) {
        nextButton.disabled = false;
        nextButton.classList.remove('bg-gray-400','cursor-not-allowed');
        nextButton.classList.add('bg-blue-600','hover:bg-blue-700');
        nextButton.textContent = 'ë‹¤ìŒìœ¼ë¡œ';
        encouragementMessageDiv.textContent = 'ëª¨ë“  ì •ë³´ê°€ ì…ë ¥ë˜ì—ˆìŠµë‹ˆë‹¤! ğŸ‰\në§ˆì§€ë§‰ ë‹¨ê³„ë¡œ ì´ë™í•´ ì£¼ì„¸ìš”.';
      } else {
        nextButton.disabled = true;
        nextButton.classList.add('bg-gray-400','cursor-not-allowed');
        nextButton.classList.remove('bg-blue-600','hover:bg-blue-700');
        nextButton.textContent = 'ë‹¤ìŒìœ¼ë¡œ';
        encouragementMessageDiv.textContent = 'ì¤‘ìš”í•œ ë‚´ìš©ì´ë‹ˆ ê¼¼ê¼¼íˆ í™•ì¸í•´ ì£¼ì„¸ìš”! ğŸ˜';
      }
    }

    function updateAgreementButtonsState() {
      openTermsModalBtn.disabled = !!isTermsAndExplanationsAgreed;
      openCustomerCheckModalBtn.disabled = !!isElectronicSignatureCompleted;

      openTermsModalBtn.classList.toggle('bg-gray-400', !!isTermsAndExplanationsAgreed);
      openTermsModalBtn.classList.toggle('cursor-not-allowed', !!isTermsAndExplanationsAgreed);

      openCustomerCheckModalBtn.classList.toggle('bg-gray-400', !!isElectronicSignatureCompleted);
      openCustomerCheckModalBtn.classList.toggle('cursor-not-allowed', !!isElectronicSignatureCompleted);
    }

    function openModal(id){
      const el=document.getElementById(id);
      el.classList.add('active');
      el.classList.remove('hidden');
      if (id === 'electronicSignatureModal') initializeSignaturePad();
      if (id === 'sendDocumentsModal') {
        sendDocumentsModalCloseBtn.disabled = !hasDeliveredDocuments;
        sendDocumentsModalCloseX.disabled = !hasDeliveredDocuments;
      }
    }
    function closeModal(id){
      const el=document.getElementById(id);
      el.classList.remove('active');
      setTimeout(()=>el.classList.add('hidden'),250);
    }

    function showTermsPage(idx){
      termsPages.forEach((p,i)=>p.classList.toggle('active', i===idx));
      const currentPageElement = termsPages[idx];

      if (idx === 0) {
        termsModalTitle.textContent = `ì•½ê´€ ë° ì„¤ëª…ì„œ ë™ì˜ (1 / ${totalTermsPagesCount})`;
        termsAgreeBtn.textContent = 'ë™ì˜ ë° í™•ì¸ ì‹œì‘';
      } else {
        termsModalTitle.textContent = `ì•½ê´€ ë° ì„¤ëª…ì„œ ë™ì˜ (${idx + 1} / ${totalTermsPagesCount})`;
        termsAgreeBtn.textContent = (idx === termsPages.length - 1) ? `ë™ì˜ (4 / 4)` : `ë™ì˜ (${idx} / 4)`;
      }

      let h4Element = currentPageElement.querySelector('h4');
      const currentTitle = [
        'ì•½ê´€ ë° ì„¤ëª…ì„œ ìš”ì•½','ìƒí’ˆë³„ì ìš©ì•½ê´€','ì™¸í™”ë³´í†µì˜ˆê¸ˆ ìƒí’ˆì„¤ëª…ì„œ','ì„¤ëª…ì˜ë¬´ê´€ë ¨í™•ì¸ì„œ(ì°¨ëª…ê±°ë˜ê¸ˆì§€ì— ê´€í•œ ì„¤ëª…)','ê°œì¸(ì‹ ìš©)ì •ë³´ ìˆ˜ì§‘Â·ì´ìš©Â·ì œê³µÂ·ì¡°íšŒ ë™ì˜ì„œ<br>(ë¹„ëŒ€ë©´ ê³„ì¢Œê°œì„¤ ì•ˆì‹¬ì°¨ë‹¨)'
      ][idx];
      if (idx > 0) {
        if (!h4Element) {
          h4Element = document.createElement('h4');
          h4Element.classList.add('font-bold','text-gray-800','text-lg','mb-4','text-center');
          currentPageElement.prepend(h4Element);
        }
        h4Element.innerHTML = currentTitle;
      } else if (idx === 0 && h4Element) {
        h4Element.classList.add('text-center');
      }
    }

    function handleTermsAgreeButton(){
      termsCurrentPage++;
      if(termsCurrentPage < termsPages.length){
        showTermsPage(termsCurrentPage);
      } else {
        isTermsAndExplanationsAgreed = true;
        closeModal('termsModal');
        termsCurrentPage = 0;
        showTermsPage(termsCurrentPage);
        updateAgreementConsentSectionStatus();
        updateAgreementButtonsState();
        updateNextButtonState();
        openModal('sendDocumentsModal');
      }
    }

    function handleCustomerCheckAgreeBtn(){
      closeModal('customerCheckModal');
      openModal('customerCheckModalPart2');
    }

    function handleCustomerCheckAgreeBtnPart2(){
      closeModal('customerCheckModalPart2');
      openModal('electronicSignatureModal');
    }

    function handleCompleteElectronicSignature(){
      if (signatureConsentCheckbox.checked && isSignatureDrawn) {
        isElectronicSignatureCompleted = true;
        isCustomerCheckConfirmed = true;
        closeModal('electronicSignatureModal');
        updateAgreementConsentSectionStatus();
        updateAgreementButtonsState();
        updateNextButtonState();
      } else {
        if (!signatureConsentCheckbox.checked && !isSignatureDrawn) showInfoModal('ì „ìì„œëª…ì„ ì™„ë£Œí•˜ë ¤ë©´ ì„œëª…ì„ ê·¸ë¦¬ê³  ë™ì˜ ì²´í¬ë°•ìŠ¤ì— ì²´í¬í•´ì£¼ì„¸ìš”.');
        else if (!signatureConsentCheckbox.checked) showInfoModal('ì „ìì„œëª…ì„ ì™„ë£Œí•˜ë ¤ë©´ ë™ì˜ ì²´í¬ë°•ìŠ¤ì— ì²´í¬í•´ì£¼ì„¸ìš”.');
        else if (!isSignatureDrawn) showInfoModal('ì „ìì„œëª…ì„ ì™„ë£Œí•˜ë ¤ë©´ ì„œëª…ì„ ê·¸ë ¤ì£¼ì„¸ìš”.');
      }
    }

    function updateAgreementConsentSectionStatus(){
      if(isTermsAndExplanationsAgreed && isElectronicSignatureCompleted){
        agreementConsentCheckmark.style.display = 'inline-block';
        agreementConsentSection.classList.add('confirmed');
        setTimeout(()=>{
          agreementConsentContent.classList.add('collapsed');
          agreementConsentTitle.classList.remove('rotated');
          enrollmentContentInner.classList.remove('collapsed');
          enrollmentContentTitle.classList.add('rotated');
        },350);
      }
      updateNextButtonState();
    }

    function updateEnrollmentContentStatus() {
      isEnrollmentAmountFilled = enrollmentAmountInput.value.trim() !== '' && parseInt(enrollmentAmountInput.value) > 0;
      isCurrencySelected = currencySelect.value.trim() !== '';
      if (isEnrollmentAmountFilled && isCurrencySelected && isWithdrawalEstimateLookedUp && isWithdrawalAccountFilled) {
        enrollmentContentCheckmark.style.display = 'inline-block';
        enrollmentContentSection.classList.add('confirmed');
      } else {
        enrollmentContentCheckmark.style.display = 'none';
        enrollmentContentSection.classList.remove('confirmed');
      }
      updateNextButtonState();
    }

    /* === ì„œë¥˜ ì „ì†¡ (í•˜ë‚˜ë§Œ ì„±ê³µí•´ë„ ë‹«ê¸°/X ë²„íŠ¼ í™œì„±í™”) === */
    function enableSendModalCloseButtons() {
      hasDeliveredDocuments = true;
      sendDocumentsModalCloseBtn.disabled = false;
      sendDocumentsModalCloseX.disabled = false;
    }

    async function sendDocumentsBySms() {
      const phoneNumber = smsNumberInput.value.trim();
      if (!phoneNumber) { showInfoModal('íœ´ëŒ€í° ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.'); return; }
      const message = `BNK ì‡¼í•‘í™˜ì „í†µì¥ í•„ìˆ˜ ì„œë¥˜ì…ë‹ˆë‹¤:\n${googleDriveFileUrls.join('\n')}`;
      showInfoModal('ì„œë¥˜ ì „ì†¡ ì¤‘...');
      try {
        await new Promise(r => setTimeout(r, 800));
        console.log(`[SMS ì „ì†¡(ì‹œë®¬ë ˆì´ì…˜)] ${phoneNumber}\n${message}`);
        showInfoModal(`í•„ìˆ˜ ì„œë¥˜ê°€\n${phoneNumber}(ìœ¼)ë¡œ\nì „ì†¡ë˜ì—ˆìŠµë‹ˆë‹¤.`);
        enableSendModalCloseButtons();
      } catch (e) {
        showInfoModal('SMS ì „ì†¡ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
      }
    }

    async function sendDocumentsByEmail() {
      const emailAddress = emailAddressInput.value.trim();
      if (!emailAddress || !emailAddress.includes('@')) { showInfoModal('ìœ íš¨í•œ ì´ë©”ì¼ ì£¼ì†Œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.'); return; }
      const subject = 'BNK ì‡¼í•‘í™˜ì „í†µì¥ í•„ìˆ˜ ì„œë¥˜ì…ë‹ˆë‹¤.';
      const body = `BNK ì‡¼í•‘í™˜ì „í†µì¥ ê°€ì…ì— í•„ìš”í•œ í•„ìˆ˜ ì„œë¥˜ë¥¼ ë³´ë‚´ë“œë¦½ë‹ˆë‹¤.\n\n${googleDriveFileUrls.join('\n')}\n\nê°ì‚¬í•©ë‹ˆë‹¤.`;
      showInfoModal('ì„œë¥˜ ì „ì†¡ ì¤‘...');
      try {
        await new Promise(r => setTimeout(r, 800));
        console.log(`[ì´ë©”ì¼ ì „ì†¡(ì‹œë®¬ë ˆì´ì…˜)] ${emailAddress}\n${subject}\n${body}`);
        showInfoModal(`í•„ìˆ˜ ì„œë¥˜ê°€\n${emailAddress}(ìœ¼)ë¡œ\nì „ì†¡ë˜ì—ˆìŠµë‹ˆë‹¤.`);
        enableSendModalCloseButtons();
      } catch (e) {
        showInfoModal('ì´ë©”ì¼ ì „ì†¡ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
      }
    }

    // ë‹«ê¸° ë²„íŠ¼/ X ë²„íŠ¼: í™œì„±í™”ë˜ë©´ ì‹¤ì œë¡œ ë‹«íˆë„ë¡
    sendDocumentsModalCloseBtn.addEventListener('click', () => {
      if (!sendDocumentsModalCloseBtn.disabled) closeModal('sendDocumentsModal');
    });
    sendDocumentsModalCloseX.addEventListener('click', () => {
      if (!sendDocumentsModalCloseX.disabled) closeModal('sendDocumentsModal');
    });

    function showInfoModal(message) {
      const modalId = 'infoModal';
      let infoModal = document.getElementById(modalId);
      if (!infoModal) {
        infoModal = document.createElement('div');
        infoModal.id = modalId;
        infoModal.classList.add('modal-overlay','hidden');
        infoModal.innerHTML = `
          <div class="modal-content w-4/5 h-auto max-h-[80svh] m-auto">
            <div class="modal-header">
              <h3>ì•ˆë‚´</h3>
              <button class="modal-close-button" onclick="closeModal('${modalId}')">&times;</button>
            </div>
            <div class="modal-body p-4 text-gray-700 whitespace-pre-wrap text-center">
              <p id="infoModalMessage" class="info-modal-text-center"></p>
            </div>
            <div class="modal-footer">
              <button class="modal-button primary" onclick="closeModal('${modalId}')">í™•ì¸</button>
            </div>
          </div>`;
        document.body.appendChild(infoModal);
      }
      document.getElementById('infoModalMessage').textContent = message;
      openModal(modalId);
    }

    /* === ì„œëª… íŒ¨ë“œ === */
    function initializeSignaturePad() {
      const bodyEl = electronicSignatureModal.querySelector('.modal-body');
      const w = Math.min(bodyEl.clientWidth - 32, 320);
      signatureCanvas.width = w;
      signatureCanvas.height = 150;
      signatureCtx.clearRect(0,0,signatureCanvas.width,signatureCanvas.height);
      signatureCtx.lineWidth = 2;
      signatureCtx.lineCap = 'round';
      signatureCtx.strokeStyle = '#000';
      isSignatureDrawn = false;
      updateSignatureButtonState();
    }

    function startDrawing(e) {
      e.preventDefault();
      isDrawing = true;
      const { clientX, clientY } = e.touches ? e.touches[0] : e;
      const rect = signatureCanvas.getBoundingClientRect();
      lastX = clientX - rect.left; lastY = clientY - rect.top;
    }
    function draw(e) {
      if (!isDrawing) return;
      e.preventDefault();
      const { clientX, clientY } = e.touches ? e.touches[0] : e;
      const rect = signatureCanvas.getBoundingClientRect();
      const x = clientX - rect.left; const y = clientY - rect.top;
      signatureCtx.beginPath(); signatureCtx.moveTo(lastX,lastY); signatureCtx.lineTo(x,y); signatureCtx.stroke();
      lastX = x; lastY = y;
      if (!isSignatureDrawn) { isSignatureDrawn = true; updateSignatureButtonState(); }
    }
    function stopDrawing() { isDrawing = false; }
    function clearSignature() { signatureCtx.clearRect(0,0,signatureCanvas.width,signatureCanvas.height); isSignatureDrawn = false; updateSignatureButtonState(); }
    function updateSignatureButtonState() {
      completeElectronicSignatureBtn.disabled = !(signatureConsentCheckbox.checked && isSignatureDrawn);
      completeElectronicSignatureBtn.classList.toggle('bg-gray-400', completeElectronicSignatureBtn.disabled);
      completeElectronicSignatureBtn.classList.toggle('cursor-not-allowed', completeElectronicSignatureBtn.disabled);
      completeElectronicSignatureBtn.classList.toggle('bg-blue-500', !completeElectronicSignatureBtn.disabled);
      completeElectronicSignatureBtn.classList.toggle('hover:bg-blue-600', !completeElectronicSignatureBtn.disabled);
    }

    document.addEventListener('DOMContentLoaded', initializeUI);

    document.getElementById('enrollmentContentSection').querySelector('.section-title').addEventListener('click', ()=>{
      enrollmentContentInner.classList.toggle('collapsed');
      enrollmentContentTitle.classList.toggle('rotated');
    });

    agreementConsentTitle.addEventListener('click', ()=>{
      if(!agreementConsentSection.classList.contains('confirmed')){
        agreementConsentContent.classList.toggle('collapsed');
        agreementConsentTitle.classList.toggle('rotated');
      }
    });

    homeButton.addEventListener('click', (e)=>{ e.preventDefault(); window.location.href='/foreign'; });
    prevButton.addEventListener('click', ()=>{ window.location.href='/foreign4'; });

    // ===== í™˜ìœ¨ ê³„ì‚° =====
    // USDë§Œ ì‹¤ì‹œê°„, ìš°ëŒ€ìœ¨ 50% ì ìš©(ê¸°ë³¸ ìŠ¤í”„ë ˆë“œ 2.4% ê°€ì • â†’ 1.2% ì ìš©)
    const BASE_SPREAD = 0.024;     // ê³ ì‹œ ìŠ¤í”„ë ˆë“œ(ê°€ì •)
    const DISCOUNT_RATE = 0.5;     // ìš°ëŒ€ìœ¨ 50%
    const EFFECTIVE_SPREAD = BASE_SPREAD * (1 - DISCOUNT_RATE); // 0.012

    const unitFactorByOption = { 'JPY100': 100, 'IDR100': 100 }; // 100ë‹¨ìœ„ í‘œê¸°
    const codeFromOption = (opt) => opt.replace('100','');

    const fallbackRatesToKRW = { // ë¹„-USDëŠ” ì„ì‹œ ê³ ì •ì¹˜(ëŒ€ëµê°’)
      'USD': 1350, 'JPY': 13.5, 'TWD': 45, 'SGD': 1000, 'IDR': 0.09, 'CNY': 180,
      'THB': 38, 'PHP': 25, 'HKD': 170, 'MYR': 290, 'NZD': 850, 'AUD': 900,
      'CAD': 980, 'CHF': 1500, 'GBP': 1600, 'EUR': 1450
    };

    async function getUsdKrwMid() {
      try {
        const res = await fetch('https://api.exchangerate.host/latest?base=USD&symbols=KRW', { cache:'no-store' });
        if(!res.ok) throw new Error('rate fetch failed');
        const data = await res.json();
        const mid = data?.rates?.KRW;
        if (typeof mid !== 'number') throw new Error('invalid rate');
        return mid;
      } catch(e) {
        return fallbackRatesToKRW['USD'];
      }
    }

    async function lookupEstimate() {
      const amount = parseInt(enrollmentAmountInput.value);
      const optionValue = currencySelect.value;

      if (!(amount > 0) || !optionValue) {
        krwDisplayAmount.textContent = '0 ì›';
        isWithdrawalEstimateLookedUp = false;
        showInfoModal('ê°€ì… ê¸ˆì•¡ê³¼ í†µí™”ë¥¼ ëª¨ë‘ ì…ë ¥(ì„ íƒ)í•˜ê³  0ë³´ë‹¤ í° ê°’ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
        updateEnrollmentContentStatus();
        return;
      }

      const code = codeFromOption(optionValue);

      // USDë§Œ ì •í™• ê³„ì‚°
      if (code === 'USD') {
        const mid = await getUsdKrwMid();                 // 1 USDì˜ ì¤‘ê°„í™˜ìœ¨(KRW)
        const applied = mid * (1 + EFFECTIVE_SPREAD);     // ìš°ëŒ€ 50% ë°˜ì˜ëœ ë§¤ì…í™˜ìœ¨
        const estimatedKRW = Math.round(amount * applied);
        krwDisplayAmount.textContent = `${estimatedKRW.toLocaleString()} ì›`;
        isWithdrawalEstimateLookedUp = true;
        updateEnrollmentContentStatus();
        return;
      }

      // ê·¸ ì™¸ í†µí™”ëŠ” ëª©ë¡ë§Œ â€“ ê°„ë‹¨ ì•ˆë‚´ ë° ëŒ€ëµì¹˜(ê³ ì •) í‘œì‹œ(ì„ íƒì— ë”°ë¥¸ ìˆ«ì ê°ë§Œ ì œê³µ)
      const unit = unitFactorByOption[optionValue] || 1;
      const perUnit = (fallbackRatesToKRW[code] || 0) * unit;
      const approx = Math.round(amount * perUnit);
      krwDisplayAmount.textContent = `${approx.toLocaleString()} ì›`;
      isWithdrawalEstimateLookedUp = false; // ì •í™• ê³„ì‚° ì•„ë‹˜ â†’ ë‹¤ìŒìœ¼ë¡œ ì§„í–‰ ë§‰ìŒ
      updateEnrollmentContentStatus();
      showInfoModal('í˜„ì¬ USDë§Œ ì‹¤ì‹œê°„/ì •í™• ê³„ì‚°ì„ ì§€ì›í•©ë‹ˆë‹¤.\në‹¤ë¥¸ í†µí™”ëŠ” ëª©ë¡ ì„ íƒë§Œ ê°€ëŠ¥í•©ë‹ˆë‹¤.');
    }

    // ì´ë²¤íŠ¸ ë°”ì¸ë”©
    document.getElementById('openTermsModalBtn').addEventListener('click', ()=>{ showTermsPage(0); openModal('termsModal'); });
    document.getElementById('termsAgreeBtn').addEventListener('click', handleTermsAgreeButton);
    document.getElementById('openCustomerCheckModalBtn').addEventListener('click', ()=>openModal('customerCheckModal'));
    customerCheckAgreeBtn.addEventListener('click', handleCustomerCheckAgreeBtn);
    customerCheckAgreeBtnPart2.addEventListener('click', handleCustomerCheckAgreeBtnPart2);

    signatureConsentCheckbox.addEventListener('change', updateSignatureButtonState);
    completeElectronicSignatureBtn.addEventListener('click', handleCompleteElectronicSignature);

    signatureCanvas.addEventListener('mousedown', startDrawing);
    signatureCanvas.addEventListener('mousemove', draw);
    signatureCanvas.addEventListener('mouseup', stopDrawing);
    signatureCanvas.addEventListener('mouseout', stopDrawing);
    signatureCanvas.addEventListener('touchstart', startDrawing, {passive:false});
    signatureCanvas.addEventListener('touchmove', draw, {passive:false});
    signatureCanvas.addEventListener('touchend', stopDrawing);

    clearSignatureBtn.addEventListener('click', clearSignature);

    enrollmentAmountInput.addEventListener('input', ()=>{ isWithdrawalEstimateLookedUp = false; updateEnrollmentContentStatus(); });
    currencySelect.addEventListener('change', ()=>{ isWithdrawalEstimateLookedUp = false; updateEnrollmentContentStatus(); });

    lookupEstimateBtn.addEventListener('click', lookupEstimate);

    // ì„œë¥˜ ì „ì†¡
    sendBySmsBtn.addEventListener('click', sendDocumentsBySms);
    sendByEmailBtn.addEventListener('click', sendDocumentsByEmail);

    // ëª¨ë‹¬ ì˜¤í”ˆ ì‹œ ë‹«ê¸° ë²„íŠ¼ ìƒíƒœ ë™ê¸°í™”
    const originalOpenModal = openModal;
    openModal = function(id) {
      originalOpenModal(id);
      if (id === 'sendDocumentsModal') {
        sendDocumentsModalCloseBtn.disabled = !hasDeliveredDocuments;
        sendDocumentsModalCloseX.disabled = !hasDeliveredDocuments;
      }
    };

    // ===== ë‹¤ìŒ í˜ì´ì§€ë¡œ ê°’ ì „ë‹¬ (sessionStorage) =====
    nextButton.addEventListener('click', ()=>{
      if(isTermsAndExplanationsAgreed && isElectronicSignatureCompleted &&
         isEnrollmentAmountFilled && isCurrencySelected && isWithdrawalEstimateLookedUp && isWithdrawalAccountFilled){

        let signatureDataUrl = '';
        try { signatureDataUrl = signatureCanvas.toDataURL('image/png'); } catch(e) {}

        const payload = {
          currencyDisplay: currencySelect.value,                     // ì˜ˆ: USD, JPY100
          amount: parseInt(enrollmentAmountInput.value),
          krwEstimate: parseInt((krwDisplayAmount.textContent || '0').replace(/[^\d]/g,'')),
          benefitApplied: 50,
          timestamp: new Date().toISOString(),
          signatureDataUrl
        };
        sessionStorage.setItem('bnkEnrollmentData', JSON.stringify(payload));
        window.location.href='/foreign6';
      } else {
        let msg = 'ìƒí’ˆ ê°€ì…ì„ ì™„ë£Œí•˜ë ¤ë©´ ë‹¤ìŒ ì‚¬í•­ì„ í™•ì¸í•´ì•¼ í•©ë‹ˆë‹¤:\n';
        if(!isTermsAndExplanationsAgreed) msg += '- ì•½ê´€ ë° ì„¤ëª…ì„œ ë™ì˜\n';
        if(!isElectronicSignatureCompleted) msg += '- ê³ ê° í™•ì¸ ì‚¬í•­ ë° ì „ìì„œëª… ì™„ë£Œ\n';
        if(!isEnrollmentAmountFilled) msg += '- ê°€ì… ê¸ˆì•¡ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.\n';
        if(!isCurrencySelected) msg += '- í†µí™”ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.\n';
        if(!isWithdrawalEstimateLookedUp) msg += '- ì›í™”ì¶œê¸ˆ ì˜ˆìƒì•¡(USD ê¸°ì¤€)ì„ ì¡°íšŒí•´ì£¼ì„¸ìš”.\n';
        showInfoModal(msg);
      }
    });
  </script>
</body>
</html>
