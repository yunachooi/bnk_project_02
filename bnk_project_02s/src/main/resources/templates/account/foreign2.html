<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>BNK ì‡¼í•‘í™˜ì „í†µì¥ - ë³¸ì¸í™•ì¸</title>
  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Inter font -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
  <style>
    body{font-family:'Inter',sans-serif;background:#f0f4f8;margin:0;padding:0;overflow-x:hidden}
    .container{max-width:500px;margin:0 auto;background:#fff;box-shadow:0 4px 12px rgba(0,0,0,.05);min-height:100vh;display:flex;flex-direction:column;border-radius:1rem;overflow:hidden}
    header{flex:none}
    /* Voice panel */
    .voice-panel{position:absolute;right:.75rem;top:3.25rem;width:300px;background:#fff;border:1px solid #e5e7eb;border-radius:.75rem;box-shadow:0 10px 20px rgba(0,0,0,.08);padding:.75rem;z-index:50;display:none}
    .voice-panel.open{display:block}
    /* Bottom bar */
    .bottom-bar{flex:none;width:100%;background:#fff;border-top:1px solid #e2e8f0;padding:.75rem 1rem;box-shadow:0 -4px 12px rgba(0,0,0,.03);display:flex;justify-content:space-around;gap:.5rem;z-index:10}
    .bottom-bar button{flex:1;padding:.75rem 1rem;border-radius:.75rem;font-weight:600;font-size:.95rem;transition:.3s;box-shadow:0 2px 6px rgba(0,0,0,.1)}
    .bottom-bar button:active{transform:scale(.98)}
    /* Main */
    .main-content{flex-grow:1;padding:1rem;display:flex;flex-direction:column;gap:1rem;overflow-y:auto}
    .content-block{background:#fff;border-radius:.75rem;box-shadow:0 4px 12px rgba(0,0,0,.05);padding:1.5rem;display:flex;flex-direction:column;justify-content:center;align-items:center;text-align:center;min-height:120px}
    .content-block.interactive{cursor:pointer;transition:.2s;justify-content:space-between;flex-direction:row;padding:1rem 1.5rem}
    .content-block.interactive:hover{background:#f8fafc;transform:translateY(-2px)}
    .content-block.interactive:active{transform:scale(.98)}
    /* Consent */
    .consent-status{display:flex;align-items:center;justify-content:center;font-size:.9rem;color:#4a5568;margin-top:.5rem}
    .consent-status.agreed{color:#10b981;font-weight:600}
    .consent-status svg{margin-right:.25rem}
    .consent-accordion-item{width:100%;border:1px solid #e2e8f0;border-radius:.75rem;margin-bottom:.75rem;overflow:hidden;background:#fff}
    .consent-accordion-header{display:flex;align-items:center;justify-content:space-between;padding:1rem 1.25rem;cursor:pointer;background:#fff;transition:.2s}
    .consent-accordion-header:hover{background:#f8fafc}
    .consent-accordion-title{display:flex;align-items:center;flex-grow:1;text-align:left}
    .consent-accordion-text{font-size:1rem;font-weight:600;color:#374151}
    .consent-checkmark{color:#10b981;font-size:1.2rem;margin-left:.5rem;display:none}
    .consent-accordion-content{max-height:0;overflow:hidden;transition:max-height .5s ease-out,padding .5s ease-out;padding:0;color:#4a5568;line-height:1.5;border-top:1px solid #e2e8f0;margin-top:0}
    .consent-accordion-content.open{max-height:80vh;padding:1rem 1.25rem}
    .consent-accordion-icon{transition:transform .3s ease;color:#9ca3af}
    .consent-accordion-icon.rotate{transform:rotate(180deg)}
    .summary-styled-section{background:#e0f2fe;border-radius:.5rem;padding:1rem;margin-bottom:1rem;text-align:left}
    .full-content-styled-section{background:#FFF9FC;border-radius:.5rem;padding:1rem;display:flex;flex-direction:column;text-align:left}
    .full-content-styled-section h4{margin-top:0;margin-bottom:.5rem;text-align:left}
    .full-content-scroll-area{max-height:150px;overflow-y:auto;text-align:left;padding-right:.5rem;flex-grow:1}
    .agree-button-container-in-content{display:flex;justify-content:center;padding-top:1rem;border-top:1px solid #e2e8f0;margin-top:1rem}
    .agree-button{background:#2563eb;color:#fff;padding:.75rem 1.5rem;border-radius:.5rem;font-weight:600;transition:.2s;cursor:pointer;width:100%}
    .agree-button:hover:not(:disabled){background:#1d4ed8}
    .agree-button:disabled{opacity:.5;cursor:not-allowed}
    .highlighted-text{color:#2563eb;font-weight:600}
    /* Modals */
    .modal-overlay{position:fixed;inset:0;background:rgba(0,0,0,.5);display:flex;justify-content:center;align-items:center;z-index:1000;opacity:0;visibility:hidden;transition:opacity .25s,visibility .25s}
    .modal-overlay.open{opacity:1;visibility:visible}
    .modal-content{background:#fff;padding:2rem;border-radius:.75rem;box-shadow:0 8px 16px rgba(0,0,0,.2);text-align:center;max-width:350px;width:90%;transform:translateY(-20px);transition:transform .25s}
    .modal-overlay.open .modal-content{transform:translateY(0)}
    .modal-message-break-word{word-break:keep-all;white-space:normal}
    .modal-content-details{max-height:60vh;overflow-y:auto;text-align:left;font-size:.875rem;line-height:1.5;color:#4a5568;margin-top:1rem;padding-right:.5rem}
    .modal-content button:disabled{opacity:.5;cursor:not-allowed}
    /* Step bar */
    .step-indicator{display:flex;width:100%;height:4px;background:#e0e0e0;border-radius:2px;overflow:hidden;margin-top:.5rem}
    .step-indicator-progress{width:33.33%;height:100%;background:#2563eb;border-radius:2px}
    #encouragementMessage{white-space:pre-wrap}
  </style>
</head>
<body class="bg-gray-100 min-h-screen flex items-center justify-center">
  <div class="container">
    <!-- Header: 3ì—´ ê·¸ë¦¬ë“œë¡œ ì¤‘ì•™ ì •ë ¬ ë³´ì¥ -->
    <header class="relative grid grid-cols-3 items-center p-4 bg-white border-b border-gray-200">
      <a href="/foreign" class="justify-self-start flex items-center text-blue-700 font-medium text-base hover:text-blue-800 transition-colors duration-300" aria-label="í™ˆìœ¼ë¡œ ì´ë™">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" aria-hidden="true">
          <path stroke-linecap="round" stroke-linejoin="round" d="M15 19l-7-7 7-7"/>
        </svg>
        í™ˆìœ¼ë¡œ
      </a>

      <h1 class="justify-self-center text-xl font-bold text-gray-800 text-center" aria-live="polite">ë³¸ì¸í™•ì¸</h1>

      <!-- ìŒì„± ì•ˆë‚´: ë²„íŠ¼ + íŒ¨ë„ -->
      <div class="justify-self-end relative">
        <button id="voiceGuideBtn"
                class="px-2 py-1 rounded-full text-gray-700 bg-gray-100 hover:bg-gray-200 focus:outline-none focus:ring-2 focus:ring-blue-500 flex items-center gap-1"
                aria-pressed="false"
                aria-label="ìŒì„± ì•ˆë‚´ ì¼œê¸°"
                title="ìŒì„± ì•ˆë‚´ ì¼œê¸°">
          <!-- Play -->
          <svg id="voiceIconPlay" xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 block" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
            <path d="M3 10v4a1 1 0 001 1h3l3.293 3.293A1 1 0 0011 18v-12a1 1 0 00-1.707-.707L7 8H4a1 1 0 00-1 1zm13.586-3.414a1 1 0 10-1.414 1.414A5.969 5.969 0 0117 12c0 1.657-.672 3.157-1.828 4.243a1 1 0 101.414 1.414A7.968 7.968 0 0019 12a7.968 7.968 0 00-2.414-5.414z"/>
          </svg>
          <!-- Stop -->
          <svg id="voiceIconStop" xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 hidden" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
            <path d="M6 6h12v12H6z"/>
          </svg>
          <span id="voiceLabel" class="text-xs font-semibold">ìŒì„± ì•ˆë‚´ ì¼œê¸°</span>
        </button>

        <div id="voicePanel" class="voice-panel" role="dialog" aria-label="ìŒì„± ì•ˆë‚´ ì„¤ì •">
          <div class="mb-2 flex items-center justify-between">
            <p class="text-sm font-semibold text-gray-800">ìŒì„± ì•ˆë‚´</p>
            <!-- ë‹«ì•„ë„ ì¬ìƒ ìœ ì§€ -->
            <button id="voiceCloseBtn" class="text-gray-500 hover:text-gray-700 text-xs px-2 py-1 rounded" aria-label="ì„¤ì • ë‹«ê¸°">ë‹«ê¸°</button>
          </div>

          <!-- ì†ë„ ì˜ì—­ ëŒ€ì‹  ë„ì›€ë§ í…ìŠ¤íŠ¸ -->
          <div class="mb-3 text-xs text-gray-700 leading-5">
            <p class="mb-1">ì‹œì‘/ì •ì§€: ìš°ì¸¡ ìƒë‹¨ â€˜<span class="font-semibold">ìŒì„± ì•ˆë‚´ ì¼œê¸°Â·ë„ê¸°</span>â€™ ë²„íŠ¼ì„ ëˆ„ë¥´ì„¸ìš”. ì°½ì„ ë‹«ì•„ë„ ìŒì„±ì€ ê³„ì† ì¬ìƒë©ë‹ˆë‹¤. í•„ìš” ì‹œ ë²„íŠ¼ì„ ë‹¤ì‹œ ëˆŒëŸ¬ ì¤‘ì§€í•  ìˆ˜ ìˆì–´ìš”.</p>
          </div>

          <div class="flex">
            <button id="voiceReplayBtn" class="flex-1 bg-blue-600 text-white rounded-md px-3 py-2 text-sm font-semibold hover:bg-blue-700">ë‹¤ì‹œ ë“£ê¸°</button>
          </div>
        </div>
      </div>
    </header>

    <!-- Step Indicator -->
    <div class="step-indicator mx-4 mt-4" aria-hidden="true">
      <div class="step-indicator-progress"></div>
    </div>

    <!-- Encouragement -->
    <div id="encouragementMessage" class="text-center text-base font-semibold text-gray-700 p-3 rounded-lg bg-yellow-100 mx-4 mt-4 shadow-sm"></div>

    <!-- Main -->
    <main class="main-content">
      <div class="content-block h-auto py-6">
        <p class="text-lg font-bold text-gray-800 mb-4">í•„ìˆ˜ ì •ë³´ ìˆ˜ì§‘ ë° ì´ìš© ë™ì˜</p>

        <!-- ê°œì¸ì •ë³´ ë™ì˜ -->
        <div class="consent-accordion-item" id="personalInfoConsentItem">
          <div class="consent-accordion-header" id="personalInfoHeader" data-target="personalInfoConsentContent" role="button" tabindex="0" aria-controls="personalInfoConsentContent" aria-expanded="false" aria-describedby="personalInfoSummary">
            <div class="consent-accordion-title">
              <span class="consent-accordion-text">ê°œì¸ì •ë³´ ìˆ˜ì§‘ ë° ì´ìš© ë™ì˜</span>
              <span id="personalInfoCheckmark" class="consent-checkmark" aria-hidden="true">âœ”</span>
            </div>
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 ml-2 consent-accordion-icon" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" aria-hidden="true">
              <path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7"/>
            </svg>
          </div>
          <div id="personalInfoConsentContent" class="consent-accordion-content" role="region" aria-labelledby="personalInfoHeader">
            <div class="summary-styled-section" id="personalInfoSummary">
              <h4 class="font-semibold text-sm mb-1">í•µì‹¬ ìš”ì•½</h4>
              <p class="mb-0">BNKì‡¼í•‘í™˜ì „ì˜ˆê¸ˆ í†µì¥ ë° ì¹´ë“œ ê°œì„¤, í™˜ì „/ê²°ì œ ì œê³µì„ ìœ„í•´ ìµœì†Œí•œì˜ ê°œì¸ì •ë³´ë¥¼ ìˆ˜ì§‘Â·ì´ìš©í•©ë‹ˆë‹¤.</p>
            </div>
            <div class="full-content-styled-section">
              <h4 class="font-semibold text-sm mb-1">ì „ì²´ ë‚´ìš©</h4>
              <div class="full-content-scroll-area" id="personalInfoFullContent">
                <h4 class="font-semibold text-sm mb-1">1. ìˆ˜ì§‘ ëª©ì </h4>
                <p class="mb-2">í†µì¥ ê°œì„¤, ì¹´ë“œ ë°œê¸‰, í™˜ì „/í•´ì™¸ê²°ì œ ì œê³µ, ë³¸ì¸í™•ì¸, ê±°ë˜ ì²˜ë¦¬(ì´ì²´, í™˜ì „ ê¸°ë¡, ë¶€ì •ê±°ë˜ ë°©ì§€ ë“±), ìƒë‹´/ë¯¼ì› ì²˜ë¦¬, ë²•ë ¹ìƒ ì˜ë¬´ ì´í–‰.</p>
                <h4 class="font-semibold text-sm mb-1">2. ìˆ˜ì§‘ í•­ëª©</h4>
                <p class="mb-2">
                  <span class="highlighted-text">ê°œì¸ì‹ë³„ì •ë³´:</span> ì„±ëª…, ì£¼ë¯¼/ì™¸êµ­ì¸ë“±ë¡ë²ˆí˜¸, íœ´ëŒ€í°, ì£¼ì†Œ, ì´ë©”ì¼, ì§ì—….<br>
                  <span class="highlighted-text">ê¸ˆìœµê±°ë˜ì •ë³´:</span> ê³„ì¢Œë²ˆí˜¸, ê±°ë˜ë‚´ì—­, ì”ì•¡, í™˜ì „ ê¸°ë¡, ì¹´ë“œ ì´ìš© ë‚´ì—­.<br>
                  <span class="highlighted-text">ì‹ ë¶„ì¦ ì •ë³´:</span> ì„±ëª…, ë²ˆí˜¸, ë°œê¸‰ì¼, ì‚¬ì§„ ë“±.<br>
                  <span class="highlighted-text">ì ‘ê·¼ë§¤ì²´:</span> ì „ìê¸ˆìœµ ë¹„ë°€ë²ˆí˜¸, ì¸ì¦ì„œ ë“±.
                </p>
                <h4 class="font-semibold text-sm mb-1">3. ë³´ìœ  ê¸°ê°„</h4>
                <p class="mb-2">ê¸ˆìœµê±°ë˜ ì¢…ë£Œì¼ë¡œë¶€í„° 5ë…„(ê´€ë ¨ ë²•ë ¹ì— ë”°ë¥¸ ë³´ì¡´ê¸°ê°„ ìš°ì„ ), ëª©ì  ë‹¬ì„± ë˜ëŠ” í•´ì§€ ì‹œ íŒŒê¸°.</p>
                <h4 class="font-semibold text-sm mb-1">4. ë™ì˜ ê±°ë¶€ ì‹œ ë¶ˆì´ìµ</h4>
                <p class="mb-2">ë™ì˜í•˜ì§€ ì•Šìœ¼ë©´ í†µì¥/ì¹´ë“œ ê°œì„¤ ë° ê´€ë ¨ ì„œë¹„ìŠ¤ ì´ìš©ì´ ì œí•œë©ë‹ˆë‹¤.</p>
              </div>
            </div>
            <div class="agree-button-container-in-content">
              <button id="personalInfoAgreeBtn" class="agree-button" aria-describedby="personalInfoSummary">ë™ì˜í•©ë‹ˆë‹¤</button>
            </div>
          </div>
        </div>

        <!-- ë¯¼ê°ì •ë³´ ë™ì˜ -->
        <div class="consent-accordion-item" id="sensitiveInfoConsentItem" style="display:block">
          <div class="consent-accordion-header" id="sensitiveInfoHeader" data-target="sensitiveInfoConsentContent" role="button" tabindex="0" aria-controls="sensitiveInfoConsentContent" aria-expanded="false" aria-describedby="sensitiveInfoSummary">
            <div class="consent-accordion-title">
              <span class="consent-accordion-text">ë¯¼ê°í•œ ì •ë³´ ìˆ˜ì§‘ ë° ì´ìš© ë™ì˜</span>
              <span id="sensitiveInfoCheckmark" class="consent-checkmark" aria-hidden="true">âœ”</span>
            </div>
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 ml-2 consent-accordion-icon" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" aria-hidden="true">
              <path stroke-linecap="round" stroke-linejoin="round" d="M19 9l-7 7-7-7"/>
            </svg>
          </div>
          <div id="sensitiveInfoConsentContent" class="consent-accordion-content" role="region" aria-labelledby="sensitiveInfoHeader">
            <div class="summary-styled-section" id="sensitiveInfoSummary">
              <h4 class="font-semibold text-sm mb-1">í•µì‹¬ ìš”ì•½</h4>
              <p class="mb-0">ë¹„ëŒ€ë©´ ì‹¤ëª…í™•ì¸ì„ ìœ„í•´ í•„ìš”í•œ ë²”ìœ„ì˜ ë¯¼ê°ì •ë³´(ì˜ˆ: ìƒì²´ì •ë³´)ë¥¼ ë³¸ì¸í™•ì¸ ë° ì•ˆì •ì„± í™•ë³´ ëª©ì ìœ¼ë¡œë§Œ ì‚¬ìš©í•©ë‹ˆë‹¤.</p>
            </div>
            <div class="full-content-styled-section">
              <h4 class="font-semibold text-sm mb-1">ì „ì²´ ë‚´ìš©</h4>
              <div class="full-content-scroll-area" id="sensitiveInfoFullContent">
                <h4 class="font-semibold text-sm mb-1">1. ìˆ˜ì§‘ ëª©ì </h4>
                <p class="mb-2">ê³„ì¢Œ ê°œì„¤Â·ì¹´ë“œ ë°œê¸‰ ì‹œ ë¹„ëŒ€ë©´ ë³¸ì¸í™•ì¸, ë¶€ì •ì‚¬ìš© ë°©ì§€, ê±°ë˜ ì•ˆì •ì„± í™•ë³´.</p>
                <h4 class="font-semibold text-sm mb-1">2. ìˆ˜ì§‘ í•­ëª©</h4>
                <p class="mb-2"><span class="highlighted-text">ë¯¼ê° ì •ë³´:</span> ë³¸ì¸í™•ì¸ì— í•„ìš”í•œ ìƒì²´ ë“± íŠ¹ì • ì •ë³´. <br><span class="highlighted-text">ì‹ ë¶„ì¦ ë‚´ ë¯¼ê° ì •ë³´:</span> ì§€ë¬¸ ë“± í¬í•¨ ê°€ëŠ¥.</p>
                <h4 class="font-semibold text-sm mb-1">3. ë³´ìœ  ê¸°ê°„</h4>
                <p class="mb-2">ì ˆì°¨ ì™„ë£Œ ë˜ëŠ” ëª©ì  ë‹¬ì„± ì‹œ íŒŒê¸°(ë²•ë ¹ ë³´ì¡´ì˜ë¬´ ì‹œ ê·¸ ê¸°ê°„ ì¤€ìˆ˜).</p>
                <h4 class="font-semibold text-sm mb-1">4. ë™ì˜ ê±°ë¶€ ì‹œ ë¶ˆì´ìµ</h4>
                <p class="mb-2">ë™ì˜í•˜ì§€ ì•Šìœ¼ë©´ ë¹„ëŒ€ë©´ ë³¸ì¸í™•ì¸ì„ ì´ìš©í•  ìˆ˜ ì—†ìœ¼ë©° ë‹¤ë¥¸ ì¸ì¦ìˆ˜ë‹¨(íƒ€í–‰ ê³„ì¢Œ ì¸ì¦ ë“±)ì„ ì‚¬ìš©í•©ë‹ˆë‹¤.</p>
              </div>
            </div>
            <div class="agree-button-container-in-content">
              <button id="sensitiveInfoAgreeBtn" class="agree-button" aria-describedby="sensitiveInfoSummary">ë™ì˜í•©ë‹ˆë‹¤</button>
            </div>
          </div>
        </div>

        <div id="consentStatus" class="consent-status mt-3 hidden" aria-live="polite">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-green-500" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
          </svg>
          <span class="agreed">ëª¨ë“  í•„ìˆ˜ ë™ì˜ ì™„ë£Œ</span>
        </div>
      </div>
    </main>

    <!-- Bottom bar -->
    <footer class="bottom-bar">
      <button id="prevButton" class="bg-gray-200 text-gray-700 hover:bg-gray-300">ì´ì „</button>
      <button id="nextButton" class="bg-blue-600 text-white hover:bg-blue-700">ì‹ ë¶„ì¦ ì´¬ì˜</button>
    </footer>
  </div>

  <!-- Login Required Modal -->
  <div id="loginRequiredModal" class="modal-overlay">
    <div class="modal-content">
      <h3 class="text-xl font-bold mb-4 text-gray-800">ë¡œê·¸ì¸ í•„ìš” ì•ˆë‚´</h3>
      <p class="text-gray-700 mb-6 modal-message-break-word">
        ì£„ì†¡í•©ë‹ˆë‹¤, ê³ ê°ë‹˜.<br>í•´ë‹¹ ì„œë¹„ìŠ¤ëŠ” ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.<br>ë¡œê·¸ì¸ í›„ ë‹¤ì‹œ ì´ìš©í•´ì£¼ì„¸ìš”.
      </p>
      <div class="flex justify-center">
        <button id="loginRequiredConfirmBtn" class="bg-blue-600 text-white px-5 py-2 rounded-md font-semibold hover:bg-blue-700 transition duration-200">í™•ì¸</button>
      </div>
    </div>
  </div>

  <!-- ID Card Guidance Modal -->
  <div id="idCardGuidanceModal" class="modal-overlay">
    <div class="modal-content">
      <h3 class="text-xl font-bold mb-4 text-gray-800">ì‹ ë¶„ì¦ ì´¬ì˜ ì•ˆë‚´</h3>
      <p class="text-gray-700 mb-6 modal-message-break-word">
        ì •í™•í•œ ì¸ì‹ì„ ìœ„í•´ ì´¬ì˜ ì „<br>ë Œì¦ˆë¥¼ ê¹¨ë—ì´ ë‹¦ì•„ ì£¼ì„¸ìš”! ğŸ˜Š
      </p>
      <div class="flex justify-center">
        <button id="idCardGuidanceConfirmBtn" class="bg-blue-600 text-white px-5 py-2 rounded-md font-semibold hover:bg-blue-700 transition duration-200">í™•ì¸</button>
      </div>
    </div>
  </div>

  <script>
    /* =========================
       ê³µí†µ DOM
    ========================= */
    const personalInfoConsentItem = document.getElementById('personalInfoConsentItem');
    const personalInfoConsentHeader = document.getElementById('personalInfoHeader');
    const personalInfoAgreeBtn = document.getElementById('personalInfoAgreeBtn');
    const personalInfoCheckmark = document.getElementById('personalInfoCheckmark');
    const personalInfoAccordionIcon = personalInfoConsentItem.querySelector('.consent-accordion-icon');
    const personalInfoConsentContent = personalInfoConsentItem.querySelector('.consent-accordion-content');

    const sensitiveInfoConsentItem = document.getElementById('sensitiveInfoConsentItem');
    const sensitiveInfoConsentHeader = document.getElementById('sensitiveInfoHeader');
    const sensitiveInfoAgreeBtn = document.getElementById('sensitiveInfoAgreeBtn');
    const sensitiveInfoCheckmark = document.getElementById('sensitiveInfoCheckmark');
    const sensitiveInfoAccordionIcon = sensitiveInfoConsentItem.querySelector('.consent-accordion-icon');
    const sensitiveInfoConsentContent = sensitiveInfoConsentItem.querySelector('.consent-accordion-content');

    const consentStatusDiv = document.getElementById('consentStatus');
    const nextButton = document.getElementById('nextButton');
    const prevButton = document.getElementById('prevButton');
    const homeLink = document.querySelector('header a');
    const encouragementMessageDiv = document.getElementById('encouragementMessage');

    const loginRequiredModal = document.getElementById('loginRequiredModal');
    const loginRequiredConfirmBtn = document.getElementById('loginRequiredConfirmBtn');
    const idCardGuidanceModal = document.getElementById('idCardGuidanceModal');
    const idCardGuidanceConfirmBtn = document.getElementById('idCardGuidanceConfirmBtn');

    // Voice UI
    const voiceBtn = document.getElementById('voiceGuideBtn');
    const voiceIconPlay = document.getElementById('voiceIconPlay');
    const voiceIconStop = document.getElementById('voiceIconStop');
    const voiceLabel = document.getElementById('voiceLabel');
    const voicePanel = document.getElementById('voicePanel');
    const voiceCloseBtn = document.getElementById('voiceCloseBtn');
    const voiceReplayBtn = document.getElementById('voiceReplayBtn');

    /* =========================
       ìƒíƒœ
    ========================= */
    let isPersonalInfoAgreed = false;
    let isSensitiveInfoAgreed = false;

    /* =========================
       ì´ˆê¸°í™”
    ========================= */
    function initializeUI(){
      updateEncouragementMessage('âœ¨ í†µì¥ ê°œì„¤ì„ ìœ„í•´ í•„ìˆ˜ ì•½ê´€ì— ë™ì˜í•´ì£¼ì„¸ìš”.');

      // ì•„ì½”ë””ì–¸ ì ‘ê¸°
      personalInfoConsentContent.classList.remove('open');
      personalInfoAccordionIcon.classList.remove('rotate');
      personalInfoCheckmark.style.display = 'none';

      sensitiveInfoConsentContent.classList.remove('open');
      sensitiveInfoAccordionIcon.classList.remove('rotate');
      sensitiveInfoCheckmark.style.display = 'none';

      disableNextButton();
      consentStatusDiv.classList.add('hidden');
    }

    /* =========================
       UI ìœ í‹¸
    ========================= */
    function toggleAccordion(contentEl, iconEl){
      contentEl.classList.toggle('open');
      iconEl.classList.toggle('rotate');
    }
    function updateEncouragementMessage(msg){ encouragementMessageDiv.textContent = msg; }
    function disableNextButton(){
      nextButton.disabled = true;
      nextButton.classList.add('bg-gray-400','cursor-not-allowed');
      nextButton.classList.remove('bg-blue-600','hover:bg-blue-700');
    }
    function enableNextButton(){
      nextButton.disabled = false;
      nextButton.classList.remove('bg-gray-400','cursor-not-allowed');
      nextButton.classList.add('bg-blue-600','hover:bg-blue-700');
    }

    function updateAgreementState(){
      if(isPersonalInfoAgreed && isSensitiveInfoAgreed){
        consentStatusDiv.classList.remove('hidden');
        enableNextButton();
        updateEncouragementMessage('ğŸ‰ ëª¨ë“  í•„ìˆ˜ ì•½ê´€ì— ë™ì˜í–ˆì–´ìš”!\nì´ì œ ì‹ ë¶„ì¦ ì´¬ì˜ì„ ì§„í–‰í•´ì£¼ì„¸ìš”.');
        Voice.announce('ëª¨ë“  í•„ìˆ˜ ì•½ê´€ ë™ì˜ê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤. í™”ë©´ í•˜ë‹¨ì˜ ì‹ ë¶„ì¦ ì´¬ì˜ ë²„íŠ¼ì„ ëˆŒëŸ¬ ë‹¤ìŒ ë‹¨ê³„ë¡œ ì´ë™í•˜ì„¸ìš”.');
      }else{
        consentStatusDiv.classList.add('hidden');
        disableNextButton();
        updateEncouragementMessage('âœ¨ í†µì¥ ê°œì„¤ì„ ìœ„í•´ í•„ìˆ˜ ì•½ê´€ì— ë™ì˜í•´ì£¼ì„¸ìš”.');
      }
    }

    /* =========================
       ìŒì„± ì•ˆë‚´ (WebSpeech + Native Bridge)
    ========================= */
    const Voice = (function(){
      let speaking = false;
      let queue = [];
      let current = null;

      const hasWebSpeech = ('speechSynthesis' in window) && ('SpeechSynthesisUtterance' in window);
      const hasAndroid = !!window.AndroidTTS?.speak;
      const hasIOS = !!(window.webkit && window.webkit.messageHandlers && window.webkit.messageHandlers.tts);

      function useNativeSpeak(text){
        const r = 1.0;
        if(hasAndroid){
          try{ window.AndroidTTS.speak(String(text), r); return true; }catch(e){ console.warn(e); }
        }
        if(hasIOS){
          try{ window.webkit.messageHandlers.tts.postMessage({action:'speak', text:String(text), rate:r}); return true; }catch(e){ console.warn(e); }
        }
        return false;
      }
      function useNativeStop(){
        if(hasAndroid){
          try{ window.AndroidTTS.stop(); return true; }catch(e){ console.warn(e); }
        }
        if(hasIOS){
          try{ window.webkit.messageHandlers.tts.postMessage({action:'stop'}); return true; }catch(e){ console.warn(e); }
        }
        return false;
      }

      function speakWeb(text, onend){
        const u = new SpeechSynthesisUtterance(String(text));
        u.lang = 'ko-KR';
        u.rate = 1.0;
        u.onend = onend || null;
        u.onerror = function(){ console.warn('TTS error'); onend && onend(); };
        window.speechSynthesis.speak(u);
      }

      function nextInQueue(){
        if(queue.length === 0){ current = null; speaking = false; setUI(false); return; }
        current = queue.shift();
        if(useNativeSpeak(current)){
          speaking = true; setUI(true);
          const approx = Math.max(1500, current.length * 60); // ëŒ€ëµ ê¸¸ì´ì— ë”°ë¥¸ ì¶”ì •
          setTimeout(()=>{ nextInQueue(); }, approx);
        }else if(hasWebSpeech){
          speaking = true; setUI(true);
          speakWeb(current, ()=> nextInQueue());
        }else{
          speaking = false; setUI(false);
        }
      }

      function setUI(isOn){
        voiceBtn.setAttribute('aria-pressed', isOn ? 'true' : 'false');
        voiceIconPlay.classList.toggle('hidden', isOn);
        voiceIconStop.classList.toggle('hidden', !isOn);
        voiceLabel.textContent = isOn ? 'ìŒì„± ì•ˆë‚´ ë„ê¸°' : 'ìŒì„± ì•ˆë‚´ ì¼œê¸°';
        voiceBtn.setAttribute('aria-label', voiceLabel.textContent);
        voiceBtn.setAttribute('title', voiceLabel.textContent);
      }

      function start(scriptLines){
        if(speaking) cancel();
        queue = Array.isArray(scriptLines) ? scriptLines.slice() : [String(scriptLines||'')];
        nextInQueue();
      }

      function cancel(){
        queue = [];
        current = null;
        speaking = false;
        useNativeStop();
        if(('speechSynthesis' in window)){ try{ window.speechSynthesis.cancel(); }catch(e){} }
        setUI(false);
      }

      function toggle(scriptLines){
        if(speaking){ cancel(); }
        else{ start(scriptLines); }
      }

      function announce(shortText){
        if(!shortText) return;
        if(!useNativeSpeak(shortText) && ('speechSynthesis' in window)){
          speakWeb(shortText);
        }
      }

      function isSpeaking(){ return speaking; }

      return { start, cancel, toggle, announce, isSpeaking };
    })();

    /* =========================
       ìŒì„± ìŠ¤í¬ë¦½íŠ¸ ìƒì„±
    ========================= */
    function buildVoiceScript(){
      const intro = 'ì•ˆë‚´: ì§€ê¸ˆì€ ë³¸ì¸í™•ì¸ ë‹¨ê³„ì…ë‹ˆë‹¤.';
      const core = 'ì²«ì§¸, ê°œì¸ì •ë³´ ìˆ˜ì§‘ ë° ì´ìš©. ë‘˜ì§¸, ë¯¼ê°ì •ë³´ ìˆ˜ì§‘ ë° ì´ìš©.';
      const how = 'ë‘ í•­ëª© ëª¨ë‘ ë™ì˜í•˜ë©´, í™”ë©´ í•˜ë‹¨ì˜ ì‹ ë¶„ì¦ ì´¬ì˜ ë²„íŠ¼ìœ¼ë¡œ ë‹¤ìŒ ë‹¨ê³„ë¡œ ì§„í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.';
      const tips = 'ê¸€ìê°€ ì‘ë‹¤ë©´ ë‘ ì†ê°€ë½ìœ¼ë¡œ í™”ë©´ì„ í™•ëŒ€í•´ ë³´ì„¸ìš”.';
      return [intro, core, how, tips];
    }

    /* =========================
       ì´ë²¤íŠ¸ ë°”ì¸ë”©
    ========================= */
    document.addEventListener('DOMContentLoaded', initializeUI);

    // í™ˆ/ì´ì „/ë‹¤ìŒ
    homeLink.addEventListener('click', (e)=>{ e.preventDefault(); window.location.href='/foreign'; });
    prevButton.addEventListener('click', ()=>{ window.location.href='/foreign1'; });

    nextButton.addEventListener('click', function(){
      if(isPersonalInfoAgreed && isSensitiveInfoAgreed){
        idCardGuidanceModal.classList.add('open');
        Voice.announce('ì‹ ë¶„ì¦ ì´¬ì˜ ì•ˆë‚´ë¥¼ í™•ì¸í•˜ì„¸ìš”.');
      }else{
        alert('ëª¨ë“  í•„ìˆ˜ ë™ì˜ í•­ëª©ì— ë™ì˜í•´ì•¼ ë‹¤ìŒ ë‹¨ê³„ë¡œ ì§„í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
        Voice.announce('í•„ìˆ˜ ë™ì˜ê°€ ì•„ì§ ì™„ë£Œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');
      }
    });

    loginRequiredConfirmBtn.addEventListener('click', ()=> loginRequiredModal.classList.remove('open'));
    idCardGuidanceConfirmBtn.addEventListener('click', function(){
      idCardGuidanceModal.classList.remove('open');
      Voice.cancel();
      window.location.href = '/foreign3';
    });

    // ì•„ì½”ë””ì–¸
    function handleAccordionClick(contentEl, iconEl, titleText){
      toggleAccordion(contentEl, iconEl);
    }
    personalInfoConsentHeader.addEventListener('click', ()=> handleAccordionClick(personalInfoConsentContent, personalInfoAccordionIcon));
    sensitiveInfoConsentHeader.addEventListener('click', ()=> handleAccordionClick(sensitiveInfoConsentContent, sensitiveInfoAccordionIcon));

    // í‚¤ë³´ë“œ ì ‘ê·¼
    personalInfoConsentHeader.addEventListener('keydown', (e)=>{ if(e.key==='Enter' || e.key===' '){ e.preventDefault(); personalInfoConsentHeader.click(); }});
    sensitiveInfoConsentHeader.addEventListener('keydown', (e)=>{ if(e.key==='Enter' || e.key===' '){ e.preventDefault(); sensitiveInfoConsentHeader.click(); }});

    // ë™ì˜ ë²„íŠ¼
    function handlePersonalInfoAgree(){
      isPersonalInfoAgreed = true;
      personalInfoCheckmark.style.display = 'inline-block';
      personalInfoConsentContent.classList.remove('open');
      personalInfoAccordionIcon.classList.remove('rotate');
      updateAgreementState();
      Voice.announce('ê°œì¸ì •ë³´ ë™ì˜ ì™„ë£Œ');
    }
    function handleSensitiveInfoAgree(){
      isSensitiveInfoAgreed = true;
      sensitiveInfoCheckmark.style.display = 'inline-block';
      sensitiveInfoConsentContent.classList.remove('open');
      sensitiveInfoAccordionIcon.classList.remove('rotate');
      updateAgreementState();
      Voice.announce('ë¯¼ê°ì •ë³´ ë™ì˜ ì™„ë£Œ');
    }
    personalInfoAgreeBtn.addEventListener('click', handlePersonalInfoAgree);
    sensitiveInfoAgreeBtn.addEventListener('click', handleSensitiveInfoAgree);

    // ìŒì„± ë²„íŠ¼/íŒ¨ë„
    voiceBtn.addEventListener('click', function(){
      voicePanel.classList.toggle('open');   // íŒ¨ë„ ì—´ê³ /ë‹«ê¸°
      Voice.toggle(buildVoiceScript());      // ì¬ìƒ/ì¤‘ì§€
    });
    // íŒ¨ë„ì˜ 'ë‹«ê¸°'ëŠ” ì¬ìƒ ìœ ì§€
    voiceCloseBtn.addEventListener('click', function(){
      voicePanel.classList.remove('open');
    });

    // ë‹¤ì‹œ ë“£ê¸°
    voiceReplayBtn.addEventListener('click', function(){
      Voice.start(buildVoiceScript());
    });

    // í˜ì´ì§€ ì „í™˜/ë°±ê·¸ë¼ìš´ë“œ ì‹œ ì •ì§€
    document.addEventListener('visibilitychange', ()=>{ if(document.hidden){ Voice.cancel(); } });
    window.addEventListener('pagehide', ()=> Voice.cancel());
  </script>
</body>
</html>
